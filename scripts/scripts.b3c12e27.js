function FifthweekError(a){this.message=a,this.stack=Error().stack}function ApiError(a){this.message=a,this.stack=Error().stack}function ConnectionError(a){this.message=a,this.stack=Error().stack}window.configuredApiBaseUri="https://api.fifthweek.com/",FifthweekError.prototype=Object.create(Error.prototype),FifthweekError.prototype.name="FifthweekError",ApiError.prototype=Object.create(Error.prototype),ApiError.prototype.name="ApiError",ConnectionError.prototype=Object.create(Error.prototype),ConnectionError.prototype.name="ConnectionError",window.onerror=function(a,b,c,d){if(!b||-1===b.indexOf("froogaloop")&&-1===a.indexOf("Cannot read property 'postMessage' of null")&&-1===a.indexOf("Unable to get property 'postMessage' of undefined or null reference")&&-1===a.indexOf("contentWindow is null")&&-1===a.indexOf("contentWindow.postMessage")){var e=function(a){return a.replace("\\","\\\\").replace('"','\\"')},f=window.XMLHttpRequest||function(){try{return new ActiveXObject("Msxml3.XMLHTTP")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(b){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(c){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(d){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}},g=new f;g.open("POST",window.configuredApiBaseUri+"/log",!0),g.setRequestHeader("Content-type","application/json"),window.developerName&&g.setRequestHeader("Developer-Name",window.developerName),g.send('{ level: "error", payload: { "message": "'+e(a||"")+'","source": "'+e(b||"")+'","url": "'+e(window.location.href)+'","line": "'+(c||0)+'","column": "'+(d||0)+'"}}')}},angular.module("webApp",["mgcrea.ngStrap","ngAnimate","ngResource","ngRoute","ngSanitize","LocalStorageModule","ng-focus","toaster","angular-loading-bar","angulartics","angulartics.google.analytics","angulartics.google.analytics.userid","angulartics.kissmetrics"]).constant("fifthweekConstants",{apiBaseUri:window.configuredApiBaseUri,developerName:window.developerName,developerNameHeader:"Developer-Name",clientId:"fifthweek.web.1",unexpectedErrorText:"An error has occured.",connectionErrorText:"Unable to communicate with the server. Make sure you are connected to the internet and try again.",tokenPath:"token",logPath:"log",homePage:"/",signInPage:"/signin",signOutPage:"/signout",registerPage:"/register",accountPage:"/account",dashboardPage:"/dashboard",feedbackPage:"/dashboard/feedback",notAuthorizedPage:"/notauthorized"}).config(["$routeProvider","fifthweekConstants",function(a,b){a.when(b.homePage,{templateUrl:"views/home.html",controller:"HomeCtrl"}).when(b.signInPage,{templateUrl:"views/signin.html",controller:"SignInCtrl"}).when(b.registerPage,{templateUrl:"views/register.html",controller:"RegisterCtrl"}).when(b.accountPage,{templateUrl:"views/account.html",controller:"AccountCtrl",access:{loginRequired:!0}}).when(b.dashboardPage,{templateUrl:"views/dashboard/demonstration.html",access:{loginRequired:!0}}).when(b.feedbackPage,{templateUrl:"views/dashboard/feedback.html",access:{loginRequired:!0}}).when(b.signOutPage,{templateUrl:"views/signout.html",controller:"SignOutCtrl"}).when(b.notAuthorizedPage,{redirectTo:b.homePage}).otherwise({redirectTo:b.homePage})}]),angular.module("webApp").factory("logService",["$injector","$log","$window","fifthweekConstants",function(a,b,c,d){"use strict";var e={},f=d.apiBaseUri+d.logPath;e.shouldLog=function(a){return void 0!==a&&!jQuery.isEmptyObject(a)};var g=function(d,g){if(e.shouldLog(g)){var h={level:d,payload:{url:c.location.href,message:g}},i=a.get("$http");return i.post(f,h)["catch"](function(a){b.warn("Server-side logging failed"),b.warn(a)})}};return e.debug=function(a){return b.debug(a),g("debug",a)},e.info=function(a){return b.info(a),g("info",a)},e.warn=function(a){return b.warn(a),g("warn",a)},e.error=function(a){return a instanceof ApiError?void b.info(a.message):(b.error(a),g("error",a))},e.logUnhandledError=function(a,b){if(e.shouldLog(a)||e.shouldLog(b)){var c={cause:b,exception:a};return g("error",c)}},e}]),angular.module("webApp").factory("utilities",["fifthweekConstants",function(a){"use strict";var b={};return b.getHttpError=function(b){if(0===b.status)return new ConnectionError(b);if(void 0!==b.data){if(void 0!==b.data.message)return new ApiError(b.data.message);if(void 0!==b.data.error_description)return new ApiError(b.data.error_description)}return new ApiError(a.unexpectedErrorText)},b.getFriendlyErrorMessage=function(b){return b instanceof ApiError?b.message:b instanceof ConnectionError?a.connectionErrorText:a.unexpectedErrorText},b}]),angular.module("webApp").controller("SignInCtrl",["$scope","$location","authenticationService","fifthweekConstants","logService","utilities",function(a,b,c,d,e,f){"use strict";a.signInData={username:"",password:""},a.message="",a.signIn=function(){return c.signIn(a.signInData).then(function(){b.path(d.dashboardPage)})["catch"](function(b){return a.message=f.getFriendlyErrorMessage(b),e.error(b)})}}]),angular.module("webApp").controller("HomeCtrl",[function(){"use strict"}]),angular.module("webApp").controller("IndexCtrl",["$scope","authenticationService",function(a,b){"use strict";a.currentUser=b.currentUser}]),angular.module("webApp").controller("RegisterCtrl",["$scope","$location","$analytics","authenticationService","fifthweekConstants","logService","utilities",function(a,b,c,d,e,f,g){"use strict";d.currentUser.authenticated===!0&&b.path(e.dashboardPage),a.savedSuccessfully=!1,a.message="",a.registrationData={exampleWork:"",email:"",username:"",password:""},a.register=function(){var h=function(){return{category:"Registration"}},i=function(b){c.eventTrack("Registration failed",h()),a.message=b};return c.eventTrack("Registration submitted",h()),d.registerUser(a.registrationData).then(function(){a.savedSuccessfully=!0,a.message="Signing in...";var f={username:a.registrationData.username,password:a.registrationData.password};return d.signIn(f).then(function(){c.eventTrack("Registration succeeded",h()),b.path(e.dashboardPage)})})["catch"](function(a){return i(g.getFriendlyErrorMessage(a)),f.error(a)})}}]),angular.module("webApp").factory("developerRequestInterceptor",["fifthweekConstants",function(a){"use strict";var b=a.apiBaseUri+a.tokenPath,c={};return c.request=function(c){return a.developerName&&c.url!==b&&(c.headers=c.headers||{},c.headers[a.developerNameHeader]=a.developerName),c},c}]),angular.module("webApp").factory("authenticationInterceptor",["$q","$injector","$location","localStorageService","fifthweekConstants",function(a,b,c,d,e){"use strict";var f,g={unauthorizedCount:0};g.request=function(a){a.headers=a.headers||{};var b=d.get("authenticationData");return b&&(a.headers.Authorization="Bearer "+b.token),a},g.responseError=function(d){if(401===d.status&&!d.config.hasRetried){d.config.hasRetried=!0;var f=b.get("authenticationService");return f.refreshToken().then(function(){return h(d.config)},function(){return c.path(e.signInPage),a.reject(d)})}return a.reject(d)};var h=function(a){return(f=f||b.get("$http"))(a)};return g}]),angular.module("webApp").factory("authenticationService",["$http","$q","$analytics","localStorageService","fifthweekConstants","utilities",function(a,b,c,d,e,f){"use strict";var g=e.apiBaseUri,h={};h.currentUser={authenticated:!1,username:"",permissions:[]},h.init=function(){var a=d.get("authenticationData");a&&(h.currentUser.authenticated=!0,h.currentUser.username=a.username)},h.registerUser=function(c){return h.signOut(),a.post(g+"membership/registrations",c)["catch"](function(a){return b.reject(f.getHttpError(a))})},h.signIn=function(j){h.signOut();var k="grant_type=password&username="+j.username+"&password="+j.password+"&client_id="+e.clientId;return a.post(g+"token",k,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){var b=i(j.username);d.set("authenticationData",{token:a.data.access_token,username:b,refreshToken:a.data.refresh_token}),h.currentUser.authenticated=!0,h.currentUser.username=b,c.setUsername(a.data.user_id)},function(a){return b.reject(f.getHttpError(a))})},h.signOut=function(){d.remove("authenticationData"),h.currentUser.authenticated=!1,h.currentUser.username="",h.currentUser.permissions=[]},h.refreshToken=function(){var c=d.get("authenticationData");if(!c)return b.reject(new FifthweekError("No local authentication data available."));var i="grant_type=refresh_token&refresh_token="+c.refreshToken+"&client_id="+e.clientId;return a.post(g+"token",i,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){d.set("authenticationData",{token:a.data.access_token,username:a.data.username,refreshToken:a.data.refresh_token})},function(a){return b.reject(f.getHttpError(a))})["catch"](function(a){return h.signOut(),b.reject(a)})};var i=function(a){return a.trim().toLowerCase()};return h}]),angular.module("webApp").constant("authorizationServiceConstants",{authorizationResult:{authorized:"authorized",loginRequired:"loginRequired",notAuthorized:"notAuthorized"},roleCheckType:{atLeastOne:"atLeastOne",all:"all"}}).factory("authorizationService",["authenticationService","authorizationServiceConstants",function(a,b){"use strict";var c={};return c.authorize=function(c,d,e){var f=b.authorizationResult.authorized,g=!0;if(e=e||b.roleCheckType.atLeastOne,c===!0&&a.currentUser.authenticated===!1)f=b.authorizationResult.loginRequired;else if(c!==!0||a.currentUser.authenticated===!1||void 0!==d&&0!==d.length){if(d){var h=[];angular.forEach(a.currentUser.roles,function(a){h.push(a.toLowerCase())});for(var i=0;i<d.length;i+=1){var j=d[i].toLowerCase();if(e===b.roleCheckType.all){if(g=g&&h.indexOf(j)>-1,g===!1)break}else if(e===b.roleCheckType.atLeastOne&&(g=h.indexOf(j)>-1))break}f=g?b.authorizationResult.authorized:b.authorizationResult.notAuthorized}}else f=b.authorizationResult.authorized;return f},c}]),function(a){"use strict";a.module("webApp").config(["$httpProvider",function(a){a.interceptors.push("authenticationInterceptor"),a.interceptors.push("developerRequestInterceptor")}]).config(["$provide",function(a){a.decorator("$exceptionHandler",["$delegate","logService",function(a,b){return function(c,d){a(c,d),b.logUnhandledError(c,d)}}])}]).run(["$rootScope","authenticationService","routeChangeAuthorizationHandler",function(a,b,c){b.init(),a.$on("$routeChangeStart",function(a,b){c.handleRouteChangeStart(b)})}])}(angular),angular.module("webApp").controller("AccountCtrl",["$scope",function(a){"use strict";a.test=1}]),angular.module("webApp").controller("SignOutCtrl",["$location","authenticationService","fifthweekConstants",function(a,b,c){"use strict";b.signOut(),a.path(c.signInPage)}]),angular.module("webApp").directive("roles",["authorizationService","authorizationServiceConstants",function(a,b){"use strict";return{restrict:"A",link:function(c,d,e){var f=function(){d.removeClass("hidden")},g=function(){d.addClass("hidden")},h=function(c){var d;c&&f(),d=a.authorize(!0,i,e.roleCheckType),d===b.authorizationResult.authorized?f():g()},i=e.roles.split(/[\s,]+/);i.length>0&&h(!0)}}}]),angular.module("webApp").directive("username",["$q","$timeout",function(a,b){"use strict";return{require:"ngModel",link:function(c,d,e,f){f.$asyncValidators.username=function(c){if(f.$isEmpty(c))return a.when();var d=a.defer();return b(function(){d.resolve()},1e3),d.promise}}}}]),angular.module("webApp").directive("vimeoVideo",["$analytics",function(a){"use strict";return{link:function(b,c,d){var e=$f(c[0]);c.load(function(){e.addEvent("ready",function(){e.addEvent("play",function(){a.eventTrack('Played video "'+d.title+'"',{category:"Video"})}),e.addEvent("pause",function(){a.eventTrack('Paused video "'+d.title+'"',{category:"Video"})}),e.addEvent("finish",function(){a.eventTrack('Finished video "'+d.title+'"',{category:"Video"})})})})}}}]),angular.module("webApp").factory("routeChangeAuthorizationHandler",["authorizationService","authorizationServiceConstants","$rootScope","$location","fifthweekConstants",function(a,b,c,d,e){"use strict";var f,g={},h=!1;return g.handleRouteChangeStart=function(c){if(h&&c.originalPath!==e.signInPage)h=!1,void 0!==c.access&&c.access.loginRequired===!0&&d.path(f).replace();else if(void 0!==c.access){var g=a.authorize(c.access.loginRequired,c.access.roles,c.access.roleCheckType);g===b.authorizationResult.loginRequired?(h=!0,f=c.originalPath,d.path(e.signInPage).replace()):g===b.authorizationResult.notAuthorized&&d.path(e.notAuthorizedPage).replace()}},g}]),function(a){"use strict";a.module("angulartics.kissmetrics",["angulartics"]).config(["$analyticsProvider",function(a){window._kmq="undefined"==typeof _kmq?[]:_kmq,a.registerPageTrack(function(a){window._kmq.push(["record",'Viewed page "'+a+'"'])}),a.registerEventTrack(function(a,b){window._kmq.push(["record",a,b])}),a.registerSetUsername(function(a){window._kmq.push(["identify",a])}),a.registerSetUserProperties(function(a){window._kmq.push(["set",a])})}])}(angular),function(a){"use strict";a.module("angulartics.google.analytics.userid",["angulartics"]).config(["$analyticsProvider",function(a){a.registerSetUsername(function(a){ga("set","&uid",a)})}])}(angular),angular.module("webApp").run(["$analytics",function(a){"use strict";function b(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}var c=function(){return{category:"Provenance"}},d=b("emailed_to");d.length>0&&a.setUserProperties({"last opened email from":d});var e=b("utm_campaign"),f=b("utm_source"),g=b("utm_medium"),h=b("utm_content");(e.length>0||f.length>0||g.length>0||h.length>0)&&a.eventTrack('Arrived from campaign "'+e+"/"+f+"/"+g+"/"+h+'"',c())}]);