function FifthweekError(a){this.message=a,this.stack=Error().stack}function CancellationError(a){this.message=a,this.stack=Error().stack}function ConnectionError(a){this.message=a,this.stack=Error().stack}function AzureError(a,b){this.message=a,this.response=b,this.stack=Error().stack}function DisplayableError(a,b){this.message=a,this.detailedMessage=b,this.stack=Error().stack}function InputValidationError(a){this.message=a,this.stack=Error().stack}function ApiError(a,b){this.message=a,this.response=b,this.stack=Error().stack}function UnauthenticatedError(a){this.message=a,this.stack=Error().stack}function UnauthorizedError(a){this.message=a,this.stack=Error().stack}window.configuredApiBaseUri="https://api.fifthweek.com/",window.testStripeKey="pk_test_ViIxeg3mtiXRrrjFYC2TJsDZ",window.liveStripeKey = "pk_live_CPkFeUZtDk781oGd6R53BGsV";var config={configurable:!0,value:function(){var a={},b=function(b){a[b]=this[b]};return Object.getOwnPropertyNames(this).forEach(b,this),a}};Object.defineProperty(Error.prototype,"toJSON",config),FifthweekError.prototype=Object.create(Error.prototype),FifthweekError.prototype.constructor=FifthweekError,CancellationError.prototype=Object.create(Error.prototype),CancellationError.prototype.constructor=CancellationError,ConnectionError.prototype=Object.create(Error.prototype),ConnectionError.prototype.constructor=ConnectionError,AzureError.prototype=Object.create(Error.prototype),AzureError.prototype.constructor=AzureError,DisplayableError.prototype=Object.create(Error.prototype),DisplayableError.prototype.constructor=DisplayableError,InputValidationError.prototype=Object.create(DisplayableError.prototype),InputValidationError.prototype.constructor=InputValidationError,ApiError.prototype=Object.create(DisplayableError.prototype),ApiError.prototype.constructor=ApiError,UnauthenticatedError.prototype=Object.create(ApiError.prototype),UnauthenticatedError.prototype.constructor=UnauthenticatedError,UnauthorizedError.prototype=Object.create(ApiError.prototype),UnauthorizedError.prototype.constructor=UnauthorizedError,window.onerror=function(a,b,c,d){if(!b||-1===b.indexOf("froogaloop")&&(-1===b.indexOf("vendor")||-1===a.indexOf("contentWindow")&&-1===a.indexOf("postMessage"))){var e=function(a){return a.replace("\\","\\\\").replace('"','\\"')},f=window.XMLHttpRequest||function(){try{return new ActiveXObject("Msxml3.XMLHTTP")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(b){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(c){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(d){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}},g=new f;g.open("POST",window.configuredApiBaseUri+"/log",!0),g.setRequestHeader("Content-type","application/json"),window.developerName&&g.setRequestHeader("Developer-Name",window.developerName),g.send('{ level: "error", payload: { "message": "'+e(a||"")+'","source": "'+e(b||"")+'","url": "'+e(window.location.href)+'","line": "'+(c||0)+'","column": "'+(d||0)+'"}}')}},angular.module("webApp",["ngResource","ngRoute","ui.router","ngSanitize","LocalStorageModule","ng-focus","ui.bootstrap","snap","monospaced.elastic","angulartics","angulartics.afterFirstPageTrack","angulartics.google.analytics","angulartics.google.analytics.userid","videosharing-embed","angularPayments"]).constant("fifthweekConstants",{apiBaseUri:window.configuredApiBaseUri,developerName:window.developerName,developerNameHeader:"Developer-Name",clientId:"fifthweek.web.1",unexpectedErrorText:"An error has occurred.",connectionErrorText:"Unable to communicate with the server. Make sure you are connected to the internet and try again.",tokenPath:"token",logPath:"log",longDateFormat:"EEEE, MMMM d, yyyy",longDateTimeFormat:"EEEE, MMMM d 'at' HH:mm 'UTC'",newsfeedDateFormat:"MMM d",dayGroupingDateFormat:"EEEE, MMM d",websiteRoot:"https://www.fifthweek.com/",defaultHeaderImageUrl:"/static/images/header-default.14e9f7c.png",defaultProfileImageUrl:"/static/images/avatar-default.9d327b9.jpg"}).constant("uiRouterConstants",{stateChangeStartEvent:"$stateChangeStart",stateChangeSuccessEvent:"$stateChangeSuccess"}).constant("uiBootstrapConstants",{modalClosingEvent:"modal.closing"}).config(["snapRemoteProvider",function(a){a.globalOptions={disable:"right",touchToDrag:!1}}]).config(["$analyticsProvider",function(a){a.firstPageview(!1)}]),angular.module("webApp").constant("states",{home:{name:"home"},pricing:{name:"pricing"},gettingStarted:{name:"gettingStarted"},contact:{name:"contact"},legal:{name:"legal",termsOfService:{name:"legal.termsOfService"},privacyPolicy:{name:"legal.privacyPolicy"}},register:{name:"register"},landingPage:{name:"landingPage"},signIn:{name:"signIn",signIn:{name:"signIn.signIn"},forgot:{name:"signIn.forgot"},reset:{name:"signIn.reset"}},user:{name:"user",signOut:{name:"user.signOut"},account:{name:"user.account"},creatorAccount:{name:"user.creatorAccount"},newsFeed:{name:"user.newsFeed"},notifications:{name:"user.notifications"},paymentInformation:{name:"user.paymentInformation"},viewSubscriptions:{name:"user.viewSubscriptions"},feedback:{name:"user.feedback"}},creator:{name:"creator",createBlog:{name:"creator.createBlog"},landingPage:{name:"creator.landingPage",preview:{name:"creator.landingPage.preview"},edit:{name:"creator.landingPage.edit"}},posts:{name:"creator.posts",compose:{name:"creator.posts.compose"},live:{name:"creator.posts.live"},scheduled:{name:"creator.posts.scheduled",list:{name:"creator.posts.scheduled.list"},queues:{name:"creator.posts.scheduled.queues",list:{name:"creator.posts.scheduled.queues.list"},reorder:{name:"creator.posts.scheduled.queues.reorder"}}}},queues:{name:"creator.queues","new":{name:"creator.queues.new"},edit:{name:"creator.queues.edit"},list:{name:"creator.queues.list"}},channels:{name:"creator.channels","new":{name:"creator.channels.new"},edit:{name:"creator.channels.edit"},list:{name:"creator.channels.list"}},subscribers:{name:"creator.subscribers",all:{name:"creator.subscribers.all"},guestList:{name:"creator.subscribers.guestList"}}},help:{name:"help"},notAuthorized:{name:"notAuthorized"},notFound:{name:"notFound"},comingSoon:{name:"comingSoon"},admin:{name:"admin",transactions:{name:"admin.transactions"},lookup:{name:"admin.lookup"},creatorRevenues:{name:"admin.creatorRevenues"}}}).config(["$stateProvider","$urlRouterProvider","$locationProvider","states","authenticationServiceConstants","authorizationServiceConstants",function(a,b,c,d,e,f){c.html5Mode(!0),b.otherwise("/not-found"),a.state(d.home.name,{url:"/",templateUrl:"modules/information/pages/home.html",data:{pageTitle:"Home",headDescription:"Fifthweek lets you effortlessly share anything with paying subscribers, so you can make a living doing what you love.",navigationHidden:!1,bodyClass:"info-page"}}).state(d.pricing.name,{url:"/pricing",templateUrl:"modules/information/pages/pricing.html",data:{headTitle:": Pricing",navigationHidden:!1,bodyClass:"info-page"}}).state(d.legal.name,{url:"/legal",templateUrl:"modules/common/ui-view.html",redirectTo:d.legal.termsOfService.name,data:{}}).state(d.legal.termsOfService.name,{url:"/terms",templateUrl:"modules/information/pages/terms-and-conditions.html",data:{headTitle:": Terms and Conditions",navigationHidden:!1,bodyClass:"info-page"}}).state(d.legal.privacyPolicy.name,{url:"/privacy",templateUrl:"modules/information/pages/privacy-policy.html",data:{headTitle:": Privacy Policy",navigationHidden:!1,bodyClass:"info-page"}}).state(d.gettingStarted.name,{url:"/go",templateUrl:"modules/information/pages/getting-started.html",data:{headTitle:": Getting Started",navigationHidden:!1,bodyClass:"info-page"}}).state(d.help.name,{url:"/help",templateUrl:"modules/information/pages/help.html",data:{headTitle:": Help",navigationHidden:"header",bodyClass:"info-page"}}).state(d.contact.name,{url:"/contact",templateUrl:"modules/information/pages/contact.html",data:{headTitle:": Contact Us",navigationHidden:!1,bodyClass:"info-page"}}).state(d.register.name,{url:"/register",templateUrl:"modules/registration/register.html",controller:"RegisterCtrl",data:{pageTitle:"Register",headTitle:": Register",access:{requireUnauthenticated:!0}}}).state(d.signIn.name,{url:"/sign-in",templateUrl:"modules/common/ui-view.html",redirectTo:d.signIn.signIn.name,data:{access:{requireUnauthenticated:!0}}}).state(d.signIn.signIn.name,{url:"",templateUrl:"views/sign-in/sign-in.html",controller:"SignInCtrl",data:{pageTitle:"Sign In",headTitle:": Sign In",access:{requireUnauthenticated:!0}}}).state(d.signIn.forgot.name,{url:"/forgot",templateUrl:"views/sign-in/forgot.html",controller:"SignInForgotCtrl",data:{pageTitle:"Forgot Your Details?",headTitle:": Forgot Details?",access:{requireUnauthenticated:!0}}}).state(d.signIn.reset.name,{url:"/reset?userId&token",templateUrl:"views/sign-in/reset.html",controller:"SignInResetCtrl",data:{pageTitle:"Reset Password",headTitle:": Reset Password",access:{requireUnauthenticated:!0}}}).state(d.user.name,{url:"/user",templateUrl:"modules/common/ui-view.html",redirectTo:d.user.newsFeed.name,data:{access:{requireAuthenticated:!0}}}).state(d.user.paymentInformation.name,{url:"/payment-information",templateUrl:"modules/payments/update-payment-information.html",controller:"updatePaymentInformationCtrl",data:{bodyClass:"page-update-payment-information",pageTitle:"Update Payment Information",headTitle:": Update Payment Information",access:{requireAuthenticated:!0}}}).state(d.user.viewSubscriptions.name,{url:"/view-subscriptions",templateUrl:"modules/subscriptions/view-subscriptions.html",controller:"viewSubscriptionsCtrl",data:{bodyClass:"page-view-subscriptions",pageTitle:"Your Subscriptions",headTitle:": Your Subscriptions",access:{requireAuthenticated:!0}}}).state(d.user.account.name,{url:"/account",templateUrl:"modules/account/account.html",controller:"AccountCtrl",data:{pageTitle:"Account Settings",headTitle:": Account Settings",bodyClass:"page-account-settings",access:{requireAuthenticated:!0}}}).state(d.user.feedback.name,{url:"",templateUrl:"modules/common/ui-view.html",data:{access:{requireAuthenticated:!0}}}).state(d.user.creatorAccount.name,{url:"/publish",templateUrl:"modules/account/become-creator.html",controller:"becomeCreatorCtrl",data:{pageTitle:"Publish",headTitle:": Publish",bodyClass:"page-become-creator",access:{requireAuthenticated:!0,roles:[e.roles.creator],roleCheckType:f.roleCheckType.none}}}).state(d.user.signOut.name,{url:"/sign-out",templateUrl:"views/signout.html",controller:"SignOutCtrl",data:{pageTitle:"Sign Out",headTitle:": Sign Out",access:{requireAuthenticated:!0}}}).state(d.user.newsFeed.name,{url:"/latest-posts",templateUrl:"modules/newsfeed/newsfeed.html",data:{pageTitle:"Latest Posts",headTitle:": Latest Posts",access:{requireAuthenticated:!0}}}).state(d.user.notifications.name,{url:"/notifications",templateUrl:"modules/notifications/notifications.html",data:{pageTitle:"Notifications",headTitle:": Notifications",bodyClass:"page-notifications",access:{requireAuthenticated:!0}}}).state(d.creator.name,{"abstract":!1,url:"/creator",templateUrl:"modules/common/ui-view.html",redirectTo:d.creator.posts.name,data:{access:{requireAuthenticated:!0,roles:[e.roles.creator]}}}).state(d.creator.createBlog.name,{url:"/create-channel",templateUrl:"modules/creator-blog/create-blog.html",controller:"createBlogCtrl",requireBlog:!1,data:{pageTitle:"Create Channel",headTitle:": Create Channel"}}).state(d.creator.landingPage.name,{"abstract":!1,url:"/profile",templateUrl:"modules/common/ui-view.html",redirectTo:d.creator.landingPage.edit.name,requireBlog:!0,data:{}}).state(d.creator.landingPage.preview.name,{url:"/preview",controller:"landingPageRedirectCtrl",requireBlog:!0,data:{}}).state(d.creator.landingPage.edit.name,{url:"/edit",templateUrl:"modules/creator-blog/customize-landing-page.html",controller:"customizeLandingPageCtrl",requireBlog:!0,data:{pageTitle:"Edit Appearance",headTitle:": Edit Appearance",bodyClass:"page-customize-landing"}}).state(d.creator.posts.name,{"abstract":!1,url:"/posts",templateUrl:"modules/common/ui-view.html",requireBlog:!0,redirectTo:d.creator.posts.live.name,data:{}}).state(d.creator.posts.compose.name,{url:"",templateUrl:"modules/common/ui-view.html",requireBlog:!0}).state(d.creator.posts.live.name,{url:"/live",templateUrl:"modules/creator-posts/creator-posts.html",requireBlog:!0,data:{pageTitle:"Live Posts",headTitle:": Live Posts"}}).state(d.creator.posts.scheduled.name,{url:"/scheduled",templateUrl:"modules/common/ui-view.html",redirectTo:d.creator.posts.scheduled.list.name,requireBlog:!0,data:{}}).state(d.creator.posts.scheduled.list.name,{url:"",templateUrl:"modules/creator-backlog/backlog-post-list.html",controller:"backlogPostListCtrl",requireBlog:!0,data:{pageTitle:"Scheduled Posts",headTitle:": Scheduled Posts",bodyClass:"page-creator-backlog-post-list"}}).state(d.creator.queues.name,{url:"/queues",templateUrl:"modules/common/ui-view.html",requireBlog:!0,redirectTo:d.creator.queues.list.name,data:{bodyClass:"page-creator-queues"}}).state(d.creator.queues["new"].name,{url:"/new",templateUrl:"modules/queues/new-queue.html",controller:"newQueueCtrl",requireBlog:!0,data:{headTitle:": Create Queue"}}).state(d.creator.queues.edit.name,{url:"/{id}",templateUrl:"modules/queues/edit-queue.html",controller:"editQueueCtrl",requireBlog:!0,data:{headTitle:": Edit Queue"}}).state(d.creator.queues.list.name,{url:"",templateUrl:"modules/queues/list-queues.html",controller:"listQueuesCtrl",requireBlog:!0,data:{pageTitle:"Queues",headTitle:": Queues"}}).state(d.creator.channels.name,{url:"/channels",templateUrl:"modules/common/ui-view.html",requireBlog:!0,redirectTo:d.creator.channels.list.name,data:{bodyClass:"page-creator-channels"}}).state(d.creator.channels["new"].name,{url:"/new",templateUrl:"modules/channels/new-channel.html",controller:"newChannelCtrl",requireBlog:!0,data:{headTitle:": Create Channel"}}).state(d.creator.channels.edit.name,{url:"/{id}",templateUrl:"modules/channels/edit-channel.html",controller:"editChannelCtrl",requireBlog:!0,data:{headTitle:": Edit Channel"}}).state(d.creator.channels.list.name,{url:"",templateUrl:"modules/channels/list-channels.html",controller:"listChannelsCtrl",requireBlog:!0,data:{pageTitle:"Blogs",headTitle:": Blogs"}}).state(d.creator.subscribers.name,{url:"/subscribers",templateUrl:"modules/common/ui-view.html",requireBlog:!0,redirectTo:d.creator.subscribers.all.name,data:{}}).state(d.creator.subscribers.all.name,{url:"/all",templateUrl:"modules/subscribers/view-subscribers.html",controller:"viewSubscribersCtrl",requireBlog:!0,data:{bodyClass:"page-view-subscribers",pageTitle:"Subscribers",headTitle:": Subscribers"}}).state(d.creator.subscribers.guestList.name,{url:"/guest-list",templateUrl:"modules/guest-list/guest-list.html",controller:"guestListCtrl",requireBlog:!0,data:{bodyClass:"page-guest-list",pageTitle:"Guest List",headTitle:": Guest List"}}).state(d.admin.name,{url:"/admin",templateUrl:"modules/common/ui-view.html",redirectTo:d.admin.lookup.name,data:{access:{requireAuthenticated:!0,roles:[e.roles.administrator]}}}).state(d.admin.transactions.name,{url:"/transactions",templateUrl:"modules/admin/transactions.html",controller:"transactionsCtrl",data:{bodyClass:"page-admin-transactions",pageTitle:"Transactions",headTitle:": Transactions"}}).state(d.admin.lookup.name,{url:"/lookup",templateUrl:"modules/admin/object-lookup.html",controller:"objectLookupCtrl",data:{bodyClass:"page-admin-lookup",pageTitle:"Lookup",headTitle:": Lookup"}}).state(d.admin.creatorRevenues.name,{url:"/creator-revenues",templateUrl:"modules/admin/creator-revenues.html",controller:"creatorRevenuesCtrl",data:{bodyClass:"page-creator-revenues",pageTitle:"Creator Revenues",headTitle:": Creator Revenues"}}).state(d.notAuthorized.name,{url:"/not-authorized",templateUrl:"views/not-authorized.html",data:{pageTitle:"Not Authorized",headTitle:": Not Authorized"}}).state(d.notFound.name,{url:"/not-found",templateUrl:"views/not-found.html",data:{pageTitle:"Not Found",headTitle:": Not Found"}}).state(d.comingSoon.name,{url:"/coming-soon",templateUrl:"views/coming-soon.html",data:{pageTitle:"Coming Soon",headTitle:": Coming Soon"}}).state(d.landingPage.name,{url:"/{username:[a-zA-Z0-9_]{2,20}}/:action/:key",params:{action:{value:null,squash:!0},key:{value:null,squash:!0}},templateUrl:"modules/landing-page/landing-page.html",controller:"landingPageCtrl",data:{pageTitle:"Landing Page",headTitle:": Landing Page",navigationHidden:"header",bodyClass:"page-landing-page",access:{requireAuthenticated:!1}}})}]),angular.module("webApp").factory("navigationMap",["aggregateUserStateUtilities","composeService","submitFeedbackService","states",function(a,b,c,d){"use strict";return[{name:"Home",hidden:!0,state:d.home.name,secondary:[{name:"Explore",state:d.home.name},{name:"Pricing",state:d.pricing.name},{name:"Getting Started",state:d.gettingStarted.name},{name:"Contact",state:d.contact.name}]},{name:"Legal",hidden:!0,state:d.legal.name,secondary:[{name:"Terms of Service",state:d.legal.termsOfService.name},{name:"Privacy Policy",state:d.legal.privacyPolicy.name}]},{name:"Sign In",state:d.signIn.signIn.name,icon:"fa fa-sign-in"},{name:"Register",state:d.register.name,icon:"fa fa-asterisk"},{name:"Latest Posts",state:d.user.newsFeed.name,icon:"fa fa-bolt"},{name:"Subscriptions",state:d.user.viewSubscriptions.name,icon:"fa fa-check-circle"},{separator:!0},{name:"View Profile",state:d.creator.landingPage.preview.name,icon:"fa fa-user"},{name:"Edit Profile",state:d.creator.landingPage.edit.name,icon:"fa fa-pencil",secondary:[{name:"Profile Information",state:d.creator.landingPage.edit.name,icon:"fa fa-pencil"},{name:"Channels",state:d.creator.channels.name,icon:"fa fa-check-square-o"}]},{name:"Subscribers",state:d.creator.subscribers.all.name,icon:"fa fa-users"},{name:"Guest List",state:d.creator.subscribers.guestList.name,icon:"fa fa-street-view"},{separator:!0},{name:"Publish",state:d.user.creatorAccount.name,icon:"fa fa-asterisk"},{name:"Create Channel",state:d.creator.createBlog.name,icon:"fa fa-asterisk"},{name:"New Post",state:d.creator.posts.compose.name,action:b.compose,icon:"fa fa-asterisk"},{name:"Live Posts",state:d.creator.posts.live.name,icon:"fa fa-calendar-check-o"},{name:"Scheduled Posts",state:d.creator.posts.scheduled.list.name,icon:"fa fa-calendar-o",secondary:[{name:"Scheduled Posts",state:d.creator.posts.scheduled.list.name,icon:"fa fa-calendar-o"},{name:"Queues",state:d.creator.queues.name,icon:"fa fa-th"}]},{separator:!0},{id:"account",name:a.getUsername,state:d.user.account.name,icon:"fa fa-cog",secondary:[{name:"Account Settings",state:d.user.account.name,icon:"fa fa-cog"},{name:"Payment",state:d.user.paymentInformation.name,icon:"fa fa-credit-card"}]},{name:"Sign Out",state:d.user.signOut.name,icon:"fa fa-sign-out"},{name:"Help",state:d.help.name,icon:"fa fa-question-circle"},{name:"Send Feedback",state:d.user.feedback.name,action:c.showDialog,icon:"fa fa-comment-o"},{name:"Admin",state:d.admin.name,icon:"fa fa-user-plus",secondary:[{name:"Lookup",state:d.admin.lookup.name,icon:"fa fa-eye"},{name:"Transactions",state:d.admin.transactions.name,icon:"fa fa-money"},{name:"Creator Revenues",state:d.admin.creatorRevenues.name,icon:"fa fa-money"}]}]}]),function(a){"use strict";a.module("webApp").config(["$httpProvider",function(a){a.interceptors.push("authenticationInterceptor"),a.interceptors.push("developerRequestInterceptor"),a.interceptors.push("impersonationInterceptor")}]).config(["$provide",function(a){a.decorator("$exceptionHandler",["$delegate","logService",function(a,b){return function(c,d){a(c,d),b.logUnhandledError(c,d)}}])}]).run(["identifiedUserNotifier",function(a){a.initialize()}]).run(function(){marked.setOptions({breaks:!0,sanitize:!0})}).run(["$state","states",function(a,b){var c=a.get(),d=a.get(b.home.name),e=c[0];if(""!==e.name)throw new FifthweekError("Failed to find empty state.");e.data={navigationHidden:d.data.navigationHidden,bodyClass:"page-empty"}}]).run(["$rootScope","uiRouterConstants","stateChangeService",function(a,b,c){a.$on(b.stateChangeStartEvent,function(a,b,d){c.redirectAwayIfRequired(a,b,d)})}]).run(["$state","stateChangeService","authenticationService","fetchAggregateUserState","logService",function(a,b,c,d,e){d.updateFromServer(c.currentUser.userId).then(function(){b.isPermitted(a.current)?a.current.name:b.redirectAwayIfRequired({preventDefault:function(){}},a.current,a.params)})["catch"](function(a){e.error(a)})}]).run(["$rootScope",function(a){a.$on("$stateChangeSuccess",function(){window.scrollTo(0,0)})}]).run(["$rootScope","$state","$stateParams","fifthweekConstants",function(a,b,c,d){a.fifthweekConstants=d,a.$state=b,a.$stateParams=c}])}(angular),angular.module("webApp").run(["$templateCache",function(a){"use strict";a.put("modules/account/account.html",'<form novalidate id=accountSettingsForm role=form name=form> <fw-panel12> <fw-error-message value=model.errorMessage></fw-error-message> <div ng-show=model.accountSettings> <div class="form-group form-group-has-buffers"> <label>Profile Image</label> <div class=row> <div class="col-xs-8 col-s-5 col-md-4"> <fw-blob-image control=blobImage thumbnail=preview fixed-aspect-ratio=true></fw-blob-image> </div> <div class="col-xs-4 col-s-7 col-md-5"> <fw-file-upload description=Upload on-upload-complete=onUploadComplete(data) file-purpose=profile-image accept=image/jpeg></fw-file-upload> </div> <div class="col-xs-12 bottom-buffer"> <small class=sub-image-input>We recommend images at least 600x600 pixels.</small> </div> </div> </div> <fw-form-group> <label for=email>Email</label> <div class=row> <div class=col-md-6> <div fw-form-input-glyphs> <input type=email id=email class=form-control name=email placeholder=Email ng-model=model.accountSettings.email required> </div> </div> <div class=col-md-6> <p fw-form-input-invalid-p>A valid email address is required.</p> </div> </div> </fw-form-group> <fw-form-input-username ng-model=model.accountSettings.username label=Username breakpoint=md required></fw-form-input-username> <fw-form-input-password ng-model=model.password placeholder="New password" label=Password breakpoint=md></fw-form-input-password> <div class=row-btn> <div ng-show="form.submissionSucceeded && form.$pristine" class="alert alert-success"> <p>Saved successfully</p> </div> <fw-error-message value=form.message></fw-error-message> <button type=submit id=save-changes-button class="btn btn-block btn-success" data-loading-text=Saving... data-event-title="Account settings saved" data-event-category=Account ng-disabled="form.$pristine || form.isSubmitting" fw-form-submit=submitForm()> Save Changes </button> <fw-form-cancel-button ng-disabled="form.$pristine || form.isSubmitting" id=cancel-button></fw-form-cancel-button> <fw-form-dirty-confirmation form=form></fw-form-dirty-confirmation> </div> </div> </fw-panel12> </form>'),a.put("modules/account/become-creator.html",'<form novalidate id=creatorSettingsForm role=form name=form> <fw-panel12> <label>Publish Your Work</label> <p> By publishing content on Fifthweek you can start funding your work through subscriptions, and start getting feedback from the people who value your work the most. </p> <div class=row-btn> <div ng-show="form.submissionSucceeded && form.$pristine" class="alert alert-success"> <p>Saved successfully</p> </div> <fw-error-message value=model.errorMessage></fw-error-message> <button type=submit id=become-creator-button class="btn btn-block btn-success" data-loading-text=Saving... data-event-title="Become a creator actioned" data-event-category=Account ng-disabled=form.isSubmitting can-submit=true error-message=model.errorMessage fw-form-submit=submitForm()> Start Publishing </button> </div> </fw-panel12> </form>'),a.put("modules/admin/creator-revenues.html",'<fw-error-message value=model.errorMessage></fw-error-message> <div ng-if=model.isLoading class=updating-area> <i class="fa fa-refresh fa-spin"></i> </div> <div ng-if=!model.isLoading> <div ng-if="!model.creators || !model.creators.length"> <fw-panel12> <p>No creators with revenue found.</p> </fw-panel12> </div> <div ng-if="model.creators && model.creators.length"> <table class=table ng-if=model.creators.length> <thead> <tr> <th>Username <th>Name <th>Email <th>Released <th>Unreleased <th>Releasable   <tbody> <tr ng-repeat="record in model.creators" ng-class="{ \'email-confirmed\': record.emailConfirmed }" class=record-row id=record-row-{{$index}}> <td><p>{{record.username}}</p> <td><p>{{record.name}}</p> <td><p>{{record.email}}</p> <td><p><fw-price value=record.releasedRevenue show-interval=false></fw-price></p> <td><p><fw-price value=record.unreleasedRevenue show-interval=false></fw-price></p> <td><p><strong><fw-price value=record.releasableRevenue show-interval=false></fw-price></strong></p>   </table> </div> </div>'),a.put("modules/admin/object-lookup.html",'<fw-panel12> <fw-error-message value=model.errorMessage></fw-error-message> <form novalidate id=form role=form name=form> <div class=row> <div class=col-s-6> <div> <input id=lookup-value class=form-control name=lookupValue placeholder=Value ng-model=model.input.value required> </div> </div> </div> <div class=row-btn> <button id=lookup-username-button class="btn btn-block btn-success" fw-form-submit=lookupUsername()>Lookup Username</button> <button id=lookup-user-id-button class="btn btn-block btn-success" fw-form-submit=lookupUserId()>Lookup User ID</button> </div> <div class=row-btn> <button ng-if=model.userId id=submit-button class="btn btn-block btn-success" fw-form-submit=startImpersonating()>Impersonate</button> <button ng-if=currentUser.nonImpersonatedUserId class="btn btn-block btn-default" ng-click=stopImpersonating()>Stop Impersonating</button> </div> </form> </fw-panel12> <pre class=raw-json>{{model.lookupResult}}</pre>'),a.put("modules/admin/transactions.html",'<fw-error-message value=model.errorMessage></fw-error-message> <div ng-if=model.isLoading class=updating-area> <i class="fa fa-refresh fa-spin"></i> </div> <div ng-if=!model.isLoading> <div ng-if=model.record> <h4>Selected Transaction</h4> <table class=table ng-if=model.records.length> <thead> <tr> <th>Timestamp <th>Type <th>Owner <th>CP <th>Account <th>Amount <th>   <tbody> <tr ng-repeat="record in model.selectedRecords" class="selected-record-row {{record.accountType}}" id=selected-record-row-{{$index}}> <td><p>{{record.timestamp | date: \'dd MMMM yyyy, HH:mm\':\'UTC\'}}</p> <td><p>{{record.transactionType}}</p> <td><p>{{record.accountOwnerUsername}}</p> <td><p>{{record.counterpartyUsername}}</p> <td><p>{{record.accountType}}</p> <td><p><fw-price value=record.amount show-interval=false></fw-price></p> <td><p><button style=color:{{record.color}} ng-click=showDetail(record);>View</button></p>   </table> <pre class=raw-json>{{model.recordJson}}</pre> <fw-error-message value=model.errorMessage></fw-error-message> <fw-panel12> <p ng-if=model.leaseTimeRemaining> Lease Time Remaining: {{model.leaseTimeRemaining}} <button ng-click=renewLease();>Renew Lease</button> </p> <p ng-if=!model.leaseTimeRemaining><button ng-click=acquireLease();>Acquire Lease</button></p> </fw-panel12> <div ng-if=!model.leaseTimeRemaining> <fw-panel12> <p> Obtain a lease to enable refunds. </p> </fw-panel12> </div> <div ng-if=model.leaseTimeRemaining> <div ng-if="model.record.transactionType === \'creditAddition\'"> <fw-panel12> <form novalidate id=refund-credit-form role=form name=refundCreditForm> <div class=row> <div class=col-s-6> <div> <input id=refund-credit-comment class=form-control name=comment placeholder=Comment ng-model=model.input.comment> </div> </div> </div> <div class=radio> <label> <input type=radio ng-model=model.input.refundReason ng-value="refundReasons.requestedByCustomer"> Requested by Customer </label> </div> <div class=radio> <label> <input type=radio ng-model=model.input.refundReason ng-value="refundReasons.duplicate"> Duplicate </label> </div> <div class=radio> <label> <input type=radio ng-model=model.input.refundReason ng-value="refundReasons.fraudulent"> Fraudulent </label> </div> <label>Credit to refund (tax is calculated):</label> <fw-form-input-channel-price ng-model=model.input.refundAmount required></fw-form-input-channel-price> <div class=row-btn> <button id=refund-credit-button class="btn btn-block btn-success" data-loading-text="Please wait..." data-event-title="Credit refunded" data-event-category=Refund fw-form-submit=refundCredit()>Refund Credit</button> </div> </form> </fw-panel12> </div> <div ng-if="model.record.transactionType === \'subscriptionPayment\'"> <fw-panel12> <form novalidate id=reverse-transaction-form role=form name=reverseTransactionForm> <div class=row> <div class=col-s-6> <div> <input id=reverse-transaction-comment class=form-control name=comment placeholder=Comment ng-model=model.input.comment> </div> </div> </div> <div class=row-btn> <button id=reverse-transaction-button class="btn btn-block btn-success" data-loading-text="Please wait..." data-event-title="Transaction reversed" data-event-category=Refund can-submit=true fw-form-submit=reverseTransaction()>Reverse Transaction</button> </div> </form> </fw-panel12> </div> </div> <fw-panel12> <p>Account balance of account owner: <fw-price value=model.accountOwnerData.accountSettings.accountBalance show-interval=false></fw-price>.</p> </fw-panel12> <fw-panel12> <p><button ng-click=impersonate(model.record.accountOwnerId);>Impersonate Account Owner</button></p> <p ng-if=model.record.counterpartyId><button ng-click=impersonate(model.record.counterpartyId);>Impersonate Counterparty</button></p> </fw-panel12> </div> <h4>All Matching Records</h4> <table class=table ng-if=model.records.length> <thead> <tr> <th>Timestamp <th>Type <th>Owner <th>CP <th>Account <th>Amount <th>   <tbody> <tr ng-repeat="record in model.records" class="record-row {{record.accountType}}" id=record-row-{{$index}}> <td><p>{{record.timestamp | date: \'dd MMMM yyyy, HH:mm\':\'UTC\'}}</p> <td><p>{{record.transactionType}}</p> <td><p>{{record.accountOwnerUsername}}</p> <td><p>{{record.counterpartyUsername}}</p> <td><p>{{record.accountType}}</p> <td><p><fw-price value=record.amount show-interval=false></fw-price></p> <td><p><button style=color:{{record.color}} ng-click=showDetail(record);>Filter</button></p>   </table> </div> <fw-panel12> <form novalidate id=filter-form role=form name=filterForm> <div> <label>Start (inclusive):</label> <fw-form-input-date-time-picker ng-model=model.filter.startTimestamp></fw-form-input-date-time-picker> </div> <div> <label>End (inclusive):</label> <fw-form-input-date-time-picker ng-model=model.filter.endTimestamp></fw-form-input-date-time-picker> </div> <label for=user-id-filter>User ID</label> <div class=row> <div class=col-s-6> <div> <input id=user-id-filter class=form-control name=userId placeholder="User ID" ng-model=model.filter.userId> </div> </div> </div> <div class=row-btn> <button id=filter-button class="btn btn-block btn-success" data-loading-text="Please wait..." can-submit=true fw-form-submit=filter()>Filter</button> <button id=reset-filter-button class="btn btn-block btn-success" data-loading-text="Please wait..." can-submit=true fw-form-submit=resetFilter()>Reset</button> </div> </form> </fw-panel12>'),a.put("modules/blog/directives/form-input-blog-name.html","<fw-form-group input-name=name> <div class=row> <div class=col-{{breakpoint}}-6> <div fw-form-input-glyphs> <input id={{inputId}} ng-model=ngModel[ngModelAccessor] name=name class=form-control placeholder={{placeholder}} ng-maxlength=50 maxlength=50 ng-focus=focus ng-required=required> </div> <small ng-if=showHelp>e.g. your name</small> </div> <div class=col-{{breakpoint}}-6> <p fw-form-input-invalid-p=maxlength>Allowed 50 characters at most.</p> <span ng-if=required> <p fw-form-input-invalid-p=required>A name is required.</p> </span> </div> </div> </fw-form-group>"),a.put("modules/blog/directives/form-input-introduction.html","<fw-form-group input-name=introduction> <div class=row> <div class=col-{{breakpoint}}-6> <div fw-form-input-glyphs> <textarea msd-elastic id={{inputId}} class=form-control name=introduction ng-model=ngModel[ngModelAccessor] ng-maxlength=250 maxlength=250 rows=4 placeholder={{placeholder}} ng-required=required></textarea> </div> <small ng-if=showHelp>For example, who are you? And why are you here?</small> </div> <div class=col-{{breakpoint}}-6> <p fw-form-input-invalid-p=maxlength>Allowed 250 characters at most.</p> <span ng-if=required> <p fw-form-input-invalid-p=required>An introduction is required.</p> </span> </div> </div> </fw-form-group>"),
a.put("modules/channels/directives/form-input-channel-name.html","<fw-form-group input-name=channelName> <div class=row> <div class=col-{{breakpoint}}-6> <div fw-form-input-glyphs> <input id={{inputId}} ng-model=ngModel[ngModelAccessor] name=channelName class=form-control placeholder={{placeholder}} ng-maxlength=50 maxlength=50 ng-focus=focus ng-required=required> </div> </div> <div class=col-{{breakpoint}}-6> <p fw-form-input-invalid-p=maxlength>Allowed 50 characters at most.</p> <span ng-if=required> <p fw-form-input-invalid-p=required>A name is required.</p> </span> </div> </div> </fw-form-group>"),a.put("modules/channels/directives/form-input-channel-price.html",'<fw-form-group input-name=channelPrice> <div class=row> <div class=col-{{breakpoint}}-6> <div class=input-group> <div class=input-group-addon>&#36;</div> <input id={{inputId}} ng-model=ngModel[ngModelAccessor] name=channelPrice class=form-control money min=0.01 ng-focus=focus ng-required=required> <div class=input-group-addon>per week</div> </div> <small ng-if=showHelp>i.e. the amount people will pay you</small>  <span style="right: 98px" fw-form-input-valid class="glyphicon glyphicon-ok form-control-feedback" aria-hidden=true></span> <span style="right: 98px" fw-form-input-invalid class="glyphicon glyphicon-remove form-control-feedback" aria-hidden=true></span> </div> <div class=col-{{breakpoint}}-6> <p fw-form-input-invalid-p=min>Must be at least one cent.</p> <span ng-if=required> <p fw-form-input-invalid-p=required>A price is required.</p> </span> </div> </div> </fw-form-group>'),a.put("modules/channels/directives/form-input-channel-visibility.html","<fw-form-group input-name=channelHidden> <div class=row> <div class=col-xs-12> <div class=checkbox> <label> <input id={{inputId}} name=channelHidden ng-model=ngModel[ngModelAccessor] type=checkbox> Hidden channel </label> <small>Hidden channels are not listed on your landing page.</small> </div> </div> </div> </fw-form-group>"),a.put("modules/channels/edit-channel.html",'<div> <fw-breadcrumb current={{model.savedChannelName}}></fw-breadcrumb> <fw-panel12> <form novalidate id=editChannelForm role=form name=form> <label>Name</label> <fw-form-input-channel-name ng-model=model.channel.name placeholder="Channel name" required focus></fw-form-input-channel-name> <label>Subscription price</label> <fw-form-input-channel-price ng-model=model.channel.price required></fw-form-input-channel-price> <fw-form-input-channel-visibility ng-if=!model.channel.isDefault ng-model=model.channel.hidden required></fw-form-input-channel-visibility> <div class=row-btn> <div class=row> <div class=col-s-8> <button id=save-channel-button class="btn btn-block btn-success" data-loading-text=Saving... data-event-title="Channel edited" data-event-category=Customization ng-disabled="form.$pristine || form.isSubmitting" fw-form-submit=save()>Save Changes</button> <button id=cancel-button class="btn btn-default btn-block" ui-sref={{previousState}} ng-click=form.discard()>Cancel</button> </div> <div class=col-s-4 ng-if=!model.channel.isDefault> <fw-form-input-delete item=model.savedChannelName item-type=Channel link-id=delete-channel-link data-event-title="Channel deleted" data-event-category=Customization delete="form.discard(); delete();"></fw-form-input-delete> </div> </div> </div> <div ng-show=form.message class="alert alert-danger sub-form-alert"> <p>{{form.message}}</p> </div> <fw-form-dirty-confirmation form=form></fw-form-dirty-confirmation> </form> </fw-panel12> </div>'),a.put("modules/channels/list-channels.html",'<div class=page-blog-channels> <fw-managed-list id=channels ng-if=!model.errorMessage item-name=channel items=model.channels new-item-state=creator.channels.new manage-item-state=creator.channels.edit> <h5><a class=channel-name href>{{item.name}}</a> <span ng-if=!item.isVisibleToNonSubscribers class=tail>Hidden</span></h5> <p class=channel-description> <fw-price value=item.price></fw-price> </p> </fw-managed-list> <div ng-if=model.errorMessage class="alert alert-danger sub-form-alert"> <p>{{model.errorMessage}}</p> </div> </div>'),a.put("modules/channels/new-channel.html",'<fw-breadcrumb current="New Channel"></fw-breadcrumb> <fw-panel12> <form novalidate role=form id=createChannelForm name=form> <fw-form-input-channel-name ng-model=model.channel.name placeholder="New channel name" required focus></fw-form-input-channel-name> <fw-form-input-channel-price ng-model=model.channel.price required></fw-form-input-channel-price> <fw-form-input-channel-visibility ng-model=model.channel.hidden required></fw-form-input-channel-visibility> <div class=row-btn> <button id=create-channel-button class="btn btn-block btn-success" data-loading-text=Creating... data-event-title="Channel created" data-event-category=Customization fw-form-submit=create()>Create Channel</button> <button id=cancel-button class="btn btn-default btn-block" ui-sref={{previousState}}>Cancel</button> </div> <div ng-show=form.message class="alert alert-danger sub-form-alert"> <p>{{form.message}}</p> </div> </form> </fw-panel12>'),a.put("modules/comments/comments-dialog.html",'<form novalidate role=form name=commentOnPostForm class=comment-on-post-form> <fw-form-modal-title name=Comments></fw-form-modal-title> <div class=comments-dialog> <div class=modal-body ng-if=model.errorMessage> <fw-error-message value=model.errorMessage></fw-error-message> </div> <div class=updating-area ng-if="model.isLoading && !model.errorMessage"> <p><i class="fa fa-refresh fa-spin"></i></p> </div> <div ng-if="!model.isLoading && !model.errorMessage"> <div class=modal-body ng-if=model.isCommenting> <fw-form-input-comment ng-model=model.input.comment placeholder="Add a comment, if you like" required focus> </fw-form-input-comment> <button type=submit id=save-comment-button class="btn btn-block btn-success" data-loading-text=Saving... data-event-title="Comment saved" data-event-category=Comment ng-disabled="form.$pristine || form.isSubmitting" error-message=model.errorMessage fw-form-submit=saveComment()> Add Comment </button> </div> <div class=no-comments-message ng-if="!model.comments || !model.comments.length"> <p>No comments yet.</p> </div> <div ng-repeat="comment in model.comments track by comment.commentId" class=comment id=comment-{{$index}}> <hr> <div class=modal-body> <div class=row> <div class="col-xs-1 comment-number">{{comment.number}}</div> <div class="col-xs-11 col-ss-6"><span class=comment-username>{{comment.username}}</span><span class=comment-live-since>{{comment.liveSince}}</span></div> </div> <div class=row> <div class=col-xs-1></div> <div class=col-xs-11> <span fw-markdown ng-model=comment.content class=comment-content></span> </div> </div> </div> </div> </div> </div> </form>'),a.put("modules/common/fw-date-time-picker.html",'<div class=row> <div class="col-xs-12 col-ss-8 col-sm-6"> <div class=input-group>  <input class=form-control datepicker-popup={{format}} ng-model=date is-open=opened init-date=date datepicker-options=dateOptions ng-click=openDatePicker($event) close-text=Close readonly> <span class=input-group-btn> <button type=button class="btn btn-default" ng-click=openDatePicker($event)> <i class="glyphicon glyphicon-calendar"></i> </button> </span> </div> </div> <div class="col-xs-12 col-ss-4 col-sm-6"> <div class=timepicker> <timepicker ng-model=time minute-step=15 show-meridian=false></timepicker> </div> </div> </div>'),a.put("modules/common/fw-form-cancel-button.html",'<button class="btn btn-default btn-block" ng-click=cancelForm()>Cancel</button>'),a.put("modules/common/fw-form-dirty-confirmation.html",'<form novalidate role=form name=form> <fw-form-modal name="Discard changes?" id-prefix=dirty-confirmation> <form-body> <div class=form-group> <p class=bottom-buffer> You have unsaved changes, do you want to continue? </p> </div> </form-body> <form-buttons> <button id=discard-button class="btn btn-block btn-danger" ng-click=$close(true)>Yes, discard changes</button> </form-buttons> </fw-form-modal> </form>'),a.put("modules/common/fw-form-input-date-time-picker.html",'<div class="fw-date-time-picker form-group-no-bottom-margin">  <fw-form-group input-name=dateTimePicker> <div class=row> <div class=col-xs-12> <fw-date-time-picker name=dateTimePicker ng-model=ngModel[ngModelAccessor]></fw-date-time-picker> </div> <div class=col-xs-12> <p fw-form-input-invalid-p>Please select a valid date and time.</p> </div> </div> </fw-form-group> </div>'),a.put("modules/common/fw-form-input-hour-of-week.html",'<div class=hour-of-week> <div class=form-group> <label>Weekly release time</label> <div class=row> <div class="col-xs-6 col-sm-4 day-of-week"> <div class=select> <select id=day-of-week class=select-full-width ng-model=model.day ng-options="item.name for item in model.days"></select> </div> </div> <div class="col-xs-4 col-ss-3 hour-of-day"> <div class=select> <select id=hour-of-day class=select-full-width ng-model=model.hour ng-options="item.name for item in model.hours"></select> </div> </div> <div class="col-xs-2 timezone"> <p>UTC</p> </div> </div> </div> </div>'),a.put("modules/common/fw-image.html",'<div class=image-container> <div class=vertical-aspect-ratio></div> <img id={{id}} class=image-area ng-src="{{src}}"> </div>'),a.put("modules/common/ui-view.html","<div ui-view></div>"),a.put("modules/creator-backlog/backlog-post-list.html","<fw-post-list source=creator-backlog></fw-post-list>"),a.put("modules/creator-blog/create-blog.html",'<fw-panel12> <form novalidate role=form name=form id=createBlogForm> <h4>Create your first channel</h4> <p> Before posting content we need to create a channel. You also can change your channel settings later. </p> <fw-form-input-blog-name ng-model=newBlogData.name placeholder="Channel name" required focus show-help></fw-form-input-blog-name> <fw-form-input-channel-price ng-model=newBlogData.basePrice required></fw-form-input-channel-price> <div class=row-btn> <button id=create-blog-button class="btn btn-block btn-success" data-loading-text=Saving... data-event-title="Blog created" data-event-category=Registration fw-form-submit=continue()>Create Channel</button> </div> <fw-error-message value=form.message></fw-error-message> </form> </fw-panel12>'),a.put("modules/creator-blog/customize-landing-page-basics.html",'<div class=basics> <div class=form-group id=vanity-url> <div class=row> <div class=col-xs-12> <h5>URL</h5> <p><a ui-sref="landingPage({username: model.username})">{{model.landingPageUrl}}</a></p> </div> </div> </div> <label>Title</label> <fw-form-input-blog-name ng-model=model.settings.name placeholder="e.g. Your name or product" required focus></fw-form-input-blog-name> <label>Introduction</label> <fw-form-input-introduction id=introduction ng-model=model.settings.introduction placeholder="For example, who are you? And why are you here?"></fw-form-input-introduction> </div>'),a.put("modules/creator-blog/customize-landing-page-full-description.html",'<div class=full-description> <fw-form-group> <label for=video>Your Video</label> <div class=row> <div class=col-sm-10> <input type=url id=video name=video class=form-control ng-model=model.settings.video ng-maxlength=100 maxlength=100 ng-pattern="/^https?:\\/\\/(www\\.)?((youtube\\.com)|(youtu\\.be)|(vimeo\\.com))\\/.*$/" placeholder="http://"> <p class=light-grey> <small>Creators with videos have a much higher success rate. <br> <strong>Paste in the url of your video from Youtube, Vimeo, etc.</strong></small> </p> </div> <div class=col-xs-12> <p fw-form-input-invalid-p=pattern>YouTube and Vimeo videos only. Must start with \'http://\' or \'https://\'.</p> <p fw-form-input-invalid-p=maxlength>Allowed 100 characters at most.</p> </div> </div> </fw-form-group> <label for=description>Full Description</label> <fw-form-group> <div class=row> <div class=col-xs-12> <fw-sir-trevor-editor maxlength=50000 ng-model=model.settings.description editor-id=description name=description text-only=true no-focus=true placeholder="This is where you can really sell your content... tell everyone why they need to subscribe."> </fw-sir-trevor-editor> </div> </div> </fw-form-group> </div>'),a.put("modules/creator-blog/customize-landing-page-header-image.html",'<div class=header-image> <div class="form-group form-group-has-buffers"> <label>Header Image</label> <div class=row> <div class="col-xs-12 col-s-9 col-sm-10 bottom-buffer"> <fw-blob-image control=blobImage thumbnail=preview fixed-aspect-ratio=true></fw-blob-image> <small class=sub-image-input>We recommend images at least 3000x1000 pixels.</small> </div> <div class="col-xs-12 col-s-3 col-sm-2 bottom-buffer"> <fw-file-upload description=Upload abbreviate-progress=true on-upload-complete=onUploadComplete(data) file-purpose=profile-header-image accept=image/jpeg></fw-file-upload> </div> </div> </div> </div>'),a.put("modules/creator-blog/customize-landing-page-loading-area.html","<fw-error-message value=model.errorMessage></fw-error-message>"),a.put("modules/creator-blog/customize-landing-page-submission-area.html",'<div class=row-btn> <div ng-show="form.submissionSucceeded && form.$pristine" class="alert alert-success"> <p>Saved successfully</p> </div> <div ng-show=form.message class="alert alert-danger form-message"> <p>{{form.message}}</p> </div> <div ng-show="form.hasAttemptedSubmit && !form.$valid" class="alert alert-danger form-invalid-message"> <p>Please correct all invalid fields before proceeding.</p> </div> <button type=submit class="btn btn-block btn-success save-changes-button" data-loading-text=Saving... data-event-title="Customize Landing Page form submitted" data-event-category="Customize Landing Page" ng-disabled="form.$pristine || form.isSubmitting" fw-form-submit=submitForm()> Save Changes </button> <fw-form-cancel-button ng-disabled="form.$pristine || form.isSubmitting" class=form-cancel-button></fw-form-cancel-button> </div>'),a.put("modules/creator-blog/customize-landing-page.html","<form novalidate id=customizeLandingPageForm role=form name=form> <fw-panel12> <div ng-include=\"'modules/creator-blog/customize-landing-page-loading-area.html'\"></div> <div ng-show=model.settings> <div ng-include=\"'modules/creator-blog/customize-landing-page-basics.html'\"></div> <div ng-include=\"'modules/creator-blog/customize-landing-page-header-image.html'\"></div> <div ng-include=\"'modules/creator-blog/customize-landing-page-full-description.html'\"></div> </div> <div ng-include=\"'modules/creator-blog/customize-landing-page-submission-area.html'\"></div> <fw-form-dirty-confirmation form=form></fw-form-dirty-confirmation> </fw-panel12> </form>"),a.put("modules/creator-compose/compose-post.html",'<fw-form-modal-title name="New Post"></fw-form-modal-title> <div class=compose-upload-form> <div ng-if=!model.committedChannel> <form novalidate name=channelForm id=channel-form> <div class="modal-body form-modal-body select-channels-area"> <div ng-if="model.channels.length === 0"> <p>You must create a channel before you can create a post.</p> </div> <div ng-if="model.channels.length !== 0"> <label class=select-channel-text>Which channel would you like to post to?</label> <div ng-repeat="item in model.channels"> <button type=submit id=select-channel-{{$index}} class="btn btn-block btn-default channel-selection-button" fw-form-submit=commitChannel(item) can-submit=true ng-disabled=channelForm.isSubmitting error-message=model.errorMessage>{{item.name}}</button> </div> </div> <fw-error-message value=model.errorMessages></fw-error-message> </div> </form> </div> <div ng-if=model.committedChannel> <form novalidate name=contentForm id=content-form> <fw-form-dirty-confirmation form=contentForm is-modal=true></fw-form-dirty-confirmation> <div class="modal-body form-modal-body"> <p ng-if=model.channels.length id=posting-to-text>Posting to <strong>{{model.committedChannel.name}}</strong>.</p> <fw-form-group input-name=content> <div class=row> <div class=col-xs-12> <fw-sir-trevor-editor maxlength=50000 ng-model=model.input.content editor-id=content channel-id={{model.committedChannel.channelId}} name=content placeholder="Say something, if you like"></fw-sir-trevor-editor> </div> <div class=col-xs-12> <p fw-form-input-invalid-p=required>Please write some content.</p> </div> </div> </fw-form-group> <div ng-show=model.postLater class=compose-upload-schedule> <div ng-if="model.queues.length === 0"> <label>On specific date and time (UTC):</label> <fw-form-input-date-time-picker ng-model=model.input.date></fw-form-input-date-time-picker> </div> <div class=form-group ng-if="model.queues.length > 0"> <div class="radio bottom-buffer-l"> <label><input type=radio ng-model=model.postToQueue ng-value="true"> After other posts in queue <span ng-if=!model.queuedLiveDate>(loading...)</span> <span id=queued-live-date ng-if=model.queuedLiveDate>(will appear <strong>{{model.queuedLiveDate | date:fifthweekConstants.longDateTimeFormat:\'UTC\'}}</strong>)</span> : </label> </div> <fw-form-input-select-queue input-id=queue-select items=model.queues selected-item=model.input.selectedQueue></fw-form-input-select-queue> <div class="radio bottom-buffer"> <label><input type=radio ng-model=model.postToQueue ng-value="false"> On specific date and time (UTC):</label> </div> <fw-form-input-date-time-picker ng-model=model.input.date></fw-form-input-date-time-picker> </div> </div> <fw-error-message value=model.errorMessage></fw-error-message> </div> <div class=row-btn> <div ng-show=!model.postLater> <button type=submit class="btn btn-block btn-success" data-loading-text=Posting... data-event-title="{{postType}} posted" data-event-category="New post" can-submit=contentForm.$valid fw-form-submit=postNow() ng-disabled=model.isProcessing error-message=model.errorMessage> <span ng-if=model.isProcessing>Processing...</span> <span ng-if=!model.isProcessing>Post Now</span> </button> <button class="btn btn-default btn-block" ng-disabled=contentForm.isSubmitting ng-click=postLater()>Schedule</button> </div> <div ng-show=model.postLater> <button type=submit class="btn btn-block btn-success" data-loading-text=Scheduling... data-event-title="{{postType}} scheduled" data-event-category="New post" can-submit=contentForm.$valid fw-form-submit=postToBacklog() ng-disabled=model.isProcessing error-message=model.errorMessage> <span ng-if=model.isProcessing>Processing...</span> <span ng-if=!model.isProcessing>Schedule</span> </button>  <button class="btn btn-default btn-block" ng-disabled=contentForm.isSubmitting ng-click=cancelPostLater()>Back</button> </div> </div> </form> </div> </div>'),a.put("modules/creator-posts/creator-posts.html","<fw-post-list source=creator-timeline></fw-post-list>"),a.put("modules/feedback/submit-feedback-dialog.html",'<form novalidate role=form name=submitFeedbackForm ng-if="model.page === pages.form"> <fw-form-dirty-confirmation form=submitFeedbackForm is-modal=true></fw-form-dirty-confirmation> <fw-form-modal name="Send us feedback"> <form-body> <fw-form-input-comment ng-model=model.input.content placeholder="Your message" focus required></fw-form-input-comment> <fw-error-message value=submitFeedbackForm.message id=register-message></fw-error-message> </form-body> <form-buttons> <button class="btn btn-success btn-block btn-continue" type=submit id=register-button data-event-title={{model.trackingEventTitle}} data-event-category={{model.trackingEventCategory}} fw-form-submit=submitFeedback()>Send</button> </form-buttons> </fw-form-modal> </form> <form novalidate role=form name=form ng-if="model.page === pages.done"> <fw-form-modal-title name="Send us feedback"></fw-form-modal-title> <div class=modal-body> <p><strong>Thank you for your feedback!</strong> Someone from our team will be in touch shortly if a response is required.</p> </div> <div class=row-btn> <button id=dismiss-button class="btn btn-success btn-block" type=submit ng-click=$close()>Okay</button> </div> </form>'),a.put("modules/guest-list/guest-list.html",'<fw-panel12> <fw-error-message value=model.errorMessage></fw-error-message> <div ng-if="model.isLoading && !model.errorMessage" class=updating-area> <i class="fa fa-refresh fa-spin"></i> </div> <div ng-if=!model.isLoading> <div ng-if="!model.isEditing && !model.errorMessage"> <div ng-if="!model.freeAccessUsers || model.freeAccessUsers.length === 0"> <p> Your guest list is currently empty. </p> <div ng-include="\'modules/guest-list/invalid-emails-warning.html\'"></div> <div class=bs-callout-primary> <p> Add people to your guest list to give them free access to your content. This can be useful for getting early feedback, giving VIP access to certain people, or for rewarding Patreon supporters. </p> </div> <p> <button class="btn btn-default btn-block" id=create-guest-list-button ng-click=editList()>Create Guest List</button> </p> </div> <div ng-if="model.freeAccessUsers && model.freeAccessUsers.length"> <p> You have <strong id=guest-list-count>{{model.freeAccessUsers.length}}</strong> {{model.freeAccessUsers.length === 1 ? \'person\' : \'people\'}} in your guest list, of which <strong id=guest-list-registered-count>{{model.registeredCount}}</strong> {{model.registeredCount === 1 ? \'has\' : \'have\'}} registered on Fifthweek and <strong id=guest-list-subscribed-count>{{model.subscribedCount}}</strong> {{model.subscribedCount === 1 ? \'has\' : \'have\'}} subscribed to your profile. </p> <p> <button class="btn btn-default btn-block" id=edit-guest-list-button ng-click=editList()>Edit Guest List</button> </p> <div ng-include="\'modules/guest-list/invalid-emails-warning.html\'"></div> <table class=table> <thead> <tr> <th>Email <th>Username <th>Subscribed   <tbody> <tr ng-repeat="item in model.freeAccessUsers" class=guest-list-row id=guest-list-row-{{$index}}> <td><p>{{ item.email }}</p> <td><p>{{ item.username }}</p> <td><p ng-if=item.isSubscribed><i class="fa fa-check"></i></p>   </table> </div> </div> <div ng-if=model.isEditing> <form novalidate name=editForm id=edit-form> <div class=row-btn-top> <button type=submit id=save-guest-list-button class="btn btn-block btn-success" data-loading-text=Saving... data-event-title="Guest list saved" data-event-category="Guest list" ng-disabled="editForm.$pristine || editForm.isSubmitting" fw-form-submit=save() error-message=model.errorMessage>Save Guest List</button> <button class="btn btn-default btn-block" id=cancel-edit-guest-list-button ng-disabled=editForm.isSubmitting ng-click=viewList()>Cancel</button> </div> <textarea id=emails-text class="form-control form-control-lines-2" name=emails-text ng-model=model.input.emailsText placeholder="Enter one email address per line" ng-disabled=editForm.isSubmitting ng-maxlength=3000 maxlength=3000></textarea> <fw-form-dirty-confirmation form=editForm></fw-form-dirty-confirmation> </form> </div> </div> </fw-panel12>'),a.put("modules/guest-list/invalid-emails-warning.html",'<div class=bs-callout-warning ng-if="model.invalidEmails && model.invalidEmails.length"> <p> The following invalid emails were ignored: <ul> <li ng-repeat="item in model.invalidEmails" class=invalid-email>{{ item }}</li> </ul> </p> </div>'),a.put("modules/information/pages/contact.html",'<div class=info-page-boxes> <div class="info-page-box info-page-box-light"> <div class=container> <div class=row> <div class=col-xs-12> <h2>We look forward to hearing from you!</h2> <p>You can contact us via email or twitter by clicking the icons below.</p> <ul class=contact-page-links> <li> <a analytics-category=Link analytics-event="Clicked &quot;Email&quot; on contact page" analytics-on href="mailto:hello@fifthweek.com?subject=Hi Fifthweek!&body=I just wanted to say..."> <span class=contact-icon> <i class="fa fa-envelope-o"></i> </span> <span class=contact-text> hello@fifthweek.com </span> </a> </li> <li> <a analytics-category=Link analytics-event="Clicked &quot;Twitter&quot; on contact page" analytics-on target=_blank href=https://twitter.com/fifthweek> <span class=contact-icon> <i class="fa fa-twitter"></i> </span> <span class=contact-text> @fifthweek </span> </a> </li> </ul> </div> </div> </div> </div> </div>'),a.put("modules/information/pages/getting-started.html",'<div class=info-page-boxes> <div class="info-page-box info-page-box-light"> <div class=container> <div class=row> <div class=col-xs-12> <h1 class=light>Subscribers</h1> </div> </div> </div> </div> <div class=info-page-box> <div class=container> <div class=row> <div class="col-xs-12 info-page-box-extra-padding"> <p> You can get started by browsing the latest posts on our home page (we will have more discoverability features coming soon). If you already know of a creator on Fifthweek, you can go directly to their landing page to see what they are offering. </p> <p> Once you have found a creator to which you would like to subscribe, simply click on the Subscribe button on either their landing page or one of their posts. </p> <p> If you have already signed in and have credit on your account, then you can immediately start enjoying your new content. </p> <p> Otherwise you can follow the instructions to create an account and provide your payment information, after which the new content will be immediately available. </p> </div> </div> </div> </div> <div class="info-page-box info-page-box-light"> <div class=container> <div class=row> <div class=col-xs-12> <h1 class=light>Creators</h1> </div> </div> </div> </div> <div class=info-page-box> <div class=container> <div class=row> <div class="col-xs-12 info-page-box-extra-padding"> <p> To become a creator on Fifthweek, simply register (or sign in) as normal then click on "Publish" in the menu. </p> <p> You\'ll be taken through a few simple steps to create your first channel, after which you can start publishing your content right away. </p> <p> Initially your channel is only visible to those who you share it with. However once you are happy with the quality of your offering, <a ui-sref=contact>contact us</a> and we will make it discoverable on the site once it has passed our own quality checks. </p> </div> </div> </div> </div> <div class="info-page-box info-page-box-light"> <div class=container> <div class=row> <div class="col-xs-12 info-page-box-extra-padding"> <h1 class=light>Let\'s get started!</h1> <a class=info-page-button ui-sref=register>Create your account</a> </div> </div> </div> </div> </div>'),a.put("modules/information/pages/help.html",'<div class=info-page-boxes> <div class="info-page-box info-page-box-dark"> <div class=container> <div class=row> <div class=col-xs-12> <h1 class=long>Help and Support</h1> <h2 class=sub-heading-long>What would you like to do?</h2> </div> </div> </div> </div> <div class=info-page-box> <div class=container> <div class=row> <div class=col-xs-12> <h2>Need a question answered?</h2> <p class=first>We have a growing support area which you can access with the button below.</p> <p> Our support area contains <strong>frequently asked questions</strong>, and a <strong>community forum</strong> where you can post to get help with something more specific. The Fifthweek team are watching the forums and will also try to answer your questions. </p> <a class="info-page-button center" href=http://fifthweek.zendesk.com>Enter support area</a> </div> </div> </div> </div> <div class="info-page-box info-page-box-light"> <div class=container> <div class=row> <div class=col-xs-12> <h2>Want to contact us directly?</h2> <p> We\'re always eager to improve and would love to hear your question! </p> <a class=info-page-button ui-sref=contact>Get in touch</a> </div> </div> </div> </div> </div>'),a.put("modules/information/pages/home.html",'<div class=info-page-boxes> <div class="info-page-box info-page-box-aspiration"> <div class=container> <div class=row> <div class=col-xs-12> <h1>fifthweek.</h1> <h2> We are a community of talented writers and artists who create quality journalism, photography and art in return for small individual subscriptions. </h2> <h3> Join now and help give quality content a home. </h3> </div> </div> <div class=row> <div class=col-xs-12> <a id=get-started class=info-page-button ui-sref=gettingStarted>Get Started</a> </div> </div> </div> </div> <div class=info-page-posts> <div class=info-page-posts-center> <h2>Recent Posts</h2> <fw-post-list source=preview></fw-post-list> </div> </div> </div>'),a.put("modules/information/pages/pricing.html",'<div class=info-page-boxes> <div class="info-page-box info-page-box-light"> <div class=container> <div class=row> <div class=col-xs-12> <h1 class=light>Subscribers</h1> </div> </div> </div> </div> <div class=info-page-box> <div class=container> <div class=row> <div class="col-xs-12 info-page-box-extra-padding"> <p> On Fifthweek you subscribe to individual creators, and each creator is free to set his own weekly subscription price. </p> <p> We support subscription prices all the way down to just 1 cent per week, allowing everyone to find an appropriate price for their particular content. </p> </div> </div> </div> </div> <div class="info-page-box info-page-box-light"> <div class=container> <div class=row> <div class=col-xs-12> <h1 class=light>Creators</h1> </div> </div> </div> </div> <div class=info-page-box> <div class=container> <div class=row> <div class="col-xs-12 info-page-box-extra-padding"> <h2 class=sub-heading-long>You get 80% of subscription revenue, with no hidden fees.</h2> <p> We have no setup fees and no monthly fees, so you can get started right away for free. </p> <p> Once you have paying subscribers we take 20% of your revenue, which we use to cover transaction costs, currency conversion fees and our running costs. </p> </div> </div> </div> </div> <div class="info-page-box info-page-box-long-form-double-col info-page-box-light"> <div class=container> <div class=row> <div class=col-sm-6> <h2>What about transaction fees?</h2> <p> All fees are covered by us. </p> </div> <div class=col-sm-6> <h2>Who owns the content?</h2> <p> Creators own their own content. </p> </div> </div> <div class=row> <div class=col-sm-6> <h2>What about VAT?</h2> <p> We handle that for you. </p> </div> <div class=col-sm-6> <h2>How do I get paid?</h2> <p> We currently support PayPal for paying out, with Payoneer coming soon. </p> </div> </div> </div> </div> </div>'),a.put("modules/information/pages/privacy-policy.html",'<div class=info-page-boxes> <div class="info-page-box info-page-box-light"> <div class=container> <div class=row> <div class=col-xs-12> <h1 class=light>Privacy Policy</h1> </div> </div> </div> </div> <div class="info-page-box info-page-box-long-form"> <div class=container> <div class=row> <div class=col-xs-12> <h2>Last Modified: May 30th, 2015</h2> <p> <strong>We take the private nature of your information very seriously.</strong> </p> <p> This is why we are looking to implement a clear Privacy Policy as a matter of priority. We apologise for any inconvenience caused by not having this document available at present. </p> <h2>Modifications to this Privacy Policy</h2> <p> Our Privacy Policy may change from time to time as per the process for modifications defined in our <a ui-sref=legal.termsOfService>Terms of Service</a>. Use of information we collect is subject to the Privacy Policy in effect at the time such information is collected. </p> <h2>Prior Versions</h2> <p> Prior versions of our Privacy Policy are available on GitHub, which also allows you to compare different versions and see what terms have changed: </p> <p> <a href=http://github.com/fifthweek/fifthweek-policy/commits/master/privacy-policy.txt>View older versions.</a> </p> </div> </div> </div> </div> <div class="info-page-box info-page-box-light"> <div class=container> <div class=row> <div class=col-xs-12> <h2>Any questions on the above?</h2> <p> We\'re always eager to improve and would love to hear your feedback. </p> <a class=info-page-button ui-sref=contact>Get in touch</a> </div> </div> </div> </div> </div>'),a.put("modules/information/pages/terms-and-conditions.html",'<div class=info-page-boxes> <div class="info-page-box info-page-box-light"> <div class=container> <div class=row> <div class=col-xs-12> <h1 class=light>Terms and Conditions</h1> </div> </div> </div> </div> <div class="info-page-box info-page-box-long-form"> <div class=container> <div class=row> <div class=col-xs-12> <h2>Last Modified: December 21, 2014</h2> <p> Please read these Terms of Service (the "Agreement") carefully before using fifthweek.com (the "Site") and/or the other domains, websites, products, applications, mobile applications, services, and/or Content (all of those collectively with the Site, the "Services") provided by Fifthweek LTD. ("Fifthweek," "we," or "us"). By using or accessing the Services, you ("User" or "you") agree to be bound by all the terms and conditions of this Agreement. If you dont agree to all the terms and conditions of this Agreement, you shouldn\'t, and aren\'t permitted to, use the Services. </p> <h2>Modifications to this Agreement</h2> <p> Fifthweek reserves the right to modify this Agreement by (1) posting a revised Agreement on and/or through the Services and (2) providing notice to you that this Agreement has changed, generally via email, and otherwise through the Services. Modifications will not apply retroactively. You are responsible for reviewing and becoming familiar with any modifications to this Agreement. </p> <p> We may sometimes ask you to review and to explicitly agree to (or reject) a revised version of this Agreement. In such cases, modifications will be effective at the time of your agreement to the modified version of this Agreement. If you do not agree at that time, you are not permitted to use the Services. </p> <p> In cases where we do not ask for your explicit agreement to a modified version of this Agreement, but otherwise provide notice as set forth above, the modified version of this Agreement will become effective fourteen (14) days after we have posted the modified Agreement and provided you notification of the modifications. Your use of the Services following that period constitutes your acceptance of the terms and conditions of this Agreement as modified. If you do not agree to the modifications, you are not permitted to use, and should discontinue your use of, the Services. </p> <h2>Use of the Services</h2> <p> No individual under the age of thirteen (13) may use the Services, provide any personal information to Fifthweek, or otherwise submit personal information through the Services (including, for example, a name, address, telephone number, or email address). You cannot use the Services if you are legally prohibited from doing so. </p> <p> Fifthweek retains the right to create limits on and related to use of the Services in its sole discretion at any time with or without notice. Fifthweek may also impose limits on certain Services or aspects of those Services or restrict your access to parts or all of the Services without notice or liability. Fifthweek may change, suspend, or discontinue any or all of the Services at any time, including the availability of any product, feature, database, or Content (as defined below). Fifthweek may also terminate or suspend accounts at any time, in its sole discretion. </p> <h2>Prior Versions</h2> <p> Prior versions of our Terms of Service are available on GitHub, which also allows you to compare different versions and see what terms have changed: </p> <p> <a href=http://github.com/fifthweek/fifthweek-policy/commits/master/terms-of-service.txt>View older versions.</a> </p> </div> </div> </div> </div> <div class="info-page-box info-page-box-light"> <div class=container> <div class=row> <div class=col-xs-12> <h2>Any questions on the above?</h2> <p> We\'re always eager to improve and would love to hear your feedback. </p> <a class=info-page-button ui-sref=contact>Get in touch</a> </div> </div> </div> </div> </div>'),
a.put("modules/landing-page/fw-post-subscription-information.html",'<div class=position-relative> <div ng-if="!model.landingPage && !model.errorMessage" class=updating-area> <i class="fa fa-refresh fa-spin"></i> </div> <fw-error-message value=model.errorMessage></fw-error-message> <div class=subscription-information ng-if=model.landingPage.channels> <ng-include src="\'modules/landing-page/fw-subscription-information-channels.html\'"></ng-include> </div> </div>'),a.put("modules/landing-page/fw-subscription-information-channels.html",'<fw-panel12 class=channels-and-blurb> <div class=channels> <div id=channel-{{$index}} class=channel ng-repeat="channel in model.landingPage.channels"> <form name=form> <div class=channel-name>{{channel.name}} <span ng-if=item.isVisibleToNonSubscribers class=tail>Hidden</span></div> <div class=channel-price-column> <button ng-if=!channel.subscriptionInformation type=submit id="{{isPost ? \'post-\' : \'\'}}subscribe-button-{{$index}}" class="btn btn-block channel-button subscribe-button" can-submit=true ng-disabled=form.isSubmitting error-message=model.errorMessage data-loading-text=Subscribing... fw-form-submit=subscribe(channel)> Subscribe <span ng-if=!model.landingPage.hasFreeAccess><fw-price price-id=channel-price-{{$index}} value=channel.price></fw-price></span> <span ng-if=model.landingPage.hasFreeAccess id=channel-price-{{$index}}>FREE</span> </button> <button ng-if=channel.subscriptionInformation type=submit id="{{isPost ? \'post-\' : \'\'}}unsubscribe-button-{{$index}}" class="btn btn-block channel-button unsubscribe-button" can-submit=true ng-disabled=form.isSubmitting error-message=model.errorMessage data-loading-text=Unsubscribing... fw-form-submit=unsubscribe(channel)> Unsubscribe <span ng-if=!model.landingPage.hasFreeAccess><fw-price price-id=channel-price-{{$index}} value=channel.price></fw-price></span> <span ng-if=model.landingPage.hasFreeAccess id=channel-price-{{$index}}>FREE</span> </button> <button ng-if="channel.subscriptionInformation.isIncrease || channel.subscriptionInformation.isDecrease" type=submit id="{{isPost ? \'post-\' : \'\'}}accept-button-{{$index}}" class="btn btn-block channel-button subscribe-button" can-submit=true ng-disabled=form.isSubmitting error-message=model.errorMessage data-loading-text=Accepting... fw-form-submit=subscribe(channel)> Accept <span> <fw-price price-id=channel-previous-price-{{$index}} value=channel.subscriptionInformation.acceptedPrice></fw-price> <i class="fa fa-long-arrow-right"></i> <span ng-if=!model.landingPage.hasFreeAccess><fw-price price-id=channel-new-price-{{$index}} value=channel.price></fw-price></span> <span ng-if=model.landingPage.hasFreeAccess id=channel-new-price-{{$index}}>FREE</span> </span> </button> </div> </form> </div> </div> <hr> <div class=standard-blurb-area> <div class="standard-blurb-content row"> <div class="col-xs-12 col-sm-6"> <p>Cancel anytime.</p> </div> <div class="col-xs-12 col-sm-6"> <p>Minimum billing period of just one week.</p> </div> </div> </div> </fw-panel12>'),a.put("modules/landing-page/fw-subscription-information.html",'<div class=position-relative> <div ng-if="model.isLoading && !model.errorMessage" class="updating-area inline-updating-area"> <i class="fa fa-refresh fa-spin"></i> </div> <fw-error-message value=model.errorMessage></fw-error-message> <div class=subscription-information ng-if=model.landingPage> <div class=main-content ng-class="{\'main-content-introduction-empty\': !model.landingPage.blog.introduction}"> <div class=row> <div class=col-xs-12> <div class=content-padding> <a ng-if=model.landingPage.isOwner id=edit-introduction-link class="btn btn-edit btn-default" ui-sref=creator.landingPage.edit> <span ng-if=!model.landingPage.blog.introduction>add introduction</span> <span ng-if=model.landingPage.blog.introduction>edit introduction</span> </a> <h4 id=blog-introduction>{{model.landingPage.blog.introduction}}</h4> </div> </div> </div> </div> <div class=main-content> <div class=row> <div class=col-xs-12> <h1 class=landing-page-h1>Available Channels</h1> <a ng-if=model.landingPage.isOwner id=edit-channels-link class="btn btn-edit btn-default" ui-sref=creator.channels.list> <span ng-if=!model.landingPage.channels.length>add channels</span> <span ng-if=model.landingPage.channels.length>edit channels</span> </a> <h2 ng-if=!model.landingPage.channels.length>No channels currently available.</h2> </div> <div class=col-xs-12 ng-if=model.landingPage.channels.length> <p class=channel-count-information ng-if=model.landingPage.subscribedChannelCount> Subscribed to {{model.landingPage.subscribedChannelCount}} channel{{model.landingPage.subscribedChannelCount === 1 ? \'\' : \'s\'}}. <span ng-if=!model.landingPage.hasFreeAccess> Total price is <fw-price value=model.landingPage.totalPrice></fw-price>. </span> <span ng-if=model.landingPage.hasFreeAccess> This profile is currently free as you are on the guest list. </span> </p> <ng-include src="\'modules/landing-page/fw-subscription-information-channels.html\'"></ng-include> </div> </div> </div> <div class=video-content ng-class="{\'video-content-empty\':!model.landingPage.videoUrl}"> <div class=main-content> <div class=row> <div class=col-xs-12> <div id=video-area class=content-padding> <div id=edit-video-area> <a ng-if=model.landingPage.isOwner id=edit-video-link class="btn btn-edit btn-default" ui-sref=creator.landingPage.edit> <span ng-if=!model.landingPage.videoUrl>add video</span> <span ng-if=model.landingPage.videoUrl>edit video</span> </a> </div> <div id=video class=video ng-if=model.landingPage.videoUrl> <embed-video data-ng-href={{model.landingPage.videoUrl}} rel=0 autohide=1 frameborder=0 showinfo=0></embed-video> </div> </div> </div> </div> </div> </div> <div class=main-content ng-class="{\'main-content-empty\': !model.landingPage.blog.description}"> <fw-panel12 ng-if=model.landingPage.blog.description class=description-panel> <div class=description-text id=description-area> <fw-markdown replace=true ng-model=model.landingPage.blog.description></fw-markdown> </div> </fw-panel12> <div class=content-padding> <a ng-if=model.landingPage.isOwner id=edit-description-link class="btn btn-edit btn-default" ui-sref=creator.landingPage.edit> <span ng-if=!model.landingPage.blog.description>add full description</span> <span ng-if=model.landingPage.blog.description>edit full description</span> </a> </div> </div> </div> </div>'),a.put("modules/landing-page/guest-list-only-dialog.html",'<form novalidate role=form name=form> <fw-form-modal-title name="Guest List Only"></fw-form-modal-title> <div class=modal-body> <p>Currently only people on the guest list can subscribe to this profile.</p> <p>Please contact the creator if you think you should be added to the guest list.</p> </div> <div class=row-btn> <button id=guest-list-only-dismiss-button class="btn btn-success btn-block" type=submit ng-click=$close()>Okay</button> </div> </form>'),a.put("modules/landing-page/landing-page-content-footer.html","<div class=footer-area> <div class=main-content> <div class=footer-content> <p class=links> <span><a ui-sref=home>Fifthweek</a></span> <span><a ui-sref=help>Help</a></span> <span><a ui-sref=legal.termsOfService>Terms of Use</a></span> <span><a ui-sref=legal.privacyPolicy>Privacy Policy</a></span> </p> </div> </div> </div>"),a.put("modules/landing-page/landing-page-content-header.html",'<fw-azure-image-loader output-url=model.landingPage.profileImageUrl thumbnail=header file-id={{model.landingPage.profileImage.fileId}} container-name={{model.landingPage.profileImage.containerName}}></fw-azure-image-loader> <fw-azure-image-loader output-url=model.landingPage.headerImageUrl thumbnail=header file-id={{model.landingPage.blog.headerImage.fileId}} container-name={{model.landingPage.blog.headerImage.containerName}}></fw-azure-image-loader> <div class=header-image ng-style="{\'background-image\':\'url(\' + (model.landingPage.blog.headerImage.fileId ? model.landingPage.headerImageUrl : fifthweekConstants.defaultHeaderImageUrl) + \')\'}" id=header-image> </div> <div class=header-image-control-overlay> <div class=row> <div class=col-xs-6> <h1 class="header-corner-button anchor-cursor header-corner-menu-button" snap-toggle=left> <i class="fa fa-bars"></i> </h1> <h1 class="header-corner-button anchor-cursor" id=cancel-changes-button ng-if=model.returnState ng-click=goBack()> <i class="fa fa-arrow-left"></i> </h1> </div> <div class=col-xs-6> <a ng-if=model.landingPage.isOwner id=edit-header-link class="btn btn-edit btn-default" ui-sref=creator.landingPage.edit> <span ng-if=!model.landingPage.blog.headerImage.fileId>add header image</span> <span ng-if=model.landingPage.blog.headerImage.fileId>edit header image</span> </a> </div> </div> </div> <div class=header-content> <div class=header> <div class=row> <div class=col-xs-12> <div class=creator> <fw-image id=profile-image src="{{model.landingPage.profileImage.fileId ? model.landingPage.profileImageUrl : fifthweekConstants.defaultProfileImageUrl}}"></fw-image> </div> <div class=header-text> <h2> <a ng-if=model.landingPage.isOwner id=edit-title-link class="btn btn-edit btn-default" ui-sref=creator.landingPage.edit> <span class=edit-text>edit title</span> </a> <span id=blog-name>{{model.landingPage.blog.name}}</span> </h2> <a ng-if=model.landingPage.isOwner id=edit-profile-image-link class="btn btn-edit btn-default" ui-sref=user.account> <span class=edit-text>edit avatar</span> </a>  </div> </div> </div> <div class="row header-padding-row"> </div> </div> </div>'),a.put("modules/landing-page/landing-page.html",'<div ng-if="!model.isLoaded && !model.errorMessage" class=updating-area> <i class="fa fa-refresh fa-spin"></i> </div> <fw-error-message value=model.errorMessage></fw-error-message> <div ng-if=model.isLoaded ng-class="{ \'main-post-content\': model.currentView === views.post }"> <ng-include src="\'modules/landing-page/landing-page-content-header.html\'"></ng-include> <fw-subscription-information username={{model.username}} landing-page-data="model.post ? undefined : model.landingPage" ng-if="model.landingPage && model.currentView !== views.post"></fw-subscription-information> <div class=main-content> <div class=row> <div class=col-xs-12> <div ng-if="model.currentView === views.timeline"> <h1 class=landing-page-h1>Latest Content</h1> <div class=landing-page-content-buttons> <button class=landing-page-content-button id=show-channel-posts-button ng-if=model.channelId ng-class="{\'active-button\': model.currentView === views.timeline && model.timelineType === timelineTypes.channel }" ng-click=showChannel()>Channel</button> <button class=landing-page-content-button id=show-post-button ng-if=model.postId ng-class="{\'active-button\': model.currentView === views.post }" ng-click=showPost()>Post</button> <button class=landing-page-content-button id=show-all-posts-button ng-if="!model.landingPage.isOwner || model.channelId || model.postId" ng-class="{\'active-button\': model.currentView === views.timeline && model.timelineType === timelineTypes.all }" ng-click=showAllPosts()>All Posts</button> <button class=landing-page-content-button id=show-subscribed-posts-button ng-if=!model.landingPage.isOwner ng-class="{\'active-button\': model.currentView === views.timeline && model.timelineType === timelineTypes.subscribed }" ng-click=showSubscribedPosts()>Subscribed Posts</button> </div> <div ng-if="model.timelineType === timelineTypes.all"> <fw-post-list source=preview user-id={{model.landingPage.userId}}></fw-post-list> </div> <div ng-if="model.timelineType === timelineTypes.channel"> <fw-post-list source=preview user-id={{model.landingPage.userId}} channel-id={{model.channelId}}></fw-post-list> </div> <div ng-if="model.timelineType === timelineTypes.subscribed"> <fw-post-list source=timeline user-id={{model.landingPage.userId}}></fw-post-list> </div> </div> <div ng-if="model.currentView === views.post && model.post">  <fw-full-post post=model.post></fw-full-post> </div> </div> </div> </div> <ng-include src="\'modules/landing-page/landing-page-content-footer.html\'"></ng-include> </div>'),a.put("modules/landing-page/sign-in-workflow-dialog.html",'<form novalidate role=form name=registerForm ng-if="model.page === pages.register"> <fw-form-modal name=Welcome> <form-body> <p>Please register below, or <span class=btn-alternate-action><a id=show-sign-in-link class=anchor-cursor ng-click=showSignIn()>Sign In</a>.</span></p> <fw-form-group> <div class=row> <div class=col-md-12> <div fw-form-input-glyphs> <input id=registrationData-email ng-model=registrationData.email type=email class=form-control name=email placeholder=Email focus=true required> </div> </div> <div class=col-md-12> <p fw-form-input-invalid-p>A valid email address is required.</p> </div> </div> </fw-form-group> <fw-form-input-username ng-model=registrationData.username input-columns=12 required></fw-form-input-username> <fw-form-input-password ng-model=registrationData.password placeholder=Password input-columns=12 required></fw-form-input-password> <fw-error-message value=registerForm.message id=register-message></fw-error-message> </form-body> <form-buttons> <button class="btn btn-success btn-block" type=submit id=register-button data-loading-text=Registering... data-event-title=Registered data-event-category=Registration fw-form-submit=register()>Continue</button> </form-buttons> </fw-form-modal> </form> <form novalidate role=form name=signInForm ng-if="model.page === pages.signIn"> <fw-form-modal name=Welcome> <form-body> <p>Please sign in below, or <span class=btn-alternate-action><a id=show-register-link class=anchor-cursor ng-click=showRegister()>Register</a> to create an account.</span></p> <div class=form-group> <input id=signInData-username class=form-control placeholder=Username ng-model=signInData.username focus=true> </div> <div class=form-group> <input id=signInData-password type=password class=form-control placeholder=Password ng-model=signInData.password> </div> <p class=btn-alternate-action><a id=forgot-details-link class=anchor-cursor ng-click=forgotDetails()>Forgot your details?</a></p> <fw-error-message value=signInForm.message id=sign-in-message></fw-error-message> </form-body> <form-buttons> <button id=sign-in-button class="btn btn-success btn-block" type=submit data-event-title="Signed in" data-event-category=Sign-in data-loading-text="Signing In..." fw-form-submit=signIn()>Continue</button> </form-buttons> </fw-form-modal> </form>'),a.put("modules/newsfeed/newsfeed.html","<fw-post-list source=timeline></fw-post-list>"),a.put("modules/notifications/notifications.html","<fw-panel12> <h4 class=text-suffix>No new notifications</h4> <p>You have no new notifications.</p> </fw-panel12>"),a.put("modules/payments/fw-account-balance-warning.html",'<fw-panel12 ng-if="model.isLoaded && displayingAccountBalanceWarning"> <h4>Update Payment Information</h4> <fw-error-message ng-if=model.paymentFailed value="\'Your current payment information could not be used.\'"> </fw-error-message> <fw-error-message value=model.errorMessage></fw-error-message> <fw-update-payment-information></fw-update-payment-information> <div class="bs-callout-primary account-balance-warning"> <h4 ng-if=!model.hasPaymentInformation>We do not have any payment information for you.</h4> <h4 ng-if=model.hasPaymentInformation>You currently have no credit in your account.</h4> <p ng-if=model.hasFreeAccessBlogs>You will still be able to see posts from profiles if you are on their guest list.</p> <p>We will use your payment information to top up your account with enough credit for your current Fifthweek subscriptions. When your credit runs out, we will automatically top you up again.</p> <p>If your total subscriptions come to less than our minimum charge of <fw-price value=500 show-interval=false></fw-price>, then we will top you up with <fw-price value=500 show-interval=false></fw-price> instead.</p> </div> </fw-panel12>'),a.put("modules/payments/fw-update-payment-information-country-failure.html",'<p> Unfortunately we cannot take payment from you at the moment as we cannot confirm your location, which we require to fulfill our tax obligations. </p> <p> Please try again using a credit card which was issued in your country of residence, or when you are using a computer in your country of residence. </p> <button id=try-again-button class="btn btn-block btn-default" ng-click=cancel()>Try Again</button>'),a.put("modules/payments/fw-update-payment-information-country.html",'<form novalidate id=form role=form name=form> <p><strong>Country of Residence</strong></p> <div ng-repeat="country in model.creditRequestSummary.calculation.possibleCountries"> <button type=submit id=select-country-{{$index}} class="btn btn-block btn-success country-selection-button" data-loading-text=Verifying... data-event-title="Country Code saved" data-event-category="Payment information" fw-form-submit=confirmCountry(country.countryCode) can-submit=true ng-disabled=form.isSubmitting error-message=model.errorMessage>{{country.name}}</button> </div> <button type=submit id=select-country-other class="btn btn-block btn-default" data-loading-text=Verifying... data-event-title="Country Code saved" data-event-category="Payment information" fw-form-submit=failConfirmCountry() can-submit=true ng-disabled=form.isSubmitting error-message=model.errorMessage>I live in another country</button> </form>'),a.put("modules/payments/fw-update-payment-information-form.html",'<form novalidate id=updatePaymentInformationForm role=form name=updatePaymentInformationForm> <fw-form-group> <div class=row> <div class="col-sm-6 col-ss-8"> <div fw-form-input-glyphs> <input id=cc-number type=tel class="form-control cc-number" ng-class=form.creditCardNumber.$card.type name=creditCardNumber placeholder="Card number" payments-validate=card payments-format=card payments-type-model=type autocomplete=cc-number ng-model=model.input.creditCardNumber required> </div> </div> </div> </fw-form-group> <div class=row> <div class="col-sm-3 col-ss-4 col-xs-6"> <fw-form-group> <div fw-form-input-glyphs> <input id=cc-exp type=tel class="form-control cc-exp" name=expiry placeholder="MM / YY" payments-validate=expiry payments-format=expiry autocomplete=cc-exp ng-model=model.input.expiry required> </div> </fw-form-group> </div> <div class="col-sm-3 col-ss-4 col-xs-6"> <fw-form-group> <div fw-form-input-glyphs> <input id=cc-cvc type=tel class="form-control cc-cvc" name=cvc placeholder=CVC payments-validate=cvc payments-format=cvc payments-type-model=type autocomplete=off ng-model=model.input.cvc required> </div> </fw-form-group> </div> </div> <button type=submit id=update-payment-information-button class="btn btn-block btn-success" data-loading-text=Verifying... data-event-title="Payment information saved" data-event-category="Payment information" fw-form-submit=submit() error-message=model.errorMessage>Continue</button> </form>'),a.put("modules/payments/fw-update-payment-information-success.html","<p>SUCCESS</p>"),a.put("modules/payments/fw-update-payment-information-transaction.html",'<form novalidate id=form role=form name=form> <p ng-if="model.creditRequestSummary.calculation.amount === model.creditRequestSummary.subscriptionsAmount"> We will top up your account with <strong><fw-price value=model.creditRequestSummary.calculation.amount show-interval=false></fw-price></strong> to cover your week\'s subscriptions. Once this has run down, we will automatically top up your account again. </p> <p ng-if="model.creditRequestSummary.calculation.amount !== model.creditRequestSummary.subscriptionsAmount"> We will top up your account with <strong><fw-price value=model.creditRequestSummary.calculation.amount show-interval=false></fw-price></strong>, which is our minimum charge. Once this has run down, we will automatically top up your account again. </p> <p ng-if="model.creditRequestSummary.calculation.amount !== model.creditRequestSummary.calculation.totalAmount"> As you are in the {{model.creditRequestSummary.calculation.countryName}}, we are required to charge you VAT of {{model.creditRequestSummary.calculation.taxRate}}%. The total amount charged to your credit card will therefore be <strong><fw-price value=model.creditRequestSummary.calculation.totalAmount show-interval=false></fw-price></strong> including VAT. </p> <button type=submit id=confirm-transaction-button class="btn btn-block btn-success" data-loading-text="Please wait..." data-event-title="Transaction confirmed" data-event-category="Payment information" fw-form-submit=confirmTransaction() can-submit=true error-message=model.errorMessage>Confirm</button> </form>'),a.put("modules/payments/fw-update-payment-information.html",'<div class=payment-information-form> <fw-error-message value=model.errorMessage></fw-error-message> <div ng-show=model.success id=payment-information-updated-notification class="alert alert-success"> <p>Your payment information has been updated.</p> </div> <div ng-if="model.mode === modes.paymentInformation" ng-include="\'modules/payments/fw-update-payment-information-form.html\'"></div> <div ng-if="model.mode === modes.countryVerification" ng-include="\'modules/payments/fw-update-payment-information-country.html\'"></div> <div ng-if="model.mode === modes.transactionVerification" ng-include="\'modules/payments/fw-update-payment-information-transaction.html\'"></div> <div ng-if="model.mode === modes.countryFailure" ng-include="\'modules/payments/fw-update-payment-information-country-failure.html\'"></div> <div ng-if="model.mode === modes.success" ng-include="\'modules/payments/fw-update-payment-information-success.html\'"></div> </div>'),a.put("modules/payments/update-payment-information.html",'<fw-panel12 ng-if=model.accountBalance> <p> Your account balance is currently <strong><fw-price value=model.accountBalance show-interval=false id=account-balance></fw-price></strong>. </p> </fw-panel12> <fw-panel12> <h4>Update Payment Information</h4> <fw-update-payment-information></fw-update-payment-information> </fw-panel12> <fw-panel12 id=no-payment-information-panel ng-if=!model.hasPaymentInformation> <p> We do not currently have any payment information for you. </p> </fw-panel12> <fw-panel12 id=delete-payment-information-panel ng-if=model.hasPaymentInformation> <h4>Delete Payment Information</h4> <p> Deleting your payment information will mean we can no longer automatically top up your account with credit. </p> <p> Once your existing credit has run out, unless you have provided us with new payment information, you will no longer have access to your subscriptions. </p> <p> <fw-form-input-delete item-type="Payment Information" link-id=delete-payment-information-link data-event-title="Payment information deleted" data-event-category="Update payment information" delete=deletePaymentInformation();></fw-form-input-delete> </p> </fw-panel12>'),a.put("modules/posts/creator-welcome-message.html",'<h4>Welcome to Publishing on Fifthweek!</h4> <p> The menu has now been expanded to give you access to additional publishing areas. </p> <p> This page will display your live posts once you have created some content. </p> <p> First we suggest you view your public profile by selecting "View Profile" from the menu, and then customize it to encourage people to subscribe. </p> <p> Whenever you are ready you can start adding posts using the "New Post" menu item. Live posts will appear here, and you can view any posts scheduled for a future date in the "Scheduled Posts" area. </p> <p> Finally you can start sharing your profile and bringing people on board. The link to your profile is shown on the Edit Profile page. Remember, people are only billed for weeks in which you post content. </p>'),a.put("modules/posts/full-size-image-modal.html",'<div class=modal-body ng-click=$close()> <a ng-click=$close()> <div class="image-button image-button-close"> <i class="fa fa-close"></i> </div> </a> <a ng-click=openFile(image)> <div class=image-button> <i class="fa fa-external-link"></i> </div> </a> <img ng-src={{imagePath}} class="img-responsive"> </div>'),a.put("modules/posts/fw-full-post.html",'<div class=full-post-dialog id=full-post> <div class=modal-title id=modal-title ng-if=isDialog> <a id=post-cross-button class=btn-close href ng-click=closeDialog() ng-if=isDialog> <i class="fa fa-close"></i> </a> <div class=info> <a ng-click=closeIfDialog() class=author ui-sref="landingPage({username: post.creator.username, action: null, key: null})"> <img class=author-image ng-if=post.creator.profileImage ng-src="{{post.creator.profileImage.resolvedUri}}"> <img class=author-image ng-if=!post.creator.profileImage ng-src="{{fifthweekConstants.defaultProfileImageUrl}}"> </a> <ul ng-if=!post> <li>Loading Post...</li> </ul> <ul ng-if=post> <li> <a ng-click=closeIfDialog() ui-sref="landingPage({username: post.creator.username, action: null, key: null})" class=poster-name>{{post.blog.name}}</a> </li> <li ng-if="post.blog.name !== post.channel.name"> <a ng-click=closeIfDialog() ui-sref="landingPage({username: post.creator.username, action: landingPageConstants.actions.channel, key: post.channelId })" class=container-name> {{post.channel.name}} </a> </li> <li> <span ng-if=post.isScheduled>Live in </span> <span class=live-in-info>{{post.liveIn}}</span> </li> </ul> </div> </div> <div ng-if=!isDialog> <div class=row> <div class=col-xs-12> <p class=live-date-information> <span ng-if=!post.isScheduled>Posted to </span> <span ng-if=post.isScheduled>Live in </span> <a ng-click=closeIfDialog() ui-sref="landingPage({username: post.creator.username, action: landingPageConstants.actions.channel, key: post.channelId })" class=container-name> {{post.channel.name}} </a> <span class=live-in-info>{{post.liveIn}}</span> </p> </div> </div> </div> <div class=post-additional-content ng-if="post.creator.username && (!post.readAccessIgnoringPayment || !post.priceAccepted)"> <div class=row> <div class=col-xs-12> <div class=requires-subscription-description> <p ng-if=!post.readAccessIgnoringPayment> This post requires a subscription to <a ng-click=closeIfDialog() ui-sref="landingPage({username: post.creator.username, action: null, key: null})">{{post.channel.name}}</a>. </p> <p ng-if="post.readAccessIgnoringPayment && !post.readAccess && !post.priceAccepted"> The price of <strong>{{post.channel.name}}</strong> has increased. You must accept the new price to continue accessing this channel. </p> </div> <fw-post-subscription-information username={{post.creator.username}} required-channel-id={{post.channelId}}></fw-post-subscription-information> </div> </div> </div> <div ng-if=post.isPreview class="post-additional-content request-free-post-content"> <fw-panel12> <div class=free-post-description> <div ng-if=!model.userId> <p>Sign in and get two free posts every week.</p> </div> <div ng-if="model.userId && !post.freePostsRemaining"> <p>You have used all your free posts for this week.</p> </div> <div ng-if="model.userId && post.freePostsRemaining"> <p>You have {{post.freePostsRemaining === 1 ? \'one free post\' : post.freePostsRemaining + \' free posts\'}} remaining this week.</p> </div> </div> <div class=free-post-button-container> <form name=form> <button type=submit id=request-free-post-button class="btn btn-block btn-success" can-submit=true ng-disabled="(model.userId && !post.freePostsRemaining) || form.isSubmitting" error-message=model.errorMessage data-loading-text=Requesting... fw-form-submit=requestFreePost()> Read for Free </button> </form> </div> </fw-panel12> </div> <div ng-if=post.isFreePost class="post-additional-content free-post-content"> <fw-panel12> <p>This is one of your free posts.</p> </fw-panel12> </div> <div class=post-additional-content> <fw-account-balance-warning displaying-account-balance-warning=model.displayingAccountBalanceWarning ng-if=post></fw-account-balance-warning> </div> <div class=post-additional-content> <fw-error-message value=model.errorMessage></fw-error-message> </div> <div class="posts full-post-container"> <div ng-if=model.isLoading class=updating-area> <i class="fa fa-refresh fa-spin"></i> </div> <div data-live-date={{post.liveDate}} class="post timeline-post" ng-if=post> <div class=post-blocks> <div ng-repeat="block in post.blocks" class=post-block> <div ng-if="block.type === \'text\'" class=text> <span fw-markdown ng-model=block.data.text></span> </div> <div ng-if="block.type === \'file\'" class=text> <p> <span ng-if=!post.readAccess class=file-content>{{block.source.fileName}}.{{block.source.fileExtension}}</span> <a ng-if=post.readAccess class="btn-file-download file-content" ng-click=openFile(block.information)> {{block.source.fileName}}.{{block.source.fileExtension}} </a> <span class=file-size>{{block.source.readableSize}}</span> </p> </div> <div ng-if="block.type === \'image\'" class=post-visual> <div class=full-width-image-container ng-style="block.renderSizeMaximumWidth ? { \'max-width\': block.renderSizeMaximumWidth + \'px\' } : {}"> <div ng-style="{\'padding-top\': block.renderSizeRatio}"></div> <img class=full-width-image ng-class="{\'read-access-image\': post.readAccess && !post.isFreePost}" ng-if=block.information ng-src={{block.information.resolvedUri}} ng-click="post.readAccess && !post.isFreePost && viewImage(block.information, block.source)"> </div> </div> <div ng-if="block.type === \'video\'" class=post-visual> <div ng-if="block.data.source === \'vimeo\' || block.data.source === \'youtube\'" class=video> <embed-video data-ng-href="{{block.data.source === \'vimeo\' ? \'https://vimeo.com/\' : \'https://youtube.com/watch?v=\'}}{{block.data.remote_id}}" rel=0 autohide=1 frameborder=0 showinfo=0></embed-video> </div> </div> <div ng-if="block.type === \'break\'"> <p class=post-break-line></p> </div> </div> </div> <hr> <div class="post-footer-actions post-section-narrow-border"> <span class=like-comment-buttons ng-if=post.readAccess> <span> <a ng-click=toggleLikePost(post)>{{post.hasLiked ? \'Unlike\' : \'Like\'}}</a> </span> <span ng-if=!post.isFreePost> <a ng-click=commentOnPost(post)>Comment</a> </span> <span ng-if=post.isFreePost> <a ng-click=viewComments(post)>View Comments</a> </span> </span> <span class=like-comment-buttons ng-if=!post.readAccess> <span> <a ng-click=viewComments(post)>View Comments</a> </span> </span> <span class=like-comment-counters> <span class=likes-count ng-class="{ \'has-liked\': post.hasLiked, \'has-not-liked\': !post.hasLiked }"> {{post.likesCount}} </span> <span class=comments-count> {{post.commentsCount}} </span> </span> </div> <hr> </div> <div class=post-buttons-container> <button id=close-post-button ng-if=isDialog class="btn btn-block btn-success" ng-click=closeDialog()>Close</button> <button id=more-posts-button class="btn btn-block btn-success" ng-click=closeIfDialog() ui-sref="landingPage({username: post.creator.username, action: null, key: null})">More from this author</button> </div> <p class=share-post-link> Share this post: <a ng-click=closeIfDialog() ui-sref="landingPage({username: post.creator.username, action: landingPageConstants.actions.post, key: post.postId})"> {{fifthweekConstants.websiteRoot + post.creator.username + \'/post/\' + post.postId}} </a> </p> </div> </div>'),a.put("modules/posts/fw-post-list-header.html","<fw-error-message value=model.errorMessage></fw-error-message> <div class=posts-header ng-if=model.channelName> <p>Showing channel <strong>{{model.channelName}}</strong>.</p> </div>"),a.put("modules/posts/fw-post-list-information.html",'<div class=post-list-information> <fw-panel12 ng-if=model.updatedPrices.length class=price-information> <fw-error-message value=model.errorMessage></fw-error-message> <div class=price-row ng-repeat="updatedPrice in model.updatedPrices" id=updated-price-{{$index}}> <div class=row> <div class="col-xs-12 col-ss-7"> <div ng-if=updatedPrice.isIncrease class=channel-price-increase> <p>The channel price of <strong>{{updatedPrice.channel.name}}</strong> <span ng-if="updatedPrice.channel.name !== updatedPrice.blog.name"> in <strong>{{updatedPrice.blog.name}}</strong></span> has increased from <fw-price value=updatedPrice.channel.acceptedPrice></fw-price> to <fw-price value=updatedPrice.currentPrice></fw-price> <span ng-if=!updatedPrice.channel.acceptedPrice> because you are no longer on the guest list</span>. Please accept the new price to continue receiving this content. </p> </div> <div ng-if=!updatedPrice.isIncrease class=channel-price-decrease> <p>The channel price of <strong>{{updatedPrice.channel.name}}</strong> <span ng-if="updatedPrice.channel.name !== updatedPrice.blog.name"> in <strong>{{updatedPrice.blog.name}}</strong></span> has been reduced from <fw-price value=updatedPrice.channel.acceptedPrice></fw-price> to <fw-price value=updatedPrice.currentPrice></fw-price> <span ng-if=!updatedPrice.currentPrice> because you are on the guest list</span>. </p> </div> </div> <div class="col-xs-12 col-ss-5 text-right"> <div ng-if=updatedPrice.isIncrease> <button class="btn btn-success btn-block" ng-click=acceptPrice(updatedPrice)>Accept</button> <button class="btn btn-default btn-block" ng-click=manageSubscription(updatedPrice) ng-if=!userId>Manage</button> </div> <div ng-if=!updatedPrice.isIncrease> <button class="btn btn-success btn-block" ng-click=acceptPrice(updatedPrice)>Okay</button> <button class="btn btn-default btn-block" ng-click=manageSubscription(updatedPrice) ng-if=!userId>Manage</button> </div> </div> </div> </div> </fw-panel12> </div>'),
a.put("modules/posts/fw-post-list.html",'<div class=posts ng-class="{ \'tagged-posts\': source !== sources.timeline || userId }"> <fw-post-list-information source={{source}} user-id={{userId}}></fw-post-list-information>  <fw-error-message value=model.errorMessage></fw-error-message> <div ng-if="source === sources.timeline || source === sources.preview"> <fw-account-balance-warning displaying-account-balance-warning=model.displayingAccountBalanceWarning></fw-account-balance-warning> </div> <div ng-if="model.isLoading && !model.errorMessage" class=updating-area> <i class="fa fa-refresh fa-spin"></i> </div> <div ng-if=!model.isLoading> <div ng-if="model.posts.length === 0"> <fw-panel12 ng-if="source === sources.creatorBacklog" class=no-posts-message> <h4>Nothing scheduled</h4> <p>The schedule makes it easy for you to provide a steady flow of posts to your subscribers.</p> <p>Use this feature by clicking \'Schedule\' when creating a post.</p> </fw-panel12> <fw-panel12 ng-if="source === sources.creatorTimeline" class=no-posts-message> <div ng-include="\'modules/posts/creator-welcome-message.html\'"></div> </fw-panel12> <fw-panel12 ng-if="source === sources.timeline && userId && !model.displayingAccountBalanceWarning" class=no-posts-message> <h4>This creator has not released any posts</h4> <p>Don\'t panic! You will only be billed for the weeks where you receive content.</p> <p>Hopefully something will come along shortly :)</p> </fw-panel12> <fw-panel12 ng-if="source === sources.timeline && !userId && !model.displayingAccountBalanceWarning" class=no-posts-message> <h4>There are no posts to display.</h4> <p>Once you have subscribed to some creators, their posts will appear on this page.</p> <p>If you have subscribed already, don\'t panic! You will only be billed for the weeks where you receive content.</p> <p>Hopefully something will come along shortly :)</p> </fw-panel12> <fw-panel12 ng-if="source === sources.preview" class=no-posts-message> <h4>No posts available.</h4> </fw-panel12> </div> <div ng-repeat="post in model.posts track by post.postId" ng-include="\'modules/posts/post.html\'" id=post-{{$index}}></div> </div> </div> '),a.put("modules/posts/post-dialog.html",'<fw-full-post post=post update-like-status="updateLikeStatus(likesCount, hasLiked)" update-comments-count=updateCommentsCount(totalComments) close-dialog="$close()">'),a.put("modules/posts/post-edit-dialog.html",'<form novalidate role=form name=editPostForm class=edit-post-form> <fw-form-dirty-confirmation form=editPostForm is-modal=true></fw-form-dirty-confirmation> <fw-form-modal name="Edit Post"> <form-body> <div ng-if=model.isLoading class=updating-area> <i class="fa fa-refresh fa-spin"></i> </div> <div ng-if=model.showContent> <fw-form-group input-name=content> <div class=row> <div class=col-xs-12> <fw-sir-trevor-editor maxlength=50000 ng-model=model.input.content editor-id=content channel-id={{model.channelId}} name=content placeholder="Say something, if you like"></fw-sir-trevor-editor> </div> <div class=col-xs-12> <p fw-form-input-invalid-p=required>Please write some content.</p> </div> </div> </fw-form-group> <div class=form-group> <fw-form-subsection name="Release time"> <summary> <p ng-if="model.savedScheduleMode === scheduleModes.now">This post has been released.</p> <p ng-if="model.savedScheduleMode !== scheduleModes.now">Currently scheduled for <strong>{{model.savedDate | date:fifthweekConstants.longDateTimeFormat:\'UTC\'}}</strong>.</p> </summary> <section> <div class=radio> <label><input type=radio ng-model=model.input.scheduleMode ng-value="scheduleModes.now"> {{model.savedScheduleMode === scheduleModes.now ? \'No change\' : \'Post now\'}}</label> </div> <div ng-if=model.queues.length> <div class=radio> <label><input type=radio ng-model=model.input.scheduleMode ng-value="scheduleModes.queued"> Schedule with queue <span ng-if="model.savedScheduleMode !== scheduleModes.queued">(will appear <strong>{{model.queuedLiveDate | date:fifthweekConstants.longDateTimeFormat:\'UTC\'}}</strong>)</span> :</label> </div> <fw-form-input-select-queue items=model.queues selected-item=model.input.selectedQueue></fw-form-input-select-queue> </div> <div class=radio> <label><input type=radio ng-model=model.input.scheduleMode ng-value="scheduleModes.scheduled"> Schedule for specific time (UTC):</label> </div> <fw-form-input-date-time-picker ng-model=model.input.date></fw-form-input-date-time-picker> </section> </fw-form-subsection> </div> </div> <fw-error-message value=model.errorMessage></fw-error-message> </form-body> <form-buttons> <button ng-if=model.showContent id=save-post-button class="btn btn-block btn-success" data-loading-text=Saving... data-event-title="Backlog post edited" data-event-category="Edited post" fw-form-submit=save() ng-disabled=model.isProcessing error-message=model.errorMessage> <span ng-if=model.isProcessing>Processing...</span> <span ng-if="!model.isProcessing && model.savedScheduleMode === scheduleModes.now">{{model.input.scheduleMode === scheduleModes.now ? \'Save\' : \'Schedule\'}}</span> <span ng-if="!model.isProcessing && model.savedScheduleMode !== scheduleModes.now">{{model.input.scheduleMode === scheduleModes.now ? \'Post Now\' : \'Save\'}}</span> </button> </form-buttons> </fw-form-modal> </form>'),a.put("modules/posts/post.html",'<div data-live-date={{post.liveDate}} class="post timeline-post"> <div class="row info-actions post-section-narrow-border"> <div class="col-xs-10 info"> <a class=author ui-sref="landingPage({username: post.creator.username, action: landingPageConstants.actions.manage, key: null})"> <img class=author-image ng-src="{{post.creator.profileImage ? post.creator.profileImage.resolvedUri : fifthweekConstants.defaultProfileImageUrl}}"> </a> <ul> <li> <a ui-sref="landingPage({username: post.creator.username, action: landingPageConstants.actions.manage, key: null})" class=poster-name>{{post.blog.name}}</a> </li> <li ng-if="post.blog.name !== post.channel.name"> <a ng-click=closeIfDialog() ui-sref="landingPage({username: post.creator.username, action: landingPageConstants.actions.channel, key: post.channelId })" class=container-name> {{post.channel.name}} </a> </li> <li> <span ng-if=post.isScheduled>Live in </span> <a ng-if=post.isOwner ng-click=editPost(post) class="live-in-info live-in-link">{{post.liveIn}}</a> <span ng-if=!post.isOwner class=live-in-info>{{post.liveIn}}</span> </li> </ul> </div> <div class="col-xs-2 actions" ng-if=post.isOwner> <ul> <li class=actions-more> <span class=dropdown dropdown on-toggle=toggled(open)> <button class=dropdown-toggle dropdown-toggle> <i class="fa fa-chevron-down"></i> </button> <ul class=dropdown-menu> <li><a ng-click=editPost(post)>Edit</a></li> <li ng-if="post.isScheduled && post.scheduledByQueue"><a ng-click=post.reorder()>Reorder</a></li> <li> <fw-delete-link item-type=Post event-title="Post deleted" event-category={{sourceName}} delete=deletePost(post.postId)> Delete </fw-delete-link> </li> </ul> </span> </li> </ul> </div> </div> <div ng-if=post.isScheduled> <p class=tag ng-if=!post.queueId>Scheduled, {{post.liveDate | date:fifthweekConstants.newsfeedDateFormat:\'UTC\'}}</p> <p class=tag ng-if=post.queueId>Queued, {{post.liveDate | date:fifthweekConstants.newsfeedDateFormat:\'UTC\'}}</p> </div> <div ng-if=!post.isScheduled> <p class=tag ng-if=!post.readAccess>Preview</p> <p class=tag ng-if="post.readAccess && post.isSubscribed">Subscribed</p> <p class=tag ng-if="post.readAccess && !post.isSubscribed && post.isGuestList">Guest List</p> <p class=tag ng-if="post.readAccess && !post.isSubscribed && !post.isGuestList && post.isFreePost">Free Post</p> </div> <hr> <div class=post-blocks> <div class=post-block> <div ng-if=post.image class=post-visual> <div class=full-width-image-container ng-style="post.renderSizeMaximumWidth ? { \'max-width\': post.renderSizeMaximumWidth + \'px\' } : {}"> <div ng-style="{\'padding-top\': post.renderSizeRatio}" ng-if=post.renderSizeRatio></div> <img class=full-width-image ng-class="{\'read-access-image\': post.readAccess && !post.isFreePost}" ng-src={{post.image.resolvedUri}} ng-click="post.readAccess && !post.isFreePost && viewImage(post.image, post.imageSource)"> </div> </div> <div ng-if=post.previewText class=text> <span fw-markdown id=post-comment ng-model=post.previewText ng-if=post.previewText></span> <p ng-if=post.readingTime> <i>Continued</i> </p> </div> </div> </div> <hr> <div class="post-footer-actions post-section-narrow-border"> <span class=read-more-actions> <span> <a id=open-post-link ng-click=viewPost(post)>{{post.readingTime ? \'Read more\' : \'Open post\' }}</a> </span> <span class=minutes-count ng-if=post.readingTime> {{post.readingTime}} min </span> <span class=image-count ng-if=post.imageCount> {{post.imageCount == 1 ? \'1 image\' : post.imageCount + \' images\'}} </span> <span class=file-count ng-if=post.fileCount> {{post.fileCount == 1 ? \'1 file\' : post.fileCount + \' files\'}} </span> <span class=video-count ng-if=post.videoCount> {{post.videoCount == 1 ? \'1 video\' : post.videoCount + \' videos\'}} </span> </span> <span class=like-comment-counters> <span class=likes-count ng-class="{ \'has-liked\': post.hasLiked, \'has-not-liked\': !post.hasLiked }"> {{post.likesCount}} </span> <span class=comments-count> {{post.commentsCount}} </span> </span> </div> </div>'),a.put("modules/queues/directives/form-input-queue-name.html","<fw-form-group input-name=queueName> <div class=row> <div class=col-{{breakpoint}}-6> <div fw-form-input-glyphs> <input id={{inputId}} ng-model=ngModel[ngModelAccessor] name=queueName class=form-control placeholder={{placeholder}} ng-maxlength=50 maxlength=50 ng-focus=focus ng-required=required> </div> </div> <div class=col-{{breakpoint}}-6> <p fw-form-input-invalid-p=maxlength>Allowed 50 characters at most.</p> <span ng-if=required> <p fw-form-input-invalid-p=required>A name is required.</p> </span> </div> </div> </fw-form-group>"),a.put("modules/queues/directives/form-input-select-queue.html",'<div class="form-group form-input-select-queue"> <div class=row> <div class="col-xs-12 col-s-6"> <div class=select> <select id={{inputId}} class=select-full-width ng-model=selectedItem ng-options="item.name for item in items"></select> </div> </div> </div> </div>'),a.put("modules/queues/edit-queue.html",'<div class=page-blog-queues-manage> <form novalidate id=manageQueueForm name=manageQueueForm role=form ng-show="!model.addingReleaseTime && !model.selectedReleaseTime"> <fw-breadcrumb current={{model.savedName}}></fw-breadcrumb> <fw-panel12> <label>Name</label> <fw-form-input-queue-name ng-model=model.name placeholder="Queue name" required focus></fw-form-input-queue-name> <div class=form-group id=manageReleaseTimes> <fw-form-subsection name="Weekly release schedule"> <summary> <p class=release-times> <span class=release-time ng-repeat="time in model.schedule">{{time.day}}</span> </p> </summary> <summary-expanded> <p> When you add posts to a queue they automatically become published according to the weekly schedule that is associated with the queue you are posting to. You can define that here: </p> </summary-expanded> <section> <fw-managed-list-sm id=release-time-list item-name="release time" items=model.schedule new-item=addReleaseTime() manage-item=manageReleaseTime(item)> <p>{{item.day}} <span class=release-time-of-day>@ {{item.time}} UTC</span></p> </fw-managed-list-sm> </section> </fw-form-subsection> </div> <div class=row-btn> <div class=row> <div class=col-s-8> <button id=save-queue-button class="btn btn-block btn-success" data-loading-text=Saving... data-event-title="Queue edited" data-event-category=Customization ng-disabled="!mainFormDirty() || manageQueueForm.isSubmitting" can-submit="manageQueueForm.$valid && mainFormDirty()" fw-form-submit=save()>Save Changes</button> <button id=cancel-button class="btn btn-default btn-block" ui-sref={{previousState}} ng-click=manageQueueForm.discard()>Cancel</button> </div> <div class=col-s-4> <fw-form-input-delete item=model.savedName item-type=Queue link-id=delete-queue-link data-event-title="Queue deleted" data-event-category=Customization delete="manageQueueForm.discard(); delete()"></fw-form-input-delete> </div> </div> </div> <div ng-show=manageQueueForm.message class="alert alert-danger sub-form-alert"> <p>{{manageQueueForm.message}}</p> </div> </fw-panel12> <fw-form-dirty-confirmation form=manageQueueForm form-dirty=mainFormDirty></fw-form-dirty-confirmation> </form>  <form novalidate role=form name=newReleaseTimeForm ng-if=model.addingReleaseTime> <fw-breadcrumb current="New Release Time" previous={{model.savedName}} previous-state="model.addingReleaseTime = false"></fw-breadcrumb> <fw-panel12> <fw-form-input-hour-of-week ng-model=model.hourOfWeek></fw-form-input-hour-of-week> <button id=add-release-time-button class="btn btn-block btn-success" ng-click=saveNewReleaseTime()>Add Release Time</button> <button id=cancel-release-time-button class="btn btn-default btn-block" ng-click="model.addingReleaseTime = false">Cancel</button> </fw-panel12> </form>  <form novalidate role=form name=manageReleaseTimeForm ng-if=model.selectedReleaseTime> <fw-breadcrumb current="Edit Release Time" previous={{model.savedName}} previous-state="model.selectedReleaseTime = null"></fw-breadcrumb> <fw-panel12> <fw-form-input-hour-of-week ng-model=model.hourOfWeek></fw-form-input-hour-of-week> <div class=row> <div class=col-s-8> <button id=save-release-time-button class="btn btn-block btn-success" ng-disabled="manageReleaseTimeForm.$pristine || manageReleaseTimeForm.isSubmitting" ng-click=saveReleaseTime()>Update Release Time</button> <button id=cancel-release-time-button class="btn btn-default btn-block" ng-click="model.selectedReleaseTime = null">Cancel</button> </div> <div class=col-s-4> <fw-form-input-delete ng-if="model.schedule.length > 1" item-type="Release Time" link-id=delete-release-time-link delete=deleteReleaseTime()></fw-form-input-delete> </div> </div> </fw-panel12> </form> </div>'),a.put("modules/queues/list-queues.html",'<fw-managed-list id=queues ng-if=!model.errorMessage item-name=queue items=model.queues new-item-state=creator.queues.new manage-item-state=creator.queues.edit> <h5> <a class=queue-name href>{{item.name}}</a> </h5> <p class=release-times> <span ng-repeat="time in item.schedule | orderBy:\'sortKey\'">{{time.day}}</span> </p> </fw-managed-list> <div ng-if=model.errorMessage class="alert alert-danger sub-form-alert"> <p>{{model.errorMessage}}</p> </div>'),a.put("modules/queues/new-queue.html",'<fw-breadcrumb current="New Queue"></fw-breadcrumb> <fw-panel12> <form novalidate role=form id=createQueueForm name=form> <fw-form-input-queue-name ng-model=model.queue.name placeholder="New queue name" required focus></fw-form-input-queue-name> <div class=row-btn> <button id=create-queue-button class="btn btn-block btn-success" data-loading-text=Creating... data-event-title="Queue created" data-event-category=Customization fw-form-submit=createQueue()>Create Queue</button> <button id=cancel-button class="btn btn-default btn-block" ui-sref={{previousState}}>Cancel</button> </div> <div ng-show=form.message class="alert alert-danger sub-form-alert"> <p>{{form.message}}</p> </div> </form> </fw-panel12>'),a.put("modules/registration/register.html",'<div> <form novalidate autocomplete=off role=form name=form id=registrationForm> <fw-panel12> <div ng-show=!registrationSucceeded> <div class=input-wrap> <fw-form-group> <div class=row> <div class=col-md-6> <div fw-form-input-glyphs> <input id=registrationData-email ng-model=registrationData.email type=email class=form-control name=email placeholder=Email required> </div> </div> <div class=col-md-6> <p fw-form-input-invalid-p>A valid email address is required.</p> </div> </div> </fw-form-group> <fw-form-input-username ng-model=registrationData.username breakpoint=md required></fw-form-input-username> <fw-form-input-password ng-model=registrationData.password placeholder=Password breakpoint=md required></fw-form-input-password> </div> <div class="row row-btn"> <div class=col-md-6> <button class="btn btn-success btn-block" type=submit id=register-button data-loading-text=Registering... data-event-title={{tracking.eventTitle}} data-event-category={{tracking.eventCategory}} fw-form-submit=register()>Create my account</button> </div> </div> </div> <div class=row> <div class=col-xs-12> <div id=messageBox ng-show=form.message ng-class="registrationSucceeded ? \'alert alert-success\' : \'alert alert-danger sub-form-alert\'"> <p>{{form.message}}</p> </div> </div> </div> </fw-panel12> </form> </div>'),a.put("modules/sir-trevor/fw-file-block.html",'<div class=row> <div class=col-xs-12 ng-show=model.fileUploaded> <p class=file-name>{{model.fileData.fileName}}</p> </div> <div class="col-s-6 col-s-offset-3 bottom-buffer"> <fw-file-upload id-prefix=file channel-id={{channelId}} description="{{model.fileUploaded ? \'Change File\' : \'Add File\'}}" on-upload-started=onUploadStarted() on-upload-complete=onUploadComplete(data) file-purpose=post-file accept=""></fw-file-upload> </div> </div>'),a.put("modules/sir-trevor/fw-image-block.html",'<div class=row> <div class="col-xs-12 bottom-buffer" ng-show=model.imageUploaded> <fw-blob-image control=blobImage file-id={{fileId}} container-name={{containerName}} render-size=renderSize thumbnail=preview></fw-blob-image> </div> <div class="col-s-6 col-s-offset-3 bottom-buffer"> <fw-file-upload id-prefix=image channel-id={{channelId}} description="{{model.imageUploaded ? \'Change Image\' : \'Add Image\'}}" on-upload-started=onUploadStarted() on-upload-complete=onUploadComplete(data) file-purpose=post-image accept=image/jpeg,image/gif,image/png></fw-file-upload> </div> </div>'),a.put("modules/sir-trevor/fw-sir-trevor-editor.html",'<fw-error-message value=model.errorMessage></fw-error-message> <div ng-if=isLoading class=updating-area> <i class="fa fa-refresh fa-spin"></i> </div> <div ng-if=!isLoading id={{editorId}} ng-class="{\'text-only-editor\':textOnly}"> <textarea class=js-st-instance>{{sirTrevorValue}}</textarea> <p class=light-grey ng-if="!maxlength || remaining > 100">Select text for formatting options.</p> <p class=light-grey ng-if="maxlength && remaining >= 0 && remaining <= 100">{{remaining}} character{{remaining === 1 ? \'\' : \'s\'}} remaining</p> <p class="help-block help-block" ng-if="maxlength && remaining < 0">Too long by {{-remaining}} character{{remaining === 1 ? \'\' : \'s\'}}</p> </div>'),a.put("modules/subscribers/view-subscribers.html",'<fw-error-message value=model.errorMessage></fw-error-message> <div ng-if="model.isLoading && !model.errorMessage" class=updating-area> <i class="fa fa-refresh fa-spin"></i> </div> <fw-panel12 ng-if="!model.isLoading && !model.errorMessage"> <p> You have <strong id=total-subscriptions>{{model.totalSubscriptions}}</strong> subscriptions from <strong id=total-subscribers>{{model.billableSubscribers}}</strong> subscribers. <span ng-if=model.unacceptablePrices><strong id=total-unacceptable-prices>{{model.unacceptablePrices}}</strong> subscriptions are inactive because the user has not accepted the current price.</span> </p> <p> Your total revenue to date is <strong><fw-price value="model.releasedRevenue + model.unreleasedRevenue" show-interval=false id=total-revenue></fw-price></strong>. </p> <p> <strong><fw-price value=model.releasedRevenue show-interval=false id=released-revenue></fw-price></strong> has already been paid out and <strong><fw-price value=model.releasableRevenue show-interval=false id=releasable-revenue></fw-price></strong> is available. </p> <p> Your estimated revenue for the next week is <strong><fw-price value=model.estimatedWeeklyRevenue show-interval=false id=estimated-weekly-revenue></fw-price></strong>. </p>  <table class=table ng-if=model.billableSubscribers> <thead> <tr> <th>Username <th>Channels <th>Subscribed <th>Price   <tbody> <tr ng-repeat="subscriber in model.subscribers | filter: { shouldDisplay: true }" class=subscriber-row id=subscriber-row-{{$index}}> <td><p>{{subscriber.username}}</p> <td><p ng-repeat="channel in subscriber.channels">{{channel.name}}</p> <td><p ng-repeat="channel in subscriber.channels">{{channel.subscriptionStartDate | date: \'d MMM yy\':\'UTC\'}}</p> <td><p ng-repeat="channel in subscriber.channels"> <i ng-if="!subscriber.freeAccessEmail && channel.isPaying" class="fa fa-check price-accepted-indicator"></i> <i ng-if="!subscriber.freeAccessEmail && !channel.isPaying" class="fa fa-times price-not-accepted-indicator"></i> <i ng-if=subscriber.freeAccessEmail class="fa fa-street-view guest-list-indicator"></i> </p>   </table> </fw-panel12>'),a.put("modules/subscriptions/view-subscriptions.html",'<fw-panel12> <fw-error-message value=model.errorMessage></fw-error-message> <p> Your account balance is currently <strong><fw-price value=model.accountBalance show-interval=false id=account-balance></fw-price></strong>. </p> <p> Your subscriptions cost <strong><fw-price value=model.totalAcceptedPrice id=subscriptions-cost></fw-price></strong>. </p> <p ng-if=model.totalChangedPrice> You have <strong><fw-price value=model.totalChangedPrice id=changed-prices-cost></fw-price></strong> worth of subscriptions whose prices have increased. You will not be billed for these until you accept the new price. </p> </fw-panel12> <fw-post-list-information source={{fwPostListConstants.sources.timeline}}></fw-post-list-information> <fw-panel12 ng-repeat="blog in model.blogs" class=blog-panel id=blog-panel-{{$index}}> <h4><a ui-sref="landingPage({username: blog.username, action: landingPageConstants.actions.manage, key: $state.current.name})" class=blog-link>{{blog.name}}</a></h4> <p ng-if=blog.freeAccess>You are on the guest list.</p> <table class=table ng-if=blog.channels.length> <thead> <tr> <th>Channel <th>Price <th>Week Starts (UTC)   <tbody> <tr ng-repeat="channel in blog.channels" class=channel-list-row id=channel-list-row-{{$index}}> <td> <p> <a ui-sref="landingPage({username: blog.username, action: landingPageConstants.actions.channel, key: channel.channelId})" class=channel-link>{{ channel.name }}</a> </p>  <td><p ng-if=blog.freeAccess>FREE</p><p ng-if=!blog.freeAccess><fw-price value=channel.price></fw-price></p> <td><p>{{ channel.subscriptionStartDate | date: \'EEE H:mm:ss\':\'UTC\' }}</p>   </table> <div class=row> <div class=col-xs-12> <button class="btn btn-default btn-block manage-button" ui-sref="landingPage({username: blog.username, action: landingPageConstants.actions.manage, key: $state.current.name})">Manage Subscription</button> </div> </div> </fw-panel12>'),a.put("views/coming-soon.html","<fw-panel12> <h4>Coming soon...</h4> <p>We are working hard on implementing this feature!</p> </fw-panel12>"),a.put("views/not-authorized.html",'<div class=row> <div class=col-lg-12> <div class="panel panel-default"> <div class="panel-body jumbo-panel">You are not authorized to view this page.</div> </div> </div> </div>'),a.put("views/not-found.html","<fw-panel12> <h4>Not Found</h4> <p>The page you requested could not be found.</p> </fw-panel12>"),a.put("views/partials/blob-image.html",'<div ng-controller=blobImageCtrl class=image-container> <div class=vertical-aspect-ratio></div> <div ng-if=model.imageUri class=thumbnail-area> <img ng-src={{model.imageUri}} class="image-area available-image" ng-style="model.renderSize"> </div> <div ng-if=model.errorMessage class="image-area error-area pending-image" ng-style=model.renderSize> <i class="fa fa-exclamation-circle"></i> </div> <div ng-if=model.updating class="image-area updating-area pending-image" ng-style=model.renderSize> <i class="fa fa-refresh fa-spin"></i> </div> <div ng-if="!model.updating && !model.imageUri && !model.errorMessage" class="image-area blank-area pending-image" ng-style=model.renderSize> <i class="fa fa-camera"></i> </div> </div>'),a.put("views/partials/breadcrumb.html",'<div class=row> <div class=col-xs-12> <h4 id=breadcrumb> <a class=item ui-sref={{rootState}}><i class={{rootIcon}}></i> {{rootName}}</a> <span ng-repeat="item in intermediateStates"> <i class="fa fa-angle-right"></i> <a class=item ng-click=item.click() href>{{item.name}}</a> </span> <span class=item> <i class="fa fa-angle-right"></i> <span>{{current}}</span> </span> </h4> </div> </div>'),a.put("views/partials/delete-link.html",' <a id={{linkId}} class={{class}} href ng-controller=deleteLinkCtrl ng-click=verifyDelete() ng-transclude=""></a>'),a.put("views/partials/delete-verification.html",'<form novalidate role=form name=verifiedDeleteForm ng-if=model.item> <fw-form-modal name="Delete {{model.itemType}}" id-prefix=delete-confirmation> <form-body> <h5>Are you ABSOLUTELY sure?</h5> <p> This action CANNOT be undone. This will permanently delete <strong id=delete-hint>{{model.item}}</strong>. All associated content and comments will be removed. </p> <div class=form-group> <label for=deletion-confirmation-text>Please type in the name of the {{model.itemTypeLowered}}</label> <input id=deletion-confirmation-text name=confirmationText ng-model=model.confirmationText class=form-control focus=true required> </div> <fw-error-message value=verifiedDeleteForm.message></fw-error-message> </form-body> <form-buttons> <button id=delete-item-verified-button class="btn btn-block btn-danger" data-loading-text=Deleting... data-event-title={{model.dataEventTitle}} data-event-category={{model.dataEventCategory}} ng-disabled="verifiedDeleteForm.isSubmitting || model.item !== model.confirmationText" fw-form-submit=confirmDelete()>I understand, delete this {{model.itemTypeLowered}}</button> </form-buttons> </fw-form-modal> </form> <form novalidate role=form name=unverifiedDeleteForm ng-if=!model.item> <fw-form-modal name="Delete {{model.itemType}}" id-prefix=delete-confirmation> <form-body> <div class=form-group> <p> Are you sure you want to delete this? </p> </div> <fw-error-message value=unverifiedDeleteForm.message></fw-error-message> </form-body> <form-buttons> <button id=delete-item-unverified-button class="btn btn-block btn-danger" data-loading-text=Deleting... data-event-title={{model.dataEventTitle}} data-event-category={{model.dataEventCategory}} can-submit=true fw-form-submit=confirmDelete()>Delete {{model.itemType}}</button> </form-buttons> </fw-form-modal> </form>'),a.put("views/partials/error-message.html",'<div ng-if=value class="alert alert-danger" ng-class=class> <p> {{value}} </p> </div>'),a.put("views/partials/file-upload.html","<div ng-controller=fileUploadCtrl class=btn-file-container> <div ng-if=!model.fileApiSupported id={{idPrefix}}-upload-not-supported-area> <label>Sorry, we do not support uploading files with your current browser.</label> </div> <div ng-if=model.fileApiSupported> <div ng-if=!model.isSubmitting id={{idPrefix}}-upload-button-area>  <span class=\"btn btn-default btn-block btn-file\">{{description || 'Upload'}}<input id={{idPrefix}}-upload-button-input type=file fw-file-input-on-change=upload(files) accept={{accept}}></span> </div> <div ng-if=model.isSubmitting class=progress-container id={{idPrefix}}-upload-progress-area> <progressbar value=model.progress type=success></progressbar> <p ng-if=abbreviateProgress class=progress-text>{{model.progress}}%</p> <p ng-if=!abbreviateProgress class=progress-text>Uploading: {{model.progress}}% complete</p> </div> <div class=has-error ng-if=model.errorMessage id={{idPrefix}}-upload-error-area> <p class=help-block> {{model.errorMessage}} </p> </div> </div> </div>"),a.put("views/partials/form-group.html","<div class=form-group ng-class=\"{\n     'has-error': input.$invalid && ((input.$touched && input.$dirty) || form.$submitted),\n     'has-success': input.$valid && ((input.$touched && input.$dirty) || form.$submitted)\n   }\" ng-transclude=parent> </div>"),a.put("views/partials/form-input-comment.html","<fw-form-group input-name=comment> <div class=row> <div class=col-xs-12> <fw-sir-trevor-editor maxlength=50000 ng-model=ngModel[ngModelAccessor] editor-id={{inputId}} name=comment ng-required=isRequired() ng-disabled=isDisabled() ng-focus=focus text-only=true placeholder={{placeholder}}></fw-sir-trevor-editor> </div> <div class=col-xs-12> <p fw-form-input-invalid-p=required>Please write some content.</p> </div> </div> </fw-form-group>"),a.put("views/partials/form-input-delete.html",'<div class=btn-delete-item> <hr class="visible-under-s"> <p class=btn-alternate-action> <fw-delete-link link-id={{linkId}} class=text-danger item=item item-type={{itemType}} data-event-title={{dataEventTitle}} data-event-category={{dataEventCategory}} delete=delete()> Delete {{itemType}} </fw-delete-link> </p> </div>'),a.put("views/partials/form-input-password.html","<fw-form-group input-name=password> <label ng-if=label for={{inputId}}>{{label}}</label> <div class=row> <div class=col-{{breakpoint}}-{{inputColumns}}> <div fw-form-input-glyphs> <input id={{inputId}} ng-model=ngModel[ngModelAccessor] name=password type=password class=form-control placeholder={{placeholder}} ng-minlength=6 ng-maxlength=100 maxlength=100 ng-focus=focus ng-required=required> </div> </div> <div class=col-{{breakpoint}}-{{inputColumns}}> <p fw-form-input-invalid-p=minlength>Must be at least 6 characters.</p> <p fw-form-input-invalid-p=maxlength>Allowed 100 characters at most.</p> <span ng-if=required> <p fw-form-input-invalid-p=required>A password is required.</p> </span> </div> </div> </fw-form-group>"),a.put("views/partials/form-input-select.html",'<div class=form-group> <div class=row> <div class="col-xs-12 col-s-7 col-sm-6"> <div class=select> <select id={{inputId}} class=select-full-width ng-disabled=ngDisabled ng-model=selectedItem ng-options="item.name for item in items"></select> </div> </div> </div> </div>'),a.put("views/partials/form-input-username.html",'<fw-form-group input-name=username> <label ng-if=label for={{inputId}}>{{label}}</label> <div class=row> <div class=col-{{breakpoint}}-{{inputColumns}}> <div fw-form-input-glyphs> <input id={{inputId}} class=form-control name=username placeholder=Username ng-model=ngModel[ngModelAccessor] ng-model-options="{ debounce: 500 }" ng-pattern="/^[a-zA-Z0-9_]+$/" ng-minlength=2 ng-maxlength=20 maxlength=20 ng-focus=focus ng-required=required fw-check-username-availability> </div> </div> <div class=col-{{breakpoint}}-{{inputColumns}}> <p fw-form-input-invalid-p=pattern>Letters, numbers and underscores only.</p> <p fw-form-input-invalid-p=minlength>Must be at least 2 characters.</p> <p fw-form-input-invalid-p=maxlength>Allowed 20 characters at most.</p> <p fw-form-input-invalid-p=required>A username is required.</p> <p ng-if=form.username.$pending.username class=help-block>Checking availability...</p> <p ng-if=form.username.$error.username class=help-block>This username is already taken!</p> </div> </div> </fw-form-group>'),a.put("views/partials/form-modal-title.html",'<h4 id=modal-title class=modal-title> <a id={{idPrefix}}-cross-button class=btn-close href ng-click=$close()> <i class="fa fa-close"></i> </a> {{name}} </h4>'),a.put("views/partials/form-modal.html",'<fw-form-modal-title name={{name}} id-prefix={{idPrefix}}></fw-form-modal-title> <div class="modal-body form-modal-body"> <form-body-placeholder></form-body-placeholder> </div> <div class=row-btn> <form-buttons-placeholder></form-buttons-placeholder> <button id={{idPrefix}}-cancel-button class="btn btn-default btn-block" ng-click=$close()>Cancel</button> </div>'),a.put("views/partials/form-subsection.html",'<div class=form-subsection ng-class="{\'form-subsection-expanded\': formSubsection.expanded, \'form-subsection-collapsed\': !formSubsection.expanded}" ng-controller=formSubsectionCtrl> <div class=row> <div class=col-xs-9> <h5 class=form-group-heading> <a href ng-click="formSubsection.expanded = !formSubsection.expanded"> {{name}} </a> </h5> <div ng-class="{\'if-collapsed\': hasExpandedSummary}" class=form-subsection-summary> <summary-placeholder></summary-placeholder> </div> <div class=if-expanded ng-if=hasExpandedSummary> <summary-expanded-placeholder></summary-expanded-placeholder> </div> </div> <div class="col-xs-3 form-subsection-toggle"> <button ng-click="formSubsection.expanded = true; $event.preventDefault();" class="btn btn-default btn-slim if-collapsed btn-expand"> expand </button> <button ng-click="formSubsection.expanded = false; $event.preventDefault();" class="btn btn-default btn-slim if-expanded btn-collapse"> collapse </button> </div> <div class="col-xs-12 form-subsection-section if-expanded"> <section-placeholder></section-placeholder> </div> </div> </div>'),
a.put("views/partials/header-sidebar-toggle.html",'<button type=button class=navbar-toggle snap-toggle=left> <i class="fa fa-navicon fa-lg"></i> </button>'),a.put("views/partials/header.html",'<header ng-controller=HeaderCtrl> <nav class="navbar navbar-default navbar-fixed-top" role=navigation> <div class=inner> <ng-include src="\'views/partials/header-sidebar-toggle.html\'"></ng-include> <div class=header-navbar-menu-wrap> <ul ng-if="navigation.length === 0" id=header-navbar class=header-navbar-menu> <li> <a class=active id=header-{{titleToId($state.current.data.pageTitle)}} snap-close> <span>{{$state.current.data.pageTitle}}</span> </a> </li> </ul> <ul ng-if="navigation.length > 0" id=header-navbar class=header-navbar-menu> <li ng-repeat="item in navigation"> <a ng-if=!item.separator ng-class="{active: item.isActive}" id=header-{{item.id}} ui-sref={{item.state}} snap-close> <span><i ng-class=item.icon></i></span> <span>{{item.name}}</span> </a> </li> </ul> </div> </div> </nav> </header>'),a.put("views/partials/logo.html","<h1 class=fifthweek-logo> <a ui-sref=home id=fifthweek-logo-link snap-close>fifthweek.</a> </h1>"),a.put("views/partials/managed-list-sm.html",'<div class=managed-list-sm> <div class="row-outer item" ng-repeat="item in items" ng-click="manageItem({item: item})"> <div class=row> <div class=col-xs-10 ng-transclude=parent> </div> <div class="col-xs-2 action"> <p><i class="fa fa-chevron-right"></i></p> </div> </div> </div> <div class=row-outer ng-click=newItem()> <div class=row> <div class=col-xs-9> <p>Add a new {{itemName}}</p> </div> <div class="col-xs-3 action"> <button class="btn btn-success btn-slim btn-add" ng-click=$event.preventDefault()> <span class=visible-over-s>add</span> <i class="fa fa-plus-circle btn-icon-right"></i> </button> </div> </div> </div> </div>'),a.put("views/partials/managed-list.html",'<div class=managed-list> <fw-panel12 class=managed-list-create ui-sref={{newItemState}}> <div class=row-selection-slim> <div class=row> <div class=col-xs-9> <h5><a href>Add a new {{itemName}}</a></h5> </div> <div class=col-xs-3> <button id=add-button class="btn btn-success btn-slim"> <span class=visible-over-s>add</span> <i class="fa fa-plus-circle btn-icon-right-collapsible"></i> </button> </div> </div> </div> </fw-panel12> <fw-panel12 ng-if="items.length > 0"> <div class="row-selection item" ng-repeat="item in items" ui-sref="{{manageItemState}}({id: item.id})"> <div class=row> <div class=col-xs-9 ng-transclude=parent> </div> <div class=col-xs-3> <button class="btn btn-default btn-slim"> <span class=visible-over-s>edit</span> <i class="fa fa-chevron-right btn-icon-right-collapsible"></i> </button> </div> </div> </div> </fw-panel12> </div>'),a.put("views/partials/sidebar.html",'<div id=sidebar class=sidebar snap-drawer=left data-ng-controller=SidebarCtrl> <div ng-include="\'views/partials/logo.html\'"></div> <ul> <li ng-repeat="item in navigation"> <hr ng-if="item.separator"> <a ng-if=!item.separator ng-class="{active: item.isActive}" id=sidebar-{{item.id}} ng-click="navigate(item.state, item.action)" snap-close> <i ng-class=item.icon></i>{{item.name}} </a> </li> </ul> </div> <div class=sidebar-footer> <p>&copy; Fifthweek 2015</p> <p><a ui-sref=legal.termsOfService>Terms</a> <a ui-sref=legal.privacyPolicy>Privacy</a></p> </div>'),a.put("views/sign-in/forgot.html",'<form novalidate name=form role=form> <fw-panel6 ng-show=!form.submissionSucceeded id=password-reset-request-panel> <div class=form-group> <input id=passwordResetRequestData-username class=form-control placeholder=Username ng-model=passwordResetRequestData.username focus=true> </div> <h5 class=form-group>Or</h5> <div class=form-group> <input id=passwordResetRequestData-email class=form-control placeholder=Email ng-model=passwordResetRequestData.email> </div> <div class=row-btn> <button id=password-reset-request-button class="btn btn-success btn-block" type=submit data-event-title="Password reset requested" data-event-category=Sign-in data-loading-text="Sending request..." fw-form-submit=requestPasswordReset()>Reset Password</button> </div> <div ng-show=form.message class="alert alert-danger sub-form-alert" id=password-reset-request-message> <p>{{form.message}}</p> </div> </fw-panel6> <fw-panel12 ng-show=form.submissionSucceeded id=password-reset-request-success> <h4 class="text-suffix text-success">Please check your inbox</h4> <p>You should receive an email from us containing a link to reset your password.</p> </fw-panel12> </form>'),a.put("views/sign-in/reset.html",'<form novalidate role=form name=form> <fw-panel12 ng-show="!form.submissionSucceeded && !tokenInvalid" id=password-reset-confirmation-panel> <fw-form-input-password ng-model=passwordResetConfirmationData.newPassword placeholder="New password" required focus></fw-form-input-password> <div class=row-btn> <button id=password-reset-confirmation-button class="btn btn-success btn-block" type=submit data-event-title="Password reset completed" data-event-category=Sign-in data-loading-text=Resetting... fw-form-submit=confirmPasswordReset()>Reset Password</button> </div> <div ng-show=form.message class="alert alert-danger sub-form-alert" id=password-reset-confirmation-message> <p>{{form.message}}</p> </div> </fw-panel12> <fw-panel12 ng-show="form.submissionSucceeded && !tokenInvalid" id=password-reset-confirmation-success> <h4 class="text-suffix text-success">Password has been reset</h4> <p> Please sign in with your new password. <strong><a ui-sref=signIn>Continue to sign in page &raquo;</a></strong> </p> </fw-panel12> </form> <fw-panel12 ng-show=tokenInvalid id=password-reset-token-invalid> <h4 class="text-suffix text-warning">This link has expired</h4> <p> If you still need to reset your password, please go to the <strong><a ui-sref=signIn.forgot>forgot your details</a></strong> page. </p> </fw-panel12>'),a.put("views/sign-in/sign-in.html",'<fw-panel6> <form novalidate name=form role=form> <div class=form-group> <input id=signInData-username class=form-control placeholder=Username ng-model=signInData.username focus=true> </div> <div class=form-group> <input id=signInData-password type=password class=form-control placeholder=Password ng-model=signInData.password> </div> <div class=row-btn> <div class=row> <div class=col-s-4> <button id=sign-in-button class="btn btn-success btn-block" type=submit data-event-title="Signed in" data-event-category=Sign-in data-loading-text="Signing In..." fw-form-submit=signIn()>Sign In</button> </div> <div class=col-s-8> <p class=btn-alternate-action><a id=forgot-details-link ui-sref=signIn.forgot>Forgot your details?</a></p> </div> </div> </div> <div ng-show=form.message class="alert alert-danger sub-form-alert" id=sign-in-message> <p>{{form.message}}</p> </div> </form> </fw-panel6>'),a.put("views/signout.html","<div class=alert>Signing out...</div>"),a.put("views/video-modal.html",'<div class="modal-body has-modal-cross-button-outside"> <a id=modal-cross-button class=modal-cross-button-outside ng-click=$close() href> <i class="fa fa-close"></i> </a> <div class=video>  <iframe id=home-modal-video vimeo-video title="Creator Journey" src="/video-modal.html/player.vimeo.com/video/114229222?player_id=home-modal-video" frameborder=0 webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe> </div> </div>')}]),angular.module("webApp").directive("fwDateTimePicker",function(){"use strict";return{restrict:"E",require:["fwDateTimePicker","ngModel"],controller:"fwDateTimePickerCtrl",scope:{},templateUrl:"modules/common/fw-date-time-picker.html",link:function(a,b,c,d){var e=d[0],f=d[1];e.initialize(f)}}}),angular.module("webApp").controller("fwDateTimePickerCtrl",["$scope","fifthweekConstants",function(a,b){"use strict";var c,d=new Date;d.setUTCHours(d.getUTCHours()+1,0,0,0);var e,f=function(){var b;b=e.$modelValue?new Date(e.$modelValue):new Date(d);var c=new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()),f=new Date(b);f.setUTCMinutes(f.getUTCMinutes()+f.getTimezoneOffset()),a.date=c,a.time=f},g=function(){if(a.date&&a.time){var b=new Date(Date.UTC(a.date.getFullYear(),a.date.getMonth(),a.date.getDate(),a.time.getHours(),a.time.getMinutes(),0,0));e.$setViewValue(b),e.$setValidity("dateTime",!0)}else e.$setViewValue(void 0),e.$setValidity("dateTime",!1);c&&(e.$setPristine(),c=!1)};a.dateOptions={formatYear:"yyyy",startingDay:1},a.format=b.longDateFormat,a.openDatePicker=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},this.initialize=function(b){e=b,e.$pristine=!1,c=!0,e.$render=f,a.$watchGroup(["date","time"],g)}}]),angular.module("webApp").directive("fwFormInputDateTimePicker",["utilities",function(a){"use strict";return{restrict:"E",scope:!0,templateUrl:"modules/common/fw-form-input-date-time-picker.html",link:function(b,c,d){a.forDirective(b,c,d).scaffoldFormInput()}}}]),angular.module("webApp").directive("fwImage",function(){"use strict";return{restrict:"E",scope:{id:"@",src:"@"},replace:!0,templateUrl:"modules/common/fw-image.html"}}),angular.module("webApp").controller("fwFormInputHourOfWeekCtrl",["$q","$scope","releaseTimeFormatter",function(a,b,c){"use strict";var d,e=function(a,b){return(a%b+b)%b},f=function(){b.model.day&&b.model.hour?(d.$setViewValue(b.model.day.value+b.model.hour.value),d.$setValidity("hourOfWeek",!0)):(d.$setViewValue(void 0),d.$setValidity("hourOfWeek",!1))},g=function(){var a=0,c=0;if(d.$modelValue){c=d.$modelValue%24;var f=Math.floor(d.$modelValue/24),g=e(f-1,7);a=g}b.model.day=b.model.days[a],b.model.hour=b.model.hours[c]};b.model={days:[{name:"Monday",value:24},{name:"Tuesday",value:48},{name:"Wednesday",value:72},{name:"Thursday",value:96},{name:"Friday",value:120},{name:"Saturday",value:144},{name:"Sunday",value:0}],hours:_.map(_.range(24),function(a){return{name:c.getTimeOfWeek(a),value:a}})},this.initialize=function(a){d=a,d.$render=g,b.$watchGroup(["model.day","model.hour"],f)}}]),angular.module("webApp").directive("fwFormInputHourOfWeek",function(){"use strict";return{restrict:"E",require:["fwFormInputHourOfWeek","ngModel"],controller:"fwFormInputHourOfWeekCtrl",scope:{},templateUrl:"modules/common/fw-form-input-hour-of-week.html",link:function(a,b,c,d){var e=d[0],f=d[1];e.initialize(f)}}}),angular.module("webApp").directive("fwFormCancelButton",["$state",function(a){"use strict";return{restrict:"E",scope:{},replace:!0,templateUrl:"modules/common/fw-form-cancel-button.html",link:function(b){b.cancelForm=function(){a.reload()}}}}]),angular.module("webApp").directive("fwFormDirtyConfirmation",["$state","$modal","uiRouterConstants","uiBootstrapConstants",function(a,b,c,d){"use strict";return{restrict:"E",scope:{form:"=",formDirty:"=?",isModal:"@?"},link:function(e){if(e.isModal=!!e.isModal,e.form){e.formDirty||(e.formDirty=function(){return e.form.$dirty}),e.form.discard=function(){e.form.discardChanges=!0},e.form.discardChanges=!1,e.enabled=!0,e.displayed=!1;var f=a.current.name,g=function(a,c,d){var f=e.enabled&&e.formDirty()&&!e.form.isSubmitting&&!e.form.discardChanges&&c();if(f&&(a.preventDefault(),!e.displayed)){e.displayed=!0;var g=b.open({templateUrl:"modules/common/fw-form-dirty-confirmation.html",size:"sm"});g.result.then(function(a){a&&(e.enabled=!1,d())})["finally"](function(){e.displayed=!1})}};e.isModal?e.$on(d.modalClosingEvent,function(a){var b=function(){return!0},c=function(){a.targetScope.$close()};g(a,b,c)}):e.$on(c.stateChangeStartEvent,function(b,c,d){var e=function(){return c.name!==f},h=function(){a.go(c.name,d)};g(b,e,h)})}}}}]),angular.module("webApp").directive("fwPrice",function(){"use strict";return{restrict:"E",scope:{value:"=",showInterval:"=?",priceId:"@?"},template:"<span id=\"{{priceId}}\" ng-class=\"{'price-negative': isNegative}\" class=\"price\">${{formattedPrice}}{{showInterval ? '/week' : ''}}</span>",link:function(a){var b=function(){a.formattedPrice=(a.value/100).toFixed(2),a.isNegative=a.value<0};void 0===a.showInterval&&(a.showInterval=!0),a.$watch("value",b)}}}),angular.module("webApp").directive("fwMarkdown",["markdownService",function(a){return{restrict:"EA",require:"?ngModel",scope:{replace:"@"},link:function(b,c,d,e){if(!e){var f=a.renderMarkdown(c.text());return void(b.replace?c.replaceWith(f):c.html(f))}e.$render=function(){var d=a.renderMarkdown(e.$viewValue||"");b.replace?c.replaceWith(d):c.html(d)}}}}]),angular.module("webApp").factory("markdownService",function(){"use strict";var a={},b=a.internal={};return b.renderer=new marked.Renderer,b.renderer.code=function(a){return"<pre>"+a+"</pre>"},a.createMarkdown=function(a){return a?toMarkdown(a,{converters:[{filter:["code"],replacement:function(a){return"`"+a+"`"}},{filter:["pre"],replacement:function(a){return"```\n"+a+"\n```"}},{filter:["html","body","span","div","font","table"],replacement:function(a){return a}},{filter:["head","script","style"],replacement:function(){return""}}]}):""},a.renderMarkdown=function(a){return a?marked(a,{renderer:b.renderer}):""},a}),angular.module("webApp").factory("jsonService",function(){"use strict";var a={};return a.toJson=function(a){return a?JSON.stringify(a):""},a.fromJson=function(a){return a?JSON.parse(a):void 0},a.toSirTrevor=function(b,c){return{serializedBlocks:a.toJson(b),files:c}},a}),angular.module("webApp").factory("signInWorkflowService",["$q","$modal",function(a,b){"use strict";var c={},d=c.internal={};return d.handleDialogError=function(b){return b instanceof Error?a.reject(b):a.when()},c.beginSignInWorkflow=function(){return b.open({controller:"signInWorkflowDialogCtrl",templateUrl:"modules/landing-page/sign-in-workflow-dialog.html",size:"sm"}).result["catch"](function(a){return d.handleDialogError(a)})},c}]),angular.module("webApp").directive("fwSirTrevorEditor",function(){"use strict";return{restrict:"E",require:["fwSirTrevorEditor","ngModel"],controller:"fwSirTrevorEditorCtrl",scope:{maxlength:"@?",placeholder:"@?",editorId:"@?",ngRequired:"=?",ngDisabled:"=?",noFocus:"@?",channelId:"@",textOnly:"@"},templateUrl:"modules/sir-trevor/fw-sir-trevor-editor.html",link:function(a,b,c,d){var e=d[0],f=d[1];e.initialize(f)}}}),angular.module("webApp").controller("fwSirTrevorEditorCtrl",["$scope","$element","$timeout","$interval","formConstants","markdownService","jsonService","fwImageBlockFactory","fwFileBlockFactory","fwTextBlockFactory","fwBreakBlockFactory","fwVideoBlockFactory",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m=["containerName","renderSize","fileSize","fileName"],n=this.internal={editor:void 0,childScopes:[]};n.render=function(){a.sirTrevorValue=n.fifthweekToSirTrevor(n.ngModelCtrl.$viewValue)},n.setViewValue=function(b){var c=n.sirTrevorToFifthweek(a.sirTrevorValue),d=!1;d=n.ngModelCtrl.$viewValue?!c||c.serializedBlocks!==n.ngModelCtrl.$viewValue.serializedBlocks:!!c,(d||b)&&n.ngModelCtrl.$setViewValue(c),n.setValidity(c)},n.setValidity=function(b){a.maxlength&&b&&(a.remaining=a.maxlength-b.serializedBlocks.length,n.ngModelCtrl.$setValidity("maxlength",a.remaining>=0)),a.ngRequired&&n.ngModelCtrl.$setValidity("required",!!(b&&b.blockCount>0))},n.isFileOrImageBlock=function(a){return n.isFileBlock(a)||n.isImageBlock(a)},n.isFileBlock=function(a){return"file"===a.type},n.isImageBlock=function(a){return"image"===a.type},n.isTextBlock=function(a){return"text"===a.type},n.isVideoBlock=function(a){return"video"===a.type},n.isBreakBlock=function(a){return"break"===a.type},n.getWordCount=function(a){var b=a.replace(/[^\w\s]|_/g,"").replace(/\s+/g," ").match(/\S+/g)||[];return b.length},n.sirTrevorToFifthweek=function(a){if(!a)return a;var b=[],c=0,d=_.cloneDeep(a.data);_.forEach(d,function(a){if(n.isTextBlock(a))a.data={format:"md",text:f.createMarkdown(a.data.text)};else if(n.isFileOrImageBlock(a))if(a.data.isBusy)c++,a.data={};else if(a.data.fileId){delete a.data.isBusy;var d={fileId:a.data.fileId};_.forEach(m,function(b){d[b]=a.data[b],delete a.data[b]}),b.push(d)}});var e=n.getPopulatedBlocks(d);if(0===e.length&&!c)return void 0;var h,i,j,k=0,l=0,o=0,p=0,q=0;_.forEach(e,function(a){n.isTextBlock(a)?(j||(j=a.data.text,i=j.substring(0,1500),q=n.getWordCount(i)),p+=n.getWordCount(a.data.text)):n.isFileBlock(a)?l++:n.isVideoBlock(a)?o++:n.isImageBlock(a)&&(k++,h||(h=a.data.fileId))}),i||(i=void 0),j||(j=void 0);var r=g.toJson(e),s={serializedBlocks:r,files:b,blockCount:e.length,imageCount:k,videoCount:o,fileCount:l,previewWordCount:q,wordCount:p,previewImageId:h,previewText:i,firstText:j};return c&&(s.busyBlockCount=c),s},n.fifthweekToSirTrevor=function(a){if(!a)return a;var b=g.fromJson(a.serializedBlocks),c=n.getPopulatedBlocks(b);return _.forEach(c,function(b){if(n.isTextBlock(b))b.data={format:"html",text:f.renderMarkdown(b.data.text)};else if(n.isFileOrImageBlock(b)){var c=_.find(a.files,{fileId:b.data.fileId});_.forEach(m,function(a){b.data[a]=c[a]})}}),{data:b}},n.getPopulatedBlocks=function(a){return _.filter(a,function(a){return n.isTextBlock(a)?a.data&&a.data.text&&a.data.text.length>0:n.isFileOrImageBlock(a)?a.data&&a.data.fileId:n.isVideoBlock(a)?a.data&&a.data.remote_id:n.isBreakBlock(a)?!0:!1})},n.load=function(){return c(n.onLoaded)},n.onLoaded=function(){SirTrevor.config.skipValidation=!0,SirTrevor.Blocks.Image=h.createBlock(),SirTrevor.Blocks.File=i.createBlock(),SirTrevor.Blocks.Text=j.createBlock(),SirTrevor.Blocks.Break=k.createBlock(),SirTrevor.Blocks.Video=l.createBlock(),n.editor=new SirTrevor.Editor({el:$(".js-st-instance"),blockTypes:["Text","Image","File","Video","Break"],defaultType:"Text",ignoreFormEvents:!0,blockLimit:a.textOnly?1:0,textFormatting:{bold:!0,italic:!0,underline:!0,strikethrough:!0,link:!0,h1:!a.textOnly,h2:!a.textOnly,list:!0,blockquote:!0},custom:{noFocus:!!a.noFocus,createScope:function(){var b=a.$new();return b.channelId=a.channelId,n.childScopes.push(b),b}}}),n.attachToSirTrevor()},n.attachToSirTrevor=function(){n.timer=d(n.performTimerRead,1e3)},n.detatchFromSirTrevor=function(){n.timer&&d.cancel(n.timer)},n.performTimerRead=function(){n.performRead()},n.performSubmitRead=function(){n.performRead(!0)},n.performRead=function(b){if(n.editor){var c=n.editor.onFormSubmit(!1);c||(a.sirTrevorValue=n.editor.store.retrieve(),n.setViewValue(b))}},n.dispose=function(){_.forEach(n.childScopes,function(a){a.$destroy()}),n.detatchFromSirTrevor()},this.initialize=function(c){return b.on("$destroy",function(){n.dispose()}),n.ngModelCtrl=c,n.ngModelCtrl.$render=n.render,delete n.ngModelCtrl.$validators.required,delete n.ngModelCtrl.$validators.maxlength,a.$on(e.formSubmittingEvent,n.performSubmitRead),n.load()}}]),angular.module("webApp").factory("fwImageBlockFactory",["$compile",function(a){"use strict";var b={};return b.createBlock=function(){return SirTrevor.Block.extend({type:"image",title:function(){return i18n.t("blocks:image:title")},icon_name:"image",beforeBlockRender:function(){var a=this;this.$scope=this.options.custom.createScope(),this.$scope.uploadStarted=function(){a.setData({isBusy:!0})},this.$scope.processingComplete=function(b){a.setData(b),a.setData({isBusy:!1})}},loadData:function(a){this.$scope.fileId=a.fileId,this.$scope.containerName=a.containerName,this.$scope.renderSize=a.renderSize},onBlockRender:function(){this.$inner.addClass("st-block__inner--fw-image-block");var b='<fw-image-block channel-id="{{channelId}}" file-id="{{fileId}}" container-name="{{containerName}}" render-size="renderSize" on-upload-started-delegate="uploadStarted()" on-processing-complete-delegate="processingComplete(data)"></fw-image-block>';this.imageBlockElement=a(b)(this.$scope),this.$editor.html(this.imageBlockElement)}})},b}]),angular.module("webApp").directive("fwImageBlock",function(){"use strict";return{restrict:"E",require:["fwImageBlock"],controller:"fwImageBlockCtrl",scope:{channelId:"@?",fileId:"@?",containerName:"@?",renderSize:"=?",onUploadStartedDelegate:"&?",onProcessingCompleteDelegate:"&?"},templateUrl:"modules/sir-trevor/fw-image-block.html",link:function(a,b,c,d){var e=d[0];e.initialize()}}}),angular.module("webApp").controller("fwImageBlockCtrl",["$q","$scope","blobImageControlFactory",function(a,b,c){"use strict";var d={imageUploaded:!1,processingImage:!1,fileData:void 0};b.model=d;var e=this.internal={};b.blobImage=c.createControl(),e.onBlobImageUpdateComplete=function(a){d.processingImage=!1,d.fileData.renderSize=a.renderSize,b.onProcessingCompleteDelegate&&b.onProcessingCompleteDelegate({data:d.fileData})},b.onUploadStarted=function(){b.onUploadStartedDelegate&&b.onUploadStartedDelegate()},b.onUploadComplete=function(a){d.imageUploaded=!0,d.fileData={fileId:a.fileId,containerName:a.containerName},d.processingImage=!0,b.blobImage.update(a.containerName,a.fileId,!1,e.onBlobImageUpdateComplete)},this.initialize=function(){d.fileData={fileId:b.fileId,containerName:b.containerName,renderSize:b.renderSize},b.fileId&&b.containerName?(d.imageUploaded=!0,b.blobImage.update(b.containerName,b.fileId,!0)):b.blobImage.update()}}]),angular.module("webApp").factory("fwFileBlockFactory",["$compile",function(a){"use strict";var b={};return b.createBlock=function(){return SirTrevor.Block.extend({type:"file",title:function(){return"File"},icon_name:"link",beforeBlockRender:function(){var a=this;this.$scope=this.options.custom.createScope(),this.$scope.uploadStarted=function(){a.setData({isBusy:!0})},this.$scope.uploadComplete=function(b){a.setData(b),a.setData({isBusy:!1})}},loadData:function(a){this.$scope.fileId=a.fileId,this.$scope.containerName=a.containerName,this.$scope.fileName=a.fileName},onBlockRender:function(){this.$inner.addClass("st-block__inner--fw-file-block");var b='<fw-file-block channel-id="{{channelId}}" file-id="{{fileId}}" container-name="{{containerName}}" file-name="{{fileName}}" on-upload-started-delegate="uploadStarted()"  on-upload-complete-delegate="uploadComplete(data)"></fw-file-block>';this.imageBlockElement=a(b)(this.$scope),this.$editor.html(this.imageBlockElement)}})},b}]),angular.module("webApp").directive("fwFileBlock",function(){"use strict";return{restrict:"E",require:["fwFileBlock"],controller:"fwFileBlockCtrl",scope:{channelId:"@?",fileId:"@?",containerName:"@?",fileName:"@?",onUploadStartedDelegate:"&?",onUploadCompleteDelegate:"&?"},templateUrl:"modules/sir-trevor/fw-file-block.html",link:function(a,b,c,d){var e=d[0];e.initialize()}}}),angular.module("webApp").controller("fwFileBlockCtrl",["$q","$scope",function(a,b){"use strict";var c={fileUploaded:!1,fileData:void 0};b.model=c,b.onUploadStarted=function(){b.onUploadStartedDelegate&&b.onUploadStartedDelegate()},b.onUploadComplete=function(a){c.fileUploaded=!0,c.fileData={fileId:a.fileId,containerName:a.containerName,fileName:a.file.name},b.onUploadCompleteDelegate&&b.onUploadCompleteDelegate({data:c.fileData})},this.initialize=function(){c.fileData={fileId:b.fileId,containerName:b.containerName,fileName:b.fileName},b.fileId&&b.containerName&&b.fileName&&(c.fileUploaded=!0)}}]),angular.module("webApp").factory("fwTextBlockFactory",function(){"use strict";var a={};return a.createBlock=function(){return SirTrevor.Block.extend({type:"text",title:function(){return i18n.t("blocks:text:title")},editorHTML:'<div class="st-required st-text-block" contenteditable="true"></div>',icon_name:"text",loadData:function(a){this.setTextBlockHTML(a.text)},onBlockRender:function(){this.options.custom.noFocus||this.focus()}})},a}),angular.module("webApp").factory("fwBreakBlockFactory",function(){"use strict";var a={};return a.createBlock=function(){return SirTrevor.Block.extend({type:"break",title:function(){return"Break"},editorHTML:'<p class="post-break-line"></p>',icon_name:"iframe",loadData:function(){},onBlockRender:function(){this.$editor.html(this.editorHTML)}})},a}),angular.module("webApp").factory("fwVideoBlockFactory",function(){"use strict";var a={},b=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/;return a.createBlock=function(){return SirTrevor.Block.extend({providers:{vimeo:{regex:/(?:http[s]?:\/\/)?(?:www.)?vimeo\.co(?:.+(?:\/)([^\/].*)+$)/,html:'<iframe src="<%= protocol %>//player.vimeo.com/video/<%= remote_id %>?title=0&byline=0" width="580" height="320" frameborder="0"></iframe>'},youtube:{regex:/^.*(?:(?:youtu\.be\/)|(?:youtube\.com)\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*)/,html:'<iframe src="<%= protocol %>//www.youtube.com/embed/<%= remote_id %>" width="580" height="320" frameborder="0" allowfullscreen></iframe>'}},type:"video",title:function(){return i18n.t("blocks:video:title")},pastable:!0,icon_name:"video",onBlockRender:function(){this.$inputs.find("input").attr("placeholder","Paste URL here")},loadData:function(a){if(this.providers.hasOwnProperty(a.source)){var b=this.providers[a.source],c="file:"===window.location.protocol?"http:":window.location.protocol,d=b.square?"with-square-media":"with-sixteen-by-nine-media",e=_.template(b.html);this.$editor.addClass("st-block__editor--"+d).html(e({protocol:c,remote_id:a.remote_id,width:this.$editor.width()}))}},onContentPasted:function(a){this.handleDropPaste(a.target.value)},matchVideoProvider:function(a,b,c){var d=a.regex.exec(c);return!d||_.isUndefined(d[1])?{}:{source:b,remote_id:d[1]}},handleDropPaste:function(a){if(this.isURI(a))for(var b in this.providers)this.providers.hasOwnProperty(b)&&this.setAndLoadData(this.matchVideoProvider(this.providers[b],b,a))},isURI:function(a){return b.test(a)}})},a}),angular.module("webApp").controller("commentsDialogCtrl",["$scope","postId","isCommenting","updateCommentsCount","postStub","initializer","errorFacade",function(a,b,c,d,e,f,g){"use strict";var h={errorMessage:void 0,isLoading:!1,isCommenting:c,comments:[],input:{comment:""}};a.model=h;var i=this.internal={};this.initialize=function(){return i.loadForm()},i.processComments=function(a){var b=1;_.forEach(a,function(a){a.moment=moment(a.creationDate),a.liveSince=a.moment.fromNow(),a.number=b++}),a.reverse()},i.loadForm=function(){return h.errorMessage=void 0,h.isLoading=!0,e.getComments(b).then(function(a){var b=a.data.comments;i.processComments(b),h.comments=b,d(h.comments.length)})["catch"](function(a){return g.handleError(a,function(a){h.errorMessage=a})})["finally"](function(){h.isLoading=!1})},a.saveComment=function(){return h.errorMessage=void 0,e.postComment(b,{content:h.input.comment?h.input.comment.firstText:""}).then(function(){return h.input.comment="",a.commentOnPostForm.$setPristine(),i.loadForm()})["catch"](function(a){return g.handleError(a,function(a){h.errorMessage=a})})},f.initialize(this.initialize)}]),angular.module("webApp").controller("AccountCtrl",["$scope","$q","accountSettingsRepositoryFactory","accountSettingsStub","errorFacade","blobImageControlFactory",function(a,b,c,d,e,f){"use strict";var g={accountSettings:void 0,errorMessage:void 0},h=c.forCurrentUser(),i=function(){return h.getAccountSettings().then(function(b){g.accountSettings=b,b.profileImage?a.blobImage.update(b.profileImage.containerName,b.profileImage.fileId,!0):a.blobImage.update()})["catch"](function(a){return g.accountSettings=void 0,e.handleError(a,function(a){g.errorMessage=a})})};a.blobImage=f.createControl(),a.model=g,i(),a.onUploadComplete=function(b){g.accountSettings.profileImage=b,a.form.$setDirty(),a.blobImage.update(b.containerName,b.fileId,!1)},a.submitForm=function(){var b,c=h.getUserId();return g.accountSettings.profileImage&&(b=g.accountSettings.profileImage.fileId),d.put(c,{newEmail:g.accountSettings.email,newUsername:g.accountSettings.username,newPassword:g.password?g.password:void 0,newProfileImageId:b}).then(function(){return h.setAccountSettings(g.accountSettings)}).then(function(){a.form.$setPristine()})}}]),angular.module("webApp").constant("accountSettingsRepositoryFactoryConstants",{accountSettingsKey:"accountSettings"}).factory("accountSettingsRepositoryFactory",["$q","masterRepositoryFactory","accountSettingsRepositoryFactoryConstants",function(a,b,c){"use strict";return{forCurrentUser:function(){var d=c.accountSettingsKey,e=b.forCurrentUser(),f={};return f.getUserId=function(){return e.getUserId()},f.getAccountSettings=function(){return e.get(d)},f.tryGetAccountSettings=function(){return e.getUserId()?e.get(d,!0):a.when()},f.setAccountSettings=function(a){return e.set(d,a)},f.decrementFreePostsRemaining=function(){return f.getAccountSettings().then(function(a){return a.freePostsRemaining=a.freePostsRemaining-1,f.setAccountSettings(a)})},f}}}]),angular.module("webApp").controller("becomeCreatorCtrl",["$scope","$q","accountSettingsRepositoryFactory","accountSettingsStub","$state","states","authenticationService","fetchAggregateUserState",function(a,b,c,d,e,f,g,h){"use strict";var i={errorMessage:void 0};a.model=i;var j=this.internal={},k=c.forCurrentUser();j.updateCreatorStatus=function(a){return h.updateInParallel(a,g.refreshToken).then(function(){e.go(f.creator.createBlog.name)})},j.onAccountSettingsSaved=function(c){return i.isCreator?(a.form.$setPristine(),b.when()):j.updateCreatorStatus(c)},a.submitForm=function(){var a=k.getUserId();return d.putCreatorInformation(a,{}).then(function(){return k.setAccountSettings(i.accountSettings)}).then(function(){return j.onAccountSettingsSaved(a)})}}]),angular.module("webApp").controller("backlogPostListCtrl",function(){"use strict"}),angular.module("webApp").constant("landingPageConstants",{views:{timeline:"timeline",post:"post"},actions:{manage:"manage",channel:"channel",post:"post"},timelineTypes:{all:"all",subscribed:"subscribed",channel:"channel"}}).controller("landingPageCtrl",["$scope","$q","landingPageConstants","fetchAggregateUserState","fwPostListConstants","accountSettingsRepositoryFactory","blogRepositoryFactory","subscriptionRepositoryFactory","initializer","$stateParams","$state","states","errorFacade","landingPageInformationLoader","fullPostLoader",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";var p=f.forCurrentUser(),q=g.forCurrentUser(),r=h.forCurrentUser();a.model={currentView:void 0,returnState:void 0,channelId:void 0,postId:void 0,timelineType:void 0,landingPage:void 0,post:void 0,username:void 0,isLoaded:!1};var s=this.internal={};s.loadParameters=function(){if(!j.username)return!1;a.model.username=j.username.toLowerCase(),a.model.timelineType=c.timelineTypes.all,a.model.currentView=c.views.timeline;var b=j.action,d=j.key;if(b)switch(b){case c.actions.manage:a.model.returnState=d;break;case c.actions.channel:if(!d)return!1;a.model.channelId=d,a.model.timelineType=c.timelineTypes.channel;break;case c.actions.post:if(!d)return!1;a.model.currentView=c.views.post,a.model.postId=d;break;default:return!1}return!0},s.loadContent=function(){return a.model.currentView===c.views.post?s.loadPost():s.loadLandingPage()},s.initialize=function(){return s.loadParameters()?(a.views=c.views,a.timelineTypes=c.timelineTypes,d.waitForExistingUpdate().then(function(){return s.loadContent()})["catch"](function(c){return c instanceof ApiError&&c.response&&404===c.response.status?(k.go(l.notFound.name),b.when()):m.handleError(c,function(b){a.model.errorMessage=b})})["finally"](function(){a.model.isLoaded=!0})):(k.go(l.notFound.name),b.when())},s.loadLandingPage=function(){return n.loadLandingPageData(a.model.username,p,q,r).then(function(b){a.model.landingPage=b})},s.getSummaryFromPost=function(a){return{username:a.creator.username,userId:a.creatorId,profileImage:a.creator.profileImage,blog:{blogId:a.blogId,name:a.blog.name,introduction:a.blog.introduction,headerImage:a.blog.headerImage}}},s.loadPost=function(){return o.loadPost(a.model.postId,p,q,r).then(function(b){a.model.post=b,a.model.landingPage=s.getSummaryFromPost(b)})},i.initialize(s.initialize),a.goBack=function(){a.model.returnState&&k.go(a.model.returnState)},a.showAllPosts=function(){a.model.currentView=c.views.timeline,a.model.timelineType=c.timelineTypes.all},a.showSubscribedPosts=function(){a.model.currentView=c.views.timeline,a.model.timelineType=c.timelineTypes.subscribed},a.showChannel=function(){a.model.currentView=c.views.timeline,a.model.timelineType=c.timelineTypes.channel},a.showPost=function(){a.model.currentView=c.views.post}}]),
angular.module("webApp").controller("landingPageRedirectCtrl",["$scope","$state","states","accountSettingsRepositoryFactory",function(a,b,c,d){"use strict";var e=d.forCurrentUser();e.getAccountSettings().then(function(a){b.go(c.landingPage.name,{username:a.username})})}]),angular.module("webApp").factory("subscribeService",["$q","subscriptionStub","signInWorkflowService","fetchAggregateUserState","subscriptionRepositoryFactory","blogRepositoryFactory","$modal",function(a,b,c,d,e,f,g){"use strict";var h={},i=h.internal={};return i.getSubscribedChannels=function(a){var b={};return _.forEach(a.channels,function(c){var d=a.freeAccess?0:c.price,e={acceptedPrice:c.acceptedPrice,currentPrice:d,isIncrease:c.acceptedPrice<d,isDecrease:c.acceptedPrice>d};b[c.channelId]=e}),b},i.getHiddenChannels=function(a){var b=[];return _.forEach(a.channels,function(a){a.isVisibleToNonSubscribers||b.push(a)}),b},i.getUserInformation=function(b){var c,d=f.forCurrentUser(),g=e.forCurrentUser();return h.getSubscriptionStatus(b,g).then(function(a){return c=a,d.tryGetBlog()}).then(function(d){return d?(c.currentUserBlogId=d.blogId,c.isOwner=b===d.blogId):(c.currentUserBlogId=void 0,c.isOwner=!1),a.when(c)})},i.handleDialogError=function(b){return b instanceof Error?a.reject(b):a.when()},i.showGuestListOnlyDialog=function(){return g.open({templateUrl:"modules/landing-page/guest-list-only-dialog.html",size:"sm"}).result["catch"](function(a){return i.handleDialogError(a)})},i.ensureSignedIn=function(b){return i.getUserInformation(b).then(function(b){return b.userId?a.when(!0):c.beginSignInWorkflow()})},i.getSignedInUserInformation=function(b){return i.ensureSignedIn(b).then(function(c){return c?d.waitForExistingUpdate().then(function(){return i.getUserInformation(b)}):a.when(!1)})},i.isGuestListOnly=function(){return!1},h.getSubscriptionStatus=function(a,b){var c=b.getUserId();return d.updateIfStale(c).then(function(){return b.tryGetBlogs()}).then(function(b){var d=!1,e=!1,f={},g=[];if(b){var h=_.find(b,{blogId:a});h&&(e=h.freeAccess,d=h.channels&&h.channels.length,f=i.getSubscribedChannels(h),g=i.getHiddenChannels(h))}return{userId:c,hasFreeAccess:!!e,isSubscribed:!!d,subscribedChannels:f,hiddenChannels:g}})},h.subscribe=function(c,e,f){return i.getSignedInUserInformation(c).then(function(c){if(!c)return a.when(!1);if(c.isOwner)return a.when(!0);if(c.hasFreeAccess)f=0;else if(i.isGuestListOnly())return i.showGuestListOnlyDialog().then(function(){return a.when(!1)});return b.postChannelSubscription(e,{acceptedPrice:f}).then(function(){return d.updateFromServer(c.userId)}).then(function(){return a.when(!0)})})},h.unsubscribe=function(c,e){return i.getUserInformation(c).then(function(c){return c.isOwner?a.when():b.deleteChannelSubscription(e).then(function(){return d.updateFromServer(c.userId)})})},h}]),angular.module("webApp").controller("signInWorkflowDialogCtrl",["$q","$scope","$state","states","authenticationService",function(a,b,c,d,e){"use strict";var f=b.pages={register:0,signIn:1};b.model={page:f.register},b.registrationData={email:"",username:"",password:""},b.signInData={username:"",password:""},b.signIn=function(){return e.signIn(b.signInData).then(function(){b.$close(!0)})},b.register=function(){return e.registerUser(b.registrationData).then(function(){return b.signInData.username=b.registrationData.username,b.signInData.password=b.registrationData.password,e.signIn(b.signInData).then(function(){b.$close(!0)})})},b.showSignIn=function(){b.model.page=f.signIn},b.showRegister=function(){b.model.page=f.register},b.forgotDetails=function(){c.go(d.signIn.forgot.name),b.$close(!1)}}]),angular.module("webApp").factory("landingPageInformationLoader",["$q","blogStub","subscribeService",function(a,b,c){"use strict";var d={},e=d.internal={};return e.populateSubscriptionFromUserState=function(a,b){var d=a.blog.blogId;return c.getSubscriptionStatus(d,b).then(function(b){a.hasFreeAccess=b.hasFreeAccess,a.isSubscribed=b.isSubscribed,a.subscribedChannels=b.subscribedChannels,a.hiddenChannels=b.hiddenChannels})},e.loadFromApi=function(c,d){var f;return b.getLandingPage(c).then(function(a){return f=a.data,f.isOwner=!1,e.populateSubscriptionFromUserState(f,d)}).then(function(){return a.when(f)})},e.loadFromLocal=function(b,c){var d={userId:c.getUserId(),isOwner:!0,hasFreeAccess:!1,isSubscribed:!1,profileImage:b.profileImage,subscribedChannels:{},hiddenChannels:[]};return c.getBlog().then(function(b){return d.blog=b,a.when(d)})},d.loadLandingPageData=function(a,b,c,d){return b.getAccountSettings().then(function(b){return b&&b.username===a?e.loadFromLocal(b,c):e.loadFromApi(a,d)})},d.updateSubscribedChannels=function(b,c){return b.isOwner?a.when():e.populateSubscriptionFromUserState(b,c)},d}]),angular.module("webApp").constant("fwSubscriptionInformationConstants",{subscriptionStatusChangedEvent:"subscriptionStatusChangedEvent"}).controller("fwSubscriptionInformationCtrl",["$scope","$q","$sce","fwSubscriptionInformationConstants","authenticationServiceConstants","fetchAggregateUserState","subscribeService","accountSettingsRepositoryFactory","blogRepositoryFactory","subscriptionRepositoryFactory","aggregateUserStateConstants","errorFacade","landingPageInformationLoader",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";var n=h.forCurrentUser(),o=i.forCurrentUser(),p=j.forCurrentUser();a.tracking={unsubscribedTitle:"Unsubscribed",updatedTitle:"Subscription Updated",subscribedTitle:"Subscribed",category:"Timeline"},a.model={errorMessage:void 0,isLoading:!1,landingPage:void 0};var q=this.internal={};q.onAggregateStateUpdated=function(){if(n=h.forCurrentUser(),o=i.forCurrentUser(),p=j.forCurrentUser(),!a.model.landingPage)return b.when();var c=n.getUserId(),d=c===a.model.userId;return d!==a.model.landingPage.isOwner?q.reload():q.reloadFromUserState()},q.reloadFromUserState=function(){return a.model.landingPage?m.updateSubscribedChannels(a.model.landingPage,p).then(function(){return q.recalculateChannels(a.model.landingPage),b.when()}):b.when()},q.recalculateChannels=function(b){var c=_.chain(b.blog.channels).map(function(a){var c=b.subscribedChannels[a.channelId];return{isVisibleToNonSubscribers:a.isVisibleToNonSubscribers,channelId:a.channelId,name:a.name,price:a.price,subscriptionInformation:c}}),d=_.chain(b.hiddenChannels).map(function(a){var c=b.subscribedChannels[a.channelId];return{isVisibleToNonSubscribers:!1,channelId:a.channelId,name:a.name,price:a.price,subscriptionInformation:c}}),e=c.concat(d.value());a.requiredChannelId&&(e=e.filter({channelId:a.requiredChannelId})),b.channels=e.filter(function(a){return a.isVisibleToNonSubscribers||a.subscriptionInformation}).sortByOrder(["name"],[!0]).value(),q.updateTotalPrice(b)},q.postProcessResults=function(a){a.blog.video&&(a.videoUrl=c.trustAsResourceUrl(a.blog.video.replace("http://","//").replace("https://","//"))),q.recalculateChannels(a)},q.updateTotalPrice=function(a){if(a){var b=_(a.channels).filter("subscriptionInformation").reduce(function(a,b){return a.totalPrice=a.totalPrice+parseFloat(b.price),a.count++,a},{totalPrice:0,count:0});a.totalPrice=b.totalPrice,a.subscribedChannelCount=b.count}},q.reload=function(c){a.model.isLoading=!0,a.model.errorMessage=void 0;var d=a.username;return f.waitForExistingUpdate().then(function(){return c?b.when(_.cloneDeep(c)):m.loadLandingPageData(d,n,o,p)}).then(function(b){q.postProcessResults(b),a.model.landingPage=b})["catch"](function(b){return l.handleError(b,function(b){a.model.errorMessage=b})})["finally"](function(){a.model.isLoading=!1})},this.initialize=function(){return a.$on(k.updatedEvent,q.onAggregateStateUpdated),q.reload(a.landingPageData)},q.raiseSubscriptionStatusChangedEvent=function(){a.$emit(d.subscriptionStatusChangedEvent)},a.subscribe=function(b){return g.subscribe(a.model.landingPage.blog.blogId,b.channelId,b.price).then(function(a){a&&q.raiseSubscriptionStatusChangedEvent()})},a.unsubscribe=function(b){return a.model.landingPage.isOwner?void 0:g.unsubscribe(a.model.landingPage.blog.blogId,b.channelId).then(function(){q.raiseSubscriptionStatusChangedEvent()})}}]),angular.module("webApp").directive("fwSubscriptionInformation",function(){"use strict";return{restrict:"E",scope:{username:"@",landingPageData:"=?"},require:["fwSubscriptionInformation"],templateUrl:"modules/landing-page/fw-subscription-information.html",controller:"fwSubscriptionInformationCtrl",link:function(a,b,c,d){var e=d[0];e.initialize()}}}),angular.module("webApp").directive("fwPostSubscriptionInformation",function(){"use strict";return{restrict:"E",scope:{username:"@",requiredChannelId:"@"},require:["fwPostSubscriptionInformation"],templateUrl:"modules/landing-page/fw-post-subscription-information.html",controller:"fwSubscriptionInformationCtrl",link:function(a,b,c,d){a.isPost=!0;var e=d[0];e.initialize()}}}),angular.module("webApp").constant("azureConstants",{timeoutMilliseconds:6e4,checkIntervalMilliseconds:1500}),angular.module("webApp").factory("azureUriService",["$q","$timeout","azureConstants","accessSignatures","azureBlobStub",function(a,b,c,d,e){"use strict";var f={},g=function(a,b){return b?a+"/"+b:a};return f.getBlobUri=function(a,b){return d.getContainerAccessInformation(a).then(function(a){return a.uri+"/"+b+a.signature})},f.tryGetAvailableBlobInformation=function(a,b){return f.getBlobUri(a,b).then(function(a){return e.tryGetAvailableBlobInformation(a)})},f.getAvailableBlobInformation=function(d,e,g){var h=_.now()+c.timeoutMilliseconds,i=function(){return g&&g.isCancelled?a.reject(new CancellationError):_.now()>h?a.reject(new DisplayableError("Timeout","Timed out waiting for blob "+e+" in container "+d+" to be available.")):f.tryGetAvailableBlobInformation(d,e).then(function(a){return a?a:b(i,c.checkIntervalMilliseconds)})};return i()},f.getAvailableImageInformation=function(a,b,c,d){var e=g(b,c);return f.getAvailableBlobInformation(a,e,d)},f.getAvailableFileInformation=function(a,b,c){return f.getAvailableBlobInformation(a,b,c)},f.tryGetAvailableFileInformation=function(a,b){return f.tryGetAvailableBlobInformation(a,b)},f.getImageUri=function(a,b,c){var d=g(b,c);return f.getBlobUri(a,d)},f.getFileUri=function(a,b){return f.getBlobUri(a,b)},f}]),angular.module("webApp").directive("fwAzureImageLoader",["$sce","azureUriService","logService",function(a,b,c){"use strict";return{restrict:"E",scope:{thumbnail:"@",fileId:"@",containerName:"@",outputUrl:"="},replace:!0,link:function(d){var e=function(){b.getImageUri(d.containerName,d.fileId,d.thumbnail).then(function(b){d.outputUrl=a.trustAsResourceUrl(b)})["catch"](function(a){c.error(a)})};d.$watchGroup(["thumbnail","fileId","containerName"],function(){d.thumbnail&&d.fileId&&d.containerName&&e()})}}}]),angular.module("webApp").constant("aggregateUserStateConstants",{updatedEvent:"aggregateUserStateUpdated"}).factory("aggregateUserState",["aggregateUserStateImpl",function(a){"use strict";return a.initialize(),a}]).factory("aggregateUserStateImpl",["$rootScope","localStorageService","aggregateUserStateConstants","fetchAggregateUserStateConstants","authenticationServiceConstants","utilities",function(a,b,c,d,e,f){"use strict";var g="aggregateUserState",h=!1,i=function(){a.$broadcast(c.updatedEvent,m.currentValue)},j=function(a){m.currentValue=a,m.isCurrentValueStale=!1,b.set(g,a),i()},k=function(a,b,c){c=_.cloneDeep(c),delete c.accessSignatures,c.userId=b,j(c)},l=function(a,b){m.currentValue&&b.userId!==m.currentValue.userId&&(m.isCurrentValueStale=!0)},m={};return m.currentValue=void 0,m.isCurrentValueStale=!0,m.initialize=function(){if(h)throw new FifthweekError("Aggregate user state already initialized");h=!0,m.currentValue=b.get(g),m.isCurrentValueStale=!0,a.$on(d.fetchedEvent,k),a.$on(e.currentUserChangedEvent,l)},m.setDelta=function(a,b,c){if(m.currentValue&&m.currentValue.userId===a){var d=_.isArray(b)?b:f.getAccessorPathSegments(b);if(0===d.length||0===d[0].length)throw new FifthweekError("Cannot set directly to aggregate root.");var e=_.cloneDeep(m.currentValue),g=f.getValue(e,_.initial(d));if(void 0===g)throw new FifthweekError('Parent object for "'+b+'" does not exist in existing aggregate state');g[_.last(d)]=c,j(e)}},m}]),angular.module("webApp").constant("fetchAggregateUserStateConstants",{updateAccessSignaturesEvent:"updateAccessSignatures",fetchedEvent:"aggregateUserStateFetched",refreshIfStaleMilliseconds:18e5}).factory("fetchAggregateUserState",["$q","$rootScope","fetchAggregateUserStateConstants","userStateStub",function(a,b,c,d){"use strict";var e=function(d,e){return d===g.lastUserId&&(b.$broadcast(c.updateAccessSignaturesEvent,d,e.data),b.$broadcast(c.fetchedEvent,d,e.data)),a.when({userId:d,userState:e.data})},f=function(){var a=new Date;return!g.lastUpdate||a.getTime()-g.lastUpdate>=c.refreshIfStaleMilliseconds},g={},h={internal:{cache:g}};return h.updateFromServer=function(a){if(g.currentRequest&&g.lastUserId===a)return g.currentRequest;var b=new Date;g.lastUpdate=b.getTime(),g.lastUserId=a,g.currentRequest=void 0;var c,f=_.curry(e)(a);return c=a?d.getUserState(a).then(f):d.getVisitorState().then(f),g.currentRequest=c,c["finally"](function(){g.currentRequest=void 0}),c},h.updateIfStale=function(b){return h.waitForExistingUpdate().then(function(){return f()||g.lastUserId!==b?h.updateFromServer(b):a.when()})},h.waitForExistingUpdate=function(){return g.currentRequest?g.currentRequest.then(function(){return a.when(!0)}):a.when(!1)},h.updateInParallel=function(b,c){return a.all([c(),h.updateFromServer(b)]).then(function(b){return a.when(b[0])})},h}]),angular.module("webApp").factory("masterRepositoryFactory",["$q","aggregateUserState","authenticationService","utilities","fetchAggregateUserState",function(a,b,c,d,e){"use strict";return{forCurrentUser:function(){var f={},g=f.internal={},h=c.currentUser.userId,i=function(){return!c.currentUser||c.currentUser.userId!==h};return g.ensureUserState=function(){return e.waitForExistingUpdate().then(function(){return!b.currentValue||b.isCurrentValueStale?e.updateFromServer():a.when()})},f.getUserId=function(){return h},f.set=function(c,d){if(i())return a.when();if(!b.currentValue)return a.reject(new FifthweekError("No aggregate state found."));var e=_.cloneDeep(d);return b.setDelta(h,c,e),a.when()},f.update=function(c,e){if(i())return a.when();if(!b.currentValue)return a.reject(new FifthweekError("No aggregate state found."));var f=d.getAccessorPathSegments(c),g=d.getValue(b.currentValue,f);if(void 0===g)return a.reject(new FifthweekError('The key "'+c+'" does not match anything within the aggregate user state.'));var j,k=_.cloneDeep(g);try{j=a.when(e(k))}catch(l){j=a.reject(l)}return j.then(function(){b.setDelta(h,c,k)})},f.get=function(c,e){return i()?a.reject(new FifthweekError("Repository not valid for current user.")):g.ensureUserState().then(function(){var f=d.getValue(b.currentValue,c);if(void 0===f)return e?a.when():a.reject(new FifthweekError('The key "'+c+'" does not match anything within the aggregate user state.'));var g=_.cloneDeep(f);return a.when(g)})},f}}}]),angular.module("webApp").factory("aggregateUserStateUtilities",["aggregateUserState",function(a){"use strict";var b={};return b.getUsername=function(){return a.currentValue&&a.currentValue.accountSettings?a.currentValue.accountSettings.username:void 0},b}]),angular.module("webApp").constant("subscriptionRepositoryFactoryConstants",{key:"subscriptions.blogs"}).factory("subscriptionRepositoryFactory",["$q","masterRepositoryFactory","subscriptionRepositoryFactoryConstants",function(a,b,c){"use strict";return{forCurrentUser:function(){var d=c.key,e=b.forCurrentUser(),f={};return f.getUserId=function(){return e.getUserId()},f.tryGetBlogs=function(){return e.getUserId()?e.get(d,!0):a.when()},f.getBlogs=function(){return e.get(d)},f.getBlogMap=function(){return f.tryGetBlogs().then(function(b){if(!b||!b.length)return a.when({});var c=_.reduce(b,function(a,b){return b.channels=_.reduce(b.channels,function(a,b){return a[b.channelId]=b,a},{}),a[b.blogId]=b,a},{});return a.when(c)})},f}}}]),angular.module("webApp").constant("blogRepositoryFactoryConstants",{blogKey:"blog",channelsKey:"blog.channels",queuesKey:"blog.queues"}).factory("blogRepositoryFactory",["$q","masterRepositoryFactory","blogRepositoryFactoryConstants",function(a,b,c){"use strict";return{forCurrentUser:function(){var d=c.blogKey,e=c.channelsKey,f=c.queuesKey,g=b.forCurrentUser(),h={};return h.internal={},h.getUserId=function(){return g.getUserId()},h.tryGetBlog=function(){return g.getUserId()?g.get(d,!0):a.when()},h.getBlog=function(){return g.get(d).then(function(b){return b?a.when(b):a.reject(new DisplayableError("You do not have a blog."))})},h.setBlog=function(a){return g.set(d,a)},h.getChannels=function(){return g.get(e).then(function(b){return b&&0!==b.length?a.when(b):a.reject(new DisplayableError("You must create a blog."))})},h.getQueues=function(){return g.get(f).then(function(b){return a.when(b)})},h.getChannelsSorted=function(){return h.getChannels().then(function(a){return _.sortByOrder(a,["name"],[!0])})},h.getQueuesSorted=function(){return h.getQueues().then(function(a){return _.sortByOrder(a,["name"],[!0])})},h.internal.getBlogMap=function(b){return g.get(d,!0).then(function(c){return c?(c.channels=_.reduce(c.channels,function(a,b){return a[b.channelId]=b,a},{}),c.queues=_.reduce(c.queues,function(a,b){return a[b.queueId]=b,a},{}),a.when(c)):b?a.when():a.reject(new DisplayableError("You must create a blog."))})},h.getBlogMap=function(){return h.internal.getBlogMap(!1)},h.tryGetBlogMap=function(){return g.getUserId()?h.internal.getBlogMap(!0):a.when()},h.updateChannels=function(a){return g.update(e,a)},h.updateQueues=function(a){return g.update(f,a)},h.getChannel=function(b){return h.getChannels().then(function(c){var d=_.find(c,{channelId:b});return d?d:a.reject(new DisplayableError("Channel not found."))})},h.createChannel=function(b){return h.updateChannels(function(c){return _.some(c,{channelId:b.channelId})?a.reject(new DisplayableError("Channel already exists.")):(c.push(b),a.when())})},h.createQueue=function(b){return h.updateQueues(function(c){return _.some(c,{queueId:b.queueId})?a.reject(new DisplayableError("Queue already exists.")):(c.push(b),a.when())})},h.updateChannel=function(b,c){return h.updateChannels(function(d){var e=_.find(d,{channelId:b});return e?a.when(c(e)):a.reject(new DisplayableError("Channel not found."))})},h.updateQueue=function(b,c){return h.updateQueues(function(d){var e=_.find(d,{queueId:b});return e?a.when(c(e)):a.reject(new DisplayableError("Queue not found."))})},h.deleteChannel=function(b){return h.updateChannels(function(c){return _.remove(c,{channelId:b}),a.when()})},h.deleteQueue=function(b){return h.updateQueues(function(c){return _.remove(c,{queueId:b}),a.when()})},h}}}]),angular.module("webApp").controller("listChannelsCtrl",["$scope","blogRepositoryFactory","errorFacade",function(a,b,c){"use strict";var d=b.forCurrentUser();a.model={},d.getChannelsSorted().then(function(b){a.model.channels=_.map(b,function(a){return{id:a.channelId,name:a.name,price:a.price,isVisibleToNonSubscribers:a.isVisibleToNonSubscribers}})})["catch"](function(b){return c.handleError(b,function(b){a.model.errorMessage=b})})}]),angular.module("webApp").controller("editChannelCtrl",["$scope","$q","$state","states","blogRepositoryFactory","channelStub","errorFacade",function(a,b,c,d,e,f,g){"use strict";var h=e.forCurrentUser(),i=c.params.id;a.previousState=d.creator.channels.name,a.model={},h.getChannel(i).then(function(b){a.model.savedChannelName=b.name,a.model.channel=b,a.model.channel.price=(a.model.channel.price/100).toFixed(2),a.model.channel.hidden=!a.model.channel.isVisibleToNonSubscribers,delete a.model.channel.isVisibleToNonSubscribers})["catch"](function(b){return g.handleError(b,function(b){a.model.errorMessage=b})}),a.save=function(){var b=a.model.channel,d={name:b.name,price:Math.round(100*b.price),isVisibleToNonSubscribers:!b.hidden};return f.putChannel(i,d).then(function(){return h.updateChannel(i,function(a){a.name=d.name,a.price=d.price,a.isVisibleToNonSubscribers=d.isVisibleToNonSubscribers}).then(function(){c.go(a.previousState)})})},a["delete"]=function(){return f.deleteChannel(i).then(function(){return h.deleteChannel(i).then(function(){c.go(a.previousState)})})}}]),angular.module("webApp").controller("newChannelCtrl",["$scope","$q","$state","states","channelStub","blogService","fetchAggregateUserState","authenticationService",function(a,b,c,d,e,f,g,h){"use strict";a.model={channel:{name:"",hidden:!1,price:"1.00"}},a.previousState=d.creator.channels.name,a.create=function(){var b=h.currentUser.userId,d=a.model.channel,i={blogId:f.blogId,name:d.name,price:Math.round(100*d.price),isVisibleToNonSubscribers:!d.hidden};return e.postChannel(i).then(function(){return g.updateFromServer(b)}).then(function(){c.go(a.previousState)})}}]),angular.module("webApp").directive("fwFormInputChannelName",["utilities",function(a){"use strict";return{restrict:"E",scope:!0,templateUrl:"modules/channels/directives/form-input-channel-name.html",link:function(b,c,d){a.forDirective(b,c,d).scaffoldFormInput()}}}]),angular.module("webApp").directive("fwFormInputChannelPrice",["utilities",function(a){"use strict";return{restrict:"E",scope:!0,templateUrl:"modules/channels/directives/form-input-channel-price.html",link:function(b,c,d){a.forDirective(b,c,d).scaffoldFormInput()}}}]),angular.module("webApp").directive("fwFormInputChannelVisibility",["utilities",function(a){"use strict";return{restrict:"E",scope:!0,templateUrl:"modules/channels/directives/form-input-channel-visibility.html",link:function(b,c,d){a.forDirective(b,c,d).scaffoldFormInput()}}}]),angular.module("webApp").directive("fwFormInputQueueName",["utilities",function(a){"use strict";return{restrict:"E",scope:!0,templateUrl:"modules/queues/directives/form-input-queue-name.html",link:function(b,c,d){a.forDirective(b,c,d).scaffoldFormInput()}}}]),angular.module("webApp").directive("fwFormInputSelectQueue",function(){"use strict";return{restrict:"E",scope:{items:"=",selectedItem:"=",inputId:"@"},templateUrl:"modules/queues/directives/form-input-select-queue.html"}}),angular.module("webApp").controller("listQueuesCtrl",["$scope","blogRepositoryFactory","errorFacade","releaseTimeFormatter",function(a,b,c,d){"use strict";var e=b.forCurrentUser();a.model={},e.getQueues().then(function(b){a.model.queues=_.chain(b).map(function(a){return{id:a.queueId,name:a.name,schedule:d.getDayAndTimesOfWeek(a.weeklyReleaseSchedule)}}).flatten().sortBy("name").value()})["catch"](function(b){return c.handleError(b,function(b){a.model.errorMessage=b})})}]),angular.module("webApp").controller("editQueueCtrl",["$scope","$state","states","queueService","blogRepositoryFactory","releaseTimeFormatter","errorFacade",function(a,b,c,d,e,f,g){"use strict";var h=b.params.id,i=e.forCurrentUser(),j=0,k=function(){a.model.schedule=_.sortBy(a.model.schedule,"sortKey")};a.previousState=c.creator.queues.name,a.model={releaseTimesDirty:!1,hourOfWeek:j},i.getQueues().then(function(b){var c=_.find(b,{queueId:h});a.model.savedName=c.name,a.model.name=c.name,a.model.schedule=f.getDayAndTimesOfWeek(c.weeklyReleaseSchedule),k()})["catch"](function(b){return g.handleError(b,function(b){a.model.errorMessage=b})}),a.mainFormDirty=function(){return a.manageQueueForm.$dirty||a.model.releaseTimesDirty},a.addReleaseTime=function(){a.model.addingReleaseTime=!0,a.model.hourOfWeek=j},a.manageReleaseTime=function(b){a.model.selectedReleaseTime=b,a.model.hourOfWeek=b.hourOfWeek},a.saveReleaseTime=function(){a.model.releaseTimesDirty=!0;var b=f.getDayAndTimeOfWeek(a.model.hourOfWeek);_.merge(a.model.selectedReleaseTime,b),a.model.selectedReleaseTime=null,k()},a.saveNewReleaseTime=function(){a.model.releaseTimesDirty=!0;var b=f.getDayAndTimeOfWeek(a.model.hourOfWeek);a.model.schedule.push(b),a.model.addingReleaseTime=!1,k()},a.save=function(){var c={name:a.model.name,weeklyReleaseSchedule:_.pluck(a.model.schedule,"hourOfWeek")};return d.updateQueue(h,c,i).then(function(){b.go(a.previousState)})},a["delete"]=function(){return d.deleteQueue(h,i).then(function(){b.go(a.previousState)})},a.deleteReleaseTime=function(){a.model.releaseTimesDirty=!0,_.remove(a.model.schedule,a.model.selectedReleaseTime),a.model.selectedReleaseTime=null}}]),angular.module("webApp").controller("newQueueCtrl",["$scope","$state","states","queueService","blogRepositoryFactory",function(a,b,c,d,e){"use strict";var f=e.forCurrentUser();a.previousState=c.creator.queues.name,a.model={queue:{name:""}},a.createQueue=function(){var c=a.model.queue.name;return d.createQueueFromName(c,f).then(function(){b.go(a.previousState)})}}]),angular.module("webApp").factory("queueService",["queueStub",function(a){"use strict";var b={};return b.createQueueFromName=function(b,c){return c.getBlog().then(function(c){return a.postQueue({blogId:c.blogId,name:b})}).then(function(a){var d={queueId:a.data.queueId,name:b,weeklyReleaseSchedule:[a.data.defaultWeeklyReleaseTime]};return c.createQueue(d).then(function(){return d.queueId})})},b.updateQueue=function(b,c,d){return a.putQueue(b,c).then(function(){return d.updateQueue(b,function(a){a.name=c.name,a.weeklyReleaseSchedule=c.weeklyReleaseSchedule})})},b.deleteQueue=function(b,c){return a.deleteQueue(b).then(function(){return c.deleteQueue(b)})},b}]),angular.module("webApp").factory("releaseTimeFormatter",function(){"use strict";var a={},b=168,c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=function(a,b){return(a%b+b)%b};return a.getDayOfWeek=function(a){if(!_.isNumber(a))throw new FifthweekError("Hour of week must be a number");if(0>a||a>=b)throw new FifthweekError("Hour of week must be between 0 and "+(b-1));return c[Math.floor(a/24)]},a.getDaysOfWeek=function(b){return _.map(b,a.getDayOfWeek)},a.getTimeOfWeek=function(a){var b=a%24+":00";return 4===b.length&&(b="0"+b),b},a.getDayAndTimeOfWeek=function(c){return{day:a.getDayOfWeek(c),time:a.getTimeOfWeek(c),hourOfWeek:c,sortKey:d(c-24,b)}},a.getDayAndTimesOfWeek=function(b){return _.map(b,a.getDayAndTimeOfWeek)},a}),angular.module("webApp").factory("composeUtilities",["errorFacade","queueStub",function(a,b){"use strict";var c={};return c.updateEstimatedLiveDate=function(c){c.queuedLiveDate=void 0,c.input.selectedQueue&&b.getLiveDateOfNewQueuedPost(c.input.selectedQueue.queueId).then(function(a){c.queuedLiveDate=new Date(a.data)})["catch"](function(b){return a.handleError(b,function(a){c.errorMessage=a})})},c}]),angular.module("webApp").controller("composePostCtrl",["$q","$state","$scope","postStub","initializer","composeUtilities","blogRepositoryFactory","errorFacade",function(a,b,c,d,e,f,g,h){"use strict";var i=g.forCurrentUser(),j={postLater:!1,postToQueue:!0,queuedLiveDate:void 0,committedChannel:void 0,channels:[],queues:[],isProcessing:!1,input:{content:void 0,selectedQueue:void 0,date:""},errorMessage:void 0};c.model=j;var k=this.internal={cancelWatch:void 0};c.commitChannel=function(a){j.committedChannel=a},c.postLater=function(){j.postLater=!0,f.updateEstimatedLiveDate(j);var a=c.$watch("model.input.date",function(a,b){a!==b&&(j.postToQueue=!1)}),b=c.$watch("model.input.selectedQueue",function(a,b){a!==b&&(j.postToQueue=!0,f.updateEstimatedLiveDate(j))});k.cancelWatch=function(){a(),b()}},c.cancelPostLater=function(){j.postLater=!1,k.cancelWatch(),k.cancelWatch=void 0},k.post=function(e){return e&&e.content?d.postPost(e).then(function(){b.reload(),c.$close()}):(j.errorMessage="Please provide some content.",a.when())},k.getPostData=function(){var a=j.input.content;return a?{channelId:j.committedChannel.channelId,content:a.serializedBlocks,fileIds:_.map(a.files,"fileId"),imageCount:a.imageCount,fileCount:a.fileCount,videoCount:a.videoCount,previewWordCount:a.previewWordCount,wordCount:a.wordCount,previewText:a.previewText,previewImageId:a.previewImageId}:{}},c.postNow=function(){var a=k.getPostData();return k.post(a)},c.postToBacklog=function(){var a=k.getPostData();return a.scheduledPostTime=j.postToQueue?void 0:j.input.date,a.queueId=j.postToQueue?j.input.selectedQueue.queueId:void 0,k.post(a)},k.updateIsProcessing=function(){j.isProcessing=!(!j.input.content||!j.input.content.busyBlockCount)},k.watchForBusyBlocks=function(){c.$watch("model.input.content",k.updateIsProcessing)},k.initialize=function(){return k.watchForBusyBlocks(),i.getChannelsSorted().then(function(a){return j.channels=a,1===a.length&&(j.committedChannel=a[0]),i.getQueuesSorted()}).then(function(a){j.queues=a,a.length>0?j.input.selectedQueue=a[0]:j.postToQueue=!1})["catch"](function(a){return h.handleError(a,function(a){c.model.errorMessage=a})})},e.initialize(k.initialize)}]),angular.module("webApp").factory("composeService",["$modal",function(a){"use strict";var b={};return b.compose=function(){return a.open({controller:"composePostCtrl",size:"lg",templateUrl:"modules/creator-compose/compose-post.html"})},b}]),angular.module("webApp").controller("createBlogCtrl",["$scope","$state","blogService","states",function(a,b,c,d){"use strict";a.newBlogData={name:"",basePrice:"0.50"};var e=function(){var b=_.cloneDeep(a.newBlogData);return b.basePrice=Math.round(100*b.basePrice),b};a["continue"]=function(){return c.createFirstBlog(e()).then(function(){b.go(d.creator.posts.live.name)})}}]),angular.module("webApp").controller("customizeLandingPageCtrl",["$scope","$q","$state","states","blogRepositoryFactory","aggregateUserStateUtilities","jsonService","blogStub","errorFacade","blobImageControlFactory","fifthweekConstants",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l={settings:void 0,errorMessage:void 0,landingPageUrl:void 0},m=e.forCurrentUser(),n=function(){return m.getBlog().then(function(b){l.settings=b,l.settings.description&&(l.settings.description=g.toSirTrevor([{type:"text",data:{format:"md",text:l.settings.description}}])),l.username=f.getUsername(),l.landingPageUrl=k.websiteRoot+l.username,b.headerImage?a.blobImage.update(b.headerImage.containerName,b.headerImage.fileId,!0):a.blobImage.update()})["catch"](function(a){return l.settings=void 0,i.handleError(a,function(a){l.errorMessage=a})})};a.blobImage=j.createControl(),a.model=l,n(),a.onUploadComplete=function(b){l.settings.headerImage=b,a.form.$setDirty(),a.blobImage.update(b.containerName,b.fileId,!1)},a.submitForm=function(){var b;l.settings.headerImage&&(b=l.settings.headerImage.fileId);var c={name:l.settings.name,introduction:l.settings.introduction,headerImageFileId:b,video:l.settings.video?l.settings.video:void 0,description:l.settings.description?l.settings.description.firstText:""};return h.putBlog(l.settings.blogId,c).then(function(){var a=_.cloneDeep(l.settings);return a.description=c.description,m.setBlog(a)}).then(function(){a.form.$setPristine()})}}]),angular.module("webApp").controller("guestListCtrl",["$scope","initializer","blogAccessStub","blogService","errorFacade",function(a,b,c,d,e){"use strict";var f={isLoading:!1,isEditing:!1,errorMessage:void 0,blogId:void 0,freeAccessUsers:void 0,invalidEmails:void 0,registeredCount:0,subscribedCount:0,input:{emailsText:""}};a.model=f;var g=this.internal={};g.loadForm=function(){f.blogId=d.blogId,f.blogId?g.refresh():f.errorMessage="You must create a blog before managing the guest list."},g.refresh=function(){return f.errorMessage=void 0,f.isLoading=!0,c.getFreeAccessList(f.blogId).then(function(a){g.processResult(a.data.freeAccessUsers)})["catch"](function(a){return e.handleError(a,function(a){f.errorMessage=a})})["finally"](function(){f.isLoading=!1})},g.processResult=function(a){if(a&&a.length){f.freeAccessUsers=a,f.input.emailsText=_.map(a,"email").join("\n"),f.registeredCount=_.filter(a,function(a){return a.username}).length;var b=0;_.forEach(a,function(a){a.channelIds&&a.channelIds.length?(++b,a.isSubscribed=!0):a.isSubscribed=!1}),f.subscribedCount=b}else f.freeAccessUsers=void 0,f.registeredCount=0,f.subscribedCount=0,f.input.emailsText=""},a.save=function(){var a={emails:f.input.emailsText.split("\n")};return c.putFreeAccessList(f.blogId,a).then(function(a){
return a.data&&a.data.invalidEmailAddresses?f.invalidEmails=a.data.invalidEmailAddresses:f.invalidEmails=void 0,f.isEditing=!1,g.refresh()})},a.editList=function(){f.errorMessage=void 0,f.isEditing=!0},a.viewList=function(){f.errorMessage=void 0,f.isEditing=!1},b.initialize(g.loadForm)}]),angular.module("webApp").controller("informationHeaderCtrl",["$q","$scope","authenticationService","initializer","aggregateUserStateConstants",function(a,b,c,d,e){"use strict";var f=this.internal={};f.update=function(){b.isAuthenticated=c.currentUser.authenticated},f.initialize=function(){b.$on(e.updatedEvent,f.update),f.update()},d.initialize(f.initialize)}]),angular.module("webApp").controller("submitFeedbackDialogCtrl",["$q","$scope","membershipStub",function(a,b,c){"use strict";var d=b.pages={form:0,done:1};b.model={page:d.form,trackingEventTitle:"Send Feedback",trackingEventCategory:"Feedback",input:{content:void 0}},b.submitFeedback=function(){var a={message:b.model.input.content?b.model.input.content.firstText:""};return c.postFeedback(a).then(function(){b.model.page=d.done})}}]),angular.module("webApp").factory("submitFeedbackService",["$modal",function(a){"use strict";var b={};return b.showDialog=function(){return a.open({controller:"submitFeedbackDialogCtrl",templateUrl:"modules/feedback/submit-feedback-dialog.html",size:"md",animation:!1}).result},b}]),angular.module("webApp").controller("fullSizeImageModalCtrl",["$scope","image","imageSource","accessSignatures","postInteractions",function(a,b,c,d,e){"use strict";d.getContainerAccessInformation(b.containerName).then(function(d){a.imagePath=d.uri+"/"+b.fileId+d.signature,a.image=b,a.imageSource=c}),a.openFile=function(a){return e.openFile(a)}}]),angular.module("webApp").factory("postUtilities",["$q","$state","states","accessSignatures","jsonService",function(a,b,c,d,e){"use strict";var f={};return f.internal={},f.internal.humanFileSize=function(a){var b=Math.floor(Math.log(a)/Math.log(1024));return 1*(a/Math.pow(1024,b)).toFixed(2)+" "+["bytes","KB","MB","GB","TB"][b]},f.internal.getImageUri=function(a,b,c){var d=c.accessMap.containerName[a.containerName];if(!d)return void 0;var e=a.fileId;return b&&(e=e+"/"+b),d.uri+"/"+e+d.signature},f.internal.processFileSource=function(a,b){if(b.readableSize=f.internal.humanFileSize(b.size),b.renderSize){a.renderSizeRatio=b.renderSize.height/b.renderSize.width*100+"%";var c=945,d=720,e=c/b.renderSize.width*b.renderSize.height;e>d&&(a.renderSizeMaximumWidth=c*(d/e))}},f.internal.processFileInformation=function(a,b,c,d){b.resolvedUri=f.internal.getImageUri(b,"feed",d),!b.resolvedUri&&c&&(b.isPreview=!0,b.resolvedUri=c.uri+c.signature)},f.internal.processFile=function(a,b,c,d,e){delete a.renderSizeRatio,delete a.renderSizeMaximumWidth,c&&f.internal.processFileSource(a,c),b&&f.internal.processFileInformation(a,b,d,e)},f.internal.calculateReadingTime=function(a){var b=200,c=2,d=2,e=a.wordCount-a.previewWordCount||0,f=a.imageCount-(a.image?1:0)||0,g=a.fileCount||0;a.readingTime=Math.round(e/b+f/c+g/d)},f.internal.processTimestamps=function(a){a.moment=moment(a.liveDate),a.liveIn=a.moment.fromNow()},f.internal.processFiles=function(a,b){f.internal.processFile(a,a.image,a.imageSource,a.imageAccessInformation,b),a.files&&_.forEach(a.files,function(a){f.internal.processFile(a,a.information,a.source,a.accessInformation,b)}),a.creator&&a.creator.profileImage&&(a.creator.profileImage.resolvedUri=f.internal.getImageUri(a.creator.profileImage,"footer",b))},f.internal.processAccess=function(a,b){var c=b.accountSettings&&(b.accountSettings.accountBalance>0||b.accountSettings.isRetryingPayment),d=!a.isSubscribed||a.isGuestList?0:a.channel.price,e=a.isSubscribed&&d<=a.channel.acceptedPrice;a.readAccess=!!(a.isOwner||a.isGuestList||a.isFreePost||a.isSubscribed&&c&&e),a.readAccessIgnoringPayment=!!(a.isOwner||a.isGuestList||a.isSubscribed||a.isFreePost),a.priceAccepted=!a.isSubscribed||d===a.channel.acceptedPrice,a.freePostsRemaining=b.accountSettings?b.accountSettings.freePostsRemaining:void 0},f.internal.processScheduledPost=function(a){a.isScheduled=_.has(a,"queueId"),a.isScheduled&&a.queueId&&(a.reorder=function(){b.go(c.creator.posts.scheduled.queues.reorder.name,{id:a.queueId})})},f.internal.processContent=function(a){a.content&&(a.blocks=e.fromJson(a.content),_.forEach(a.blocks,function(b){if(b.data.fileId){var c=_.find(a.files,function(a){return a.information.fileId===b.data.fileId});_.assign(b,c)}}))},f.internal.processPost=function(a,b,c){f.internal.populateCreatorInformation(a,c),f.internal.processAccess(a,c),f.internal.processTimestamps(a),f.internal.processFiles(a,c),f.internal.processScheduledPost(a),f.internal.processContent(a),f.internal.calculateReadingTime(a)},f.internal.processPosts=function(a,b){var c;_.forEach(a,function(a){f.internal.processPost(a,c,b),c=a})},f.internal.populateCreatorInformation=function(a,b){if(a.isOwner=!1,a.isSubscribed=!1,a.isGuestList=!1,a.creatorId===b.userId)a.isOwner=!0,f.internal.populateCurrentCreatorInformation(a,b);else{var c=b.subscriptionMap[a.blogId];c?(a.isGuestList=!!c.freeAccess,a.isSubscribed=!!c.channels[a.channelId],f.internal.populateCreatorInformationFromBlog(a,c)):f.internal.populateUnknownCreatorInformation(a)}},f.internal.populateCurrentCreatorInformation=function(a,b){var c=b.blog,d=b.accountSettings;a.channel=c.channels[a.channelId],a.queueId&&(a.queue=c.queues[a.queueId]),a.blog||(a.blog={name:c.name}),a.creator||(a.creator={username:d.username,profileImage:d.profileImage})},f.internal.populateCreatorInformationFromBlog=function(a,b){var c=b.channels[a.channelId];if(c&&(a.channel=c,a.queueId)){var d=b.queues[a.queueId];d&&(a.queue=d)}a.blog||(a.blog={name:b.name}),a.creator||(a.creator={username:b.username,profileImage:b.profileImage})},f.internal.populateUnknownCreatorInformation=function(a){a.channel||(a.channel={channelId:a.channelId,name:"Unknown Channel"}),!a.queue&&a.queueId&&(a.queue={queueId:a.queueId,name:"Unknown Queue"}),a.blog||(a.blog={name:"Unknown Blog"}),a.creator||(a.creator={username:"Unknown Creator",profileImage:void 0})},f.internal.getPopulatedCaches=function(b,c,e){var f={};return f.userId=c.getUserId(),d.getContainerAccessMap().then(function(a){return f.accessMap=a,e.getBlogMap()}).then(function(a){return f.subscriptionMap=a,c.tryGetBlogMap()}).then(function(a){return f.blog=a,b.getAccountSettings()}).then(function(b){return f.accountSettings=b,a.when(f)})},f.processPostsForRendering=function(b,c,d,e){return b&&0!==b.length?f.internal.getPopulatedCaches(c,d,e).then(function(a){f.internal.processPosts(b,a)}):a.when()},f.processPostForRendering=function(a,b,c,d){return f.internal.getPopulatedCaches(b,c,d).then(function(b){f.internal.processPost(a,void 0,b)})},f.removePost=function(a,b){if(a&&0!==a.length)for(var c=0;c<a.length;++c)if(a[c].postId===b)return void a.splice(c,1)},f.internal.backlogComparison=function(a,b){return a.moment.isBefore(b.moment)},f.internal.timelineComparison=function(a,b){return a.moment.isAfter(b.moment)||a.moment.isSame(b.moment)},f.replacePostAndReorderIfRequired=function(a,b,c,d){var e=!1;if(e=a?!d.isScheduled:d.isScheduled)return void f.removePost(b,d.postId);if(1===b.length||c.isSame(d.moment)){var g=_.findIndex(b,{postId:d.postId});return void(-1!==g&&(b[g]=d))}var h=f.internal.timelineComparison;a&&(h=f.internal.backlogComparison),f.removePost(b,d.postId);for(var i=0;i<b.length;++i)if(h(d,b[i]))return void b.splice(i,0,d);b.push(d)},f}]),angular.module("webApp").factory("postInteractions",["$q","$modal","accessSignatures","postStub",function(a,b,c,d){"use strict";var e={internal:{}};return e.viewImage=function(a,c){b.open({controller:"fullSizeImageModalCtrl",templateUrl:"modules/posts/full-size-image-modal.html",windowClass:"modal-fw-large-image",resolve:{image:function(){return a},imageSource:function(){return c}}})},e.openFile=function(a){return a.resolvedUri?void window.open(a.resolvedUri,"_blank"):c.getContainerAccessInformation(a.containerName).then(function(b){var c=b.uri+"/"+a.fileId+b.signature;window.open(c,"_blank")})},e.editPost=function(a){return b.open({controller:"postEditDialogCtrl",templateUrl:"modules/posts/post-edit-dialog.html",size:"lg",resolve:{initialPost:function(){return a}}})},e.viewPost=function(a,c){c&&(a.content=void 0);var d=function(b,c){a.likesCount=b,a.hasLiked=c},e=function(b){a.commentsCount=b},f=b.open({controller:"postDialogCtrl",templateUrl:"modules/posts/post-dialog.html",size:"lg",resolve:{post:function(){return a},updateLikeStatus:function(){return d},updateCommentsCount:function(){return e}}});return f.result},e.deletePost=function(a){return d.deletePost(a)},e.internal.likePost=function(b){return b.hasLiked=!0,b.likesCount+=1,d.postLike(b.postId)["catch"](function(c){return b.hasLiked=!1,b.likesCount-=1,a.reject(c)})},e.internal.unlikePost=function(b){return b.hasLiked=!1,b.likesCount-=1,d.deleteLike(b.postId)["catch"](function(c){return b.hasLiked=!0,b.likesCount+=1,a.reject(c)})},e.toggleLikePost=function(a){return a.hasLiked?e.internal.unlikePost(a):e.internal.likePost(a)},e.showComments=function(a,c,d){var e=b.open({controller:"commentsDialogCtrl",templateUrl:"modules/comments/comments-dialog.html",resolve:{postId:function(){return a},isCommenting:function(){return c},updateCommentsCount:function(){return d}}});return e.result},e}]),angular.module("webApp").constant("fwPostListConstants",{reloadEvent:"reloadPostList",sources:{creatorBacklog:"creator-backlog",creatorTimeline:"creator-timeline",timeline:"timeline",preview:"preview"}}).directive("fwPostList",["fwPostListConstants","fifthweekConstants","landingPageConstants",function(a,b,c){"use strict";return{restrict:"E",scope:{source:"@",userId:"@?",channelId:"@?"},require:["fwPostList"],templateUrl:"modules/posts/fw-post-list.html",controller:"fwPostListCtrl",link:function(d,e,f,g){d.fifthweekConstants=b,d.sources=a.sources,d.landingPageConstants=c;var h=g[0];h.initialize()}}}]),angular.module("webApp").controller("fwPostListCtrl",["$scope","$rootScope","$q","$state","states","landingPageConstants","fwPostListConstants","postInteractions","authenticationService","blogRepositoryFactory","accountSettingsRepositoryFactory","subscriptionRepositoryFactory","fetchAggregateUserState","postStub","errorFacade","postUtilities","fwSubscriptionInformationConstants",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";var r={posts:void 0,isLoading:!1,errorMessage:void 0};a.model=r;var s=this.internal={};s.loadNext=function(){return c.reject(new DisplayableError("Unknown fw-post-list source."))},s.loadPosts=function(){var a,b=function(){return s.loadNext(0,24)};return m.updateInParallel(s.currentUserId,b).then(function(b){return a=b.posts,p.processPostsForRendering(a,s.accountSettingsRepository,s.blogRepository,s.subscriptionRepository)}).then(function(){r.posts=a})},a.editPost=function(b){var c=h.editPost(b);c.result.then(function(c){if(c){var d=a.source===g.sources.creatorBacklog;p.replacePostAndReorderIfRequired(d,r.posts,b.moment,c)}})},a.viewPost=function(a){return h.viewPost(a,!0)},a.deletePost=function(a){return h.deletePost(a).then(function(){p.removePost(r.posts,a)})},a.viewImage=function(a,b){h.viewImage(a,b)},s.attachToReloadEvents=function(){a.$on(g.reloadEvent,s.reload),b.$on(q.subscriptionStatusChangedEvent,s.reload)},s.loadSettings=function(){if(s.accountSettingsRepository=k.forCurrentUser(),s.blogRepository=j.forCurrentUser(),s.subscriptionRepository=l.forCurrentUser(),s.currentUserId=i.currentUser.userId,s.timelineUserId=void 0,a.source===g.sources.creatorBacklog)s.timelineUserId=s.currentUserId,s.loadNext=function(){return n.getCreatorBacklog(s.timelineUserId).then(function(a){var b=a.data;return _.forEach(b,function(a){a.creatorId=s.currentUserId}),c.when({posts:b})})};else{var b;b=a.source===g.sources.preview?n.getPreviewNewsfeed:n.getNewsfeed,a.source===g.sources.creatorTimeline?s.timelineUserId=s.currentUserId:s.timelineUserId=a.userId;var d=a.channelId;s.loadNext=function(a,e){return b({creatorId:s.timelineUserId,startIndex:a,channelId:d,count:e}).then(function(a){return c.when(a.data)})}}return c.when()},s.reload=function(){return r.isLoading?c.when():(r.errorMessage=void 0,r.isLoading=!0,r.posts=void 0,s.loadSettings().then(function(){return s.loadPosts()})["finally"](function(){r.isLoading=!1})["catch"](function(a){return o.handleError(a,function(a){r.errorMessage=a})}))},this.initialize=function(){return s.attachToReloadEvents(),s.reload()}}]),angular.module("webApp").constant("postEditDialogConstants",{scheduleModes:{now:0,scheduled:1,queued:2}}).controller("postEditDialogCtrl",["$scope","$q","initialPost","postEditDialogConstants","composeUtilities","blobImageControlFactory","postEditDialogUtilities","errorFacade","initializer","blogRepositoryFactory","accountSettingsRepositoryFactory","subscriptionRepositoryFactory",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m=j.forCurrentUser(),n=k.forCurrentUser(),o=l.forCurrentUser(),p=function(a,b){return a===b||a-b===0},q=this.internal={};a.model={};var r=d.scheduleModes;a.scheduleModes=r,a.save=function(){return g.performSave(q.postId,a.model).then(function(){return g.applyChangesToPost(q.post,a.model,n,m,o)}).then(function(){a.$close(q.post)})},q.createModelFromPost=function(a){var b=r.now;a.isScheduled&&(b=a.queueId?r.queued:r.scheduled);var c=new Date(a.liveDate),d=new Date(a.liveDate);return d.setUTCSeconds(0,0),{savedScheduleMode:b,savedDate:c,queuedLiveDate:void 0,channelId:a.channelId,isProcessing:!1,input:{comment:a.comment,image:a.image,imageSource:a.imageSource,file:a.file,fileSource:a.fileSource,date:d,scheduleMode:b}}},q.updateIsProcessing=function(){a.model.isProcessing=!(!a.model.input.content||!a.model.input.content.busyBlockCount)},q.watchForBusyBlocks=function(){a.$watch("model.input.content",q.updateIsProcessing)},q.onInputDateChanged=function(b,c){p(b,c)||(a.model.input.scheduleMode=r.scheduled)},q.onSelectedQueueChanged=function(b,c){return b!==c?(a.model.input.scheduleMode=r.queued,e.updateEstimatedLiveDate(a.model)):void 0},q.updateContentFromPost=function(b){a.model.input.content={serializedBlocks:b.content,files:_.map(b.files,function(a){return{fileId:a.information.fileId,containerName:a.information.containerName,renderSize:a.source.renderSize,fileName:a.source.fileName+"."+a.source.fileExtension,fileSize:a.source.size}})}},this.initialize=function(){return q.postId=c.postId,a.model.isLoading=!0,g.getFullPost(c,n,m,o).then(function(b){return a.model=q.createModelFromPost(b),q.post=b,a.$watch("model.input.date",q.onInputDateChanged),q.watchForBusyBlocks(),q.updateContentFromPost(b),m.getQueuesSorted()}).then(function(b){return a.model.queues=b,b.length>0?(q.post.queueId?a.model.input.selectedQueue=_.find(a.model.queues,{queueId:q.post.queueId}):a.model.input.selectedQueue=b[0],a.$watch("model.input.selectedQueue",q.onSelectedQueueChanged),e.updateEstimatedLiveDate(a.model)):void 0}).then(function(){a.model.showContent=!0})["catch"](function(b){return h.handleError(b,function(b){a.model.errorMessage=b})})["finally"](function(){a.model.isLoading=!1})},i.initialize(this.initialize)}]),angular.module("webApp").factory("postEditDialogUtilities",["$q","postEditDialogConstants","postStub","postUtilities",function(a,b,c,d){"use strict";var e=b.scheduleModes,f={};f.internal={};var g=function(a,b){return a===b||a-b===0},h=function(a){return a.replace(/^.*[\\\/]/,"")},i=function(a){return a.split(".").pop()},j=function(a,b){return a.substring(0,a.length-b.length-1)},k=function(a){return a.input.scheduleMode!==a.savedScheduleMode?!0:a.input.scheduleMode===e.scheduled?!g(a.savedDate,a.input.date):!1};return f.internal.getPostData=function(a){var b=a.input.content;return{content:b.serializedBlocks,fileIds:_.map(b.files,"fileId"),imageCount:b.imageCount,fileCount:b.fileCount,videoCount:b.videoCount,previewWordCount:b.previewWordCount,wordCount:b.wordCount,previewText:b.previewText,previewImageId:b.previewImageId}},f.internal.saveContent=function(a,b){var d=f.internal.getPostData(b);return c.putPost(a,d)},f.internal.saveSchedule=function(b,d){if(k(d)){if(d.input.scheduleMode===e.now)return c.postToLive(b);if(d.input.scheduleMode===e.queued)return c.putQueue(b,d.input.selectedQueue.queueId);if(d.input.scheduleMode===e.scheduled)return c.putLiveDate(b,d.input.date)}return a.when()},f.getFileInformation=function(a){var b=h(a.file.name),c=i(b),d=j(b,c);return{file:{fileId:a.fileId,containerName:a.containerName},fileSource:{fileName:d,fileExtension:c,contentType:a.file.type,size:a.file.size}}},f.performSave=function(a,b){return f.internal.saveContent(a,b).then(function(){return f.internal.saveSchedule(a,b)})},f.internal.applyContentChangesToPost=function(a,b){a.previewText=b.input.content.previewText;var c=b.input.content.previewImageId;if(c){var d=_.find(b.input.content.files,{fileId:c});a.image={fileId:d.fileId,containerName:d.containerName},a.imageSource={renderSize:d.renderSize}}else a.image=void 0,a.imageSource=void 0},f.internal.applySchedulingChangesToPost=function(a,b){if(k(b))if(b.input.scheduleMode===e.now)delete a.queueId,a.liveDate=(new Date).toISOString();else if(b.input.scheduleMode===e.queued)a.queueId=b.input.selectedQueue.queueId,a.liveDate=b.queuedLiveDate.toISOString();else if(b.input.scheduleMode===e.scheduled){var c=moment();c.isBefore(b.input.date)?a.queueId=void 0:delete a.queueId,a.liveDate=b.input.date.toISOString()}},f.applyChangesToPost=function(a,b,c,e,g){return f.internal.applyContentChangesToPost(a,b),f.internal.applySchedulingChangesToPost(a,b),d.processPostForRendering(a,c,e,g)},f.internal.assignQueueIdIfRequired=function(a,b){a.isScheduled&&(b.queueId=a.queueId)},f.getFullPost=function(a,b,e,g){var h;return c.getPost(a.postId).then(function(c){return h=c.data.post,h.files=c.data.files,f.internal.assignQueueIdIfRequired(a,h),d.processPostForRendering(h,b,e,g)}).then(function(){return h})},f}]),angular.module("webApp").directive("fwPostListInformation",["fwPostListConstants","fifthweekConstants",function(a,b){"use strict";return{restrict:"E",scope:{source:"@",userId:"@?"},require:["fwPostListInformation"],templateUrl:"modules/posts/fw-post-list-information.html",controller:"fwPostListInformationCtrl",link:function(c,d,e,f){c.fifthweekConstants=b,c.sources=a.sources;var g=f[0];g.initialize()}}}]),angular.module("webApp").controller("fwPostListInformationCtrl",["$scope","$q","fwPostListConstants","subscriptionRepositoryFactory","aggregateUserStateConstants","subscriptionStub","fetchAggregateUserState","$state","states","errorFacade","landingPageConstants",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=d.forCurrentUser(),m=this.internal={},n=a.model={hasFreeAccess:!1,updatedPrices:[],errorMessage:void 0};m.loadSubscribedBlogInformation=function(a,b){if(n.hasFreeAccess=!1,n.updatedPrices=[],b){if(a){var c=_.find(b,{creatorId:a});b=[],c&&(b.push(c),n.hasFreeAccess=c.freeAccess)}_.forEach(b,function(a){_.forEach(a.channels,function(b){var c=a.freeAccess?0:b.price;b.acceptedPrice!==c&&n.updatedPrices.push({currentPrice:c,isIncrease:b.acceptedPrice<c,blog:a,channel:b})})})}},m.load=function(){return a.source===c.sources.timeline||a.source===c.sources.preview?m.loadForCreator(a.userId)["catch"](function(a){return j.handleError(a,function(a){n.errorMessage=a})}):b.when()},m.loadForCreator=function(a){return l.tryGetBlogs().then(function(c){return m.loadSubscribedBlogInformation(a,c),b.when()})},a.acceptPrice=function(b){return f.putChannelSubscription(b.channel.channelId,{acceptedPrice:b.currentPrice}).then(function(){if(_.remove(n.updatedPrices,b),!b.isIncrease){var d=l.getUserId();return g.updateFromServer(d)}a.$emit(c.reloadEvent)})["catch"](function(a){return j.handleError(a,function(a){n.errorMessage=a})})},a.manageSubscription=function(a){var b=h.current.name===i.landingPage.name?void 0:h.current.name;h.go(i.landingPage.name,{username:a.blog.username,action:k.actions.manage,key:b})},this.initialize=function(){m.load(),a.$on(e.updatedEvent,m.load)}}]),angular.module("webApp").directive("fwPostListHeader",["fifthweekConstants",function(a){"use strict";return{restrict:"E",scope:{source:"@",userId:"@?",channelId:"@?"},require:["fwPostListHeader"],templateUrl:"modules/posts/fw-post-list-header.html",controller:"fwPostListHeaderCtrl",link:function(b,c,d,e){b.fifthweekConstants=a;var f=e[0];f.initialize()}}}]),angular.module("webApp").controller("fwPostListHeaderCtrl",["$scope","$q","fwPostListConstants","subscriptionRepositoryFactory","blogRepositoryFactory","aggregateUserStateConstants","errorFacade",function(a,b,c,d,e,f,g){"use strict";var h=d.forCurrentUser(),i=e.forCurrentUser(),j=this.internal={},k=a.model={channelName:void 0,errorMessage:void 0};j.loadFromBlogs=function(a,b,c){if(a&&b){var d,e=_.find(c,{creatorId:a});b&&e.channels&&(d=_.find(e.channels,{channelId:b})),d&&(k.channelName=d.name)}},j.getSubscribedBlogs=function(){return h.tryGetBlogs().then(function(a){return a?a:[]})},j.getCreatorBlog=function(){return i.tryGetBlog().then(function(b){return b?(b.creatorId=a.userId,[b]):[]})},j.load=function(){k.errorMessage=void 0,k.channelName=void 0;var c;return c=a.userId===h.getUserId()?j.getCreatorBlog():j.getSubscribedBlogs(),c.then(function(c){return j.loadFromBlogs(a.userId,a.channelId,c),b.when()})["catch"](function(a){return g.handleError(a,function(a){k.errorMessage=a})})},this.initialize=function(){a.$on(f.updatedEvent,j.load)}}]),angular.module("webApp").controller("postDialogCtrl",["$scope","post","updateLikeStatus","updateCommentsCount",function(a,b,c,d){"use strict";a.updateLikeStatus=function(a,b){c&&c(a,b)},a.updateCommentsCount=function(a){d&&d(a)},a.post=b}]),angular.module("webApp").directive("fwFullPost",["landingPageConstants","fifthweekConstants",function(a,b){"use strict";return{restrict:"E",scope:{post:"=?",postId:"@?",updateCommentsCount:"&?",updateLikeStatus:"&?",closeDialog:"&?"},require:["fwFullPost"],templateUrl:"modules/posts/fw-full-post.html",controller:"fwFullPostCtrl",link:function(c,d,e,f){c.fifthweekConstants=b,c.landingPageConstants=a,c.isDialog=!!c.closeDialog,c.closeIfDialog=function(){c.isDialog&&c.closeDialog()};var g=f[0];g.initialize()}}}]),angular.module("webApp").controller("fwFullPostCtrl",["$scope","$q","errorFacade","initializer","postStub","aggregateUserStateConstants","uiRouterConstants","fullPostLoader","postInteractions","blogRepositoryFactory","accountSettingsRepositoryFactory","subscriptionRepositoryFactory","signInWorkflowService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";var n=j.forCurrentUser(),o=k.forCurrentUser(),p=l.forCurrentUser(),q=this.internal={},r=a.model={userId:n.getUserId()};q.showComments=function(b,c){var d=function(c){b.commentsCount=c,a.updateCommentsCount&&a.updateCommentsCount({totalComments:c})};return i.showComments(b.postId,c,d)},a.commentOnPost=function(a){return q.showComments(a,!0)},a.viewComments=function(a){return q.showComments(a,!1)},a.viewImage=function(a,b){i.viewImage(a,b)},a.openFile=function(a){return i.openFile(a)},a.toggleLikePost=function(b){return i.toggleLikePost(b).then(function(){a.updateLikeStatus&&a.updateLikeStatus({likesCount:b.likesCount,hasLiked:b.hasLiked})})["catch"](function(a){return c.handleError(a,function(a){r.errorMessage=a})})},a.requestFreePost=function(){return q.reloadPost(!0).then(function(a){return a!==!1?o.decrementFreePostsRemaining():void 0})},q.getFullPost=function(a,b){return h.loadPost(a,o,n,p,b)},q.replaceHiddenCharacters=function(a){if(!a.readAccess){var b="";_.forEach(a.blocks,function(a){"text"===a.type&&(a.data.text=a.data.text.replace(//g,b))})}},q.ensureSignedIn=function(){return r.userId?b.when(!0):m.beginSignInWorkflow()},q.reloadPost=function(a){return o=k.forCurrentUser(),n=j.forCurrentUser(),p=l.forCurrentUser(),r.userId=n.getUserId(),a?q.ensureSignedIn().then(function(a){return a?q.loadPost(q.requestFreePostFromApi):b.when(!1)}):q.loadPost(q.loadFullPostFromApi)},q.loadFullPostFromApi=function(){return q.getFullPost(a.postId||a.post.postId,!1)},q.requestFreePostFromApi=function(){return q.getFullPost(a.postId||a.post.postId,!0)},q.getFullPostFromScope=function(){return b.when(a.post)},q.attachToEvents=function(){a.$on(f.updatedEvent,q.reloadPost),a.isDialog&&a.$on(g.stateChangeStartEvent,a.closeDialog)},q.loadPost=function(b){return r.isLoading=!0,r.showContent=!1,b().then(function(b){q.replaceHiddenCharacters(b),a.post=b,r.showContent=!0})["catch"](function(a){return c.handleError(a,function(a){r.errorMessage=a})})["finally"](function(){r.isLoading=!1})},this.initialize=function(){q.attachToEvents();var b;return b=a.post&&a.post.content?q.getFullPostFromScope:q.loadFullPostFromApi,q.loadPost(b)}}]),angular.module("webApp").factory("fullPostLoader",["$q","postStub","postUtilities",function(a,b,c){"use strict";var d={};return d.loadPost=function(a,d,e,f,g){var h;return b.getPost(a,!!g).then(function(a){return h=a.data.post,h.files=a.data.files,c.processPostForRendering(h,d,e,f)}).then(function(){return h})},d}]),angular.module("webApp").factory("blogService",["$rootScope","$q","blogStub","aggregateUserState","authenticationService","blogRepositoryFactory",function(a,b,c,d,e,f){"use strict";var g=Object.create({},{blogId:{get:function(){return d.currentValue&&d.currentValue.blog?d.currentValue.blog.blogId:void 0}},hasBlog:{get:function(){return!!g.blogId}}});return g.createFirstBlog=function(a){if(g.hasBlog)return b.reject(new FifthweekError("Blog already created"));var d=f.forCurrentUser();return c.postBlog(a).then(function(b){var c=b.data,e={blogId:c.blogId,name:a.name,introduction:a.introduction,creationDate:new Date,channels:[{channelId:c.channelId,name:a.name,price:a.basePrice,isVisibleToNonSubscribers:!0}],queues:[]};return d.setBlog(e)})},g}]),angular.module("webApp").directive("fwFormInputBlogName",["utilities",function(a){"use strict";return{restrict:"E",scope:!0,templateUrl:"modules/blog/directives/form-input-blog-name.html",link:function(b,c,d){a.forDirective(b,c,d).scaffoldFormInput()}}}]),angular.module("webApp").directive("fwFormInputIntroduction",["utilities",function(a){"use strict";return{restrict:"E",scope:!0,templateUrl:"modules/blog/directives/form-input-introduction.html",link:function(b,c,d){a.forDirective(b,c,d).scaffoldFormInput()}}}]),angular.module("webApp").directive("fwAccountBalanceWarning",["fifthweekConstants",function(a){"use strict";return{restrict:"E",scope:{displayingAccountBalanceWarning:"="},require:["fwAccountBalanceWarning"],templateUrl:"modules/payments/fw-account-balance-warning.html",controller:"fwAccountBalanceWarningCtrl",link:function(b,c,d,e){b.fifthweekConstants=a;var f=e[0];f.initialize()}}}]),angular.module("webApp").controller("fwAccountBalanceWarningCtrl",["$scope","accountSettingsRepositoryFactory","subscriptionRepositoryFactory","aggregateUserStateConstants","errorFacade",function(a,b,c,d,e){"use strict";var f=b.forCurrentUser(),g=c.forCurrentUser(),h={isLoaded:!1,errorMessage:void 0};a.model=h;var i=this.internal={};i.updateModel=function(b,c){b?(h.accountBalance=b.accountBalance,h.isRetryingPayment=b.isRetryingPayment,h.paymentFailed="Failed"===b.paymentStatus,h.hasPaymentInformation=b.hasPaymentInformation):(h.accountBalance=0,h.isRetryingPayment=!1,h.paymentFailed=!1,h.hasPaymentInformation=!1),c?(h.hasFreeAccessBlogs=_.some(c,"freeAccess"),h.hasPaidBlogs=_.some(c,"freeAccess",!1)):(h.hasFreeAccessBlogs=!1,h.hasPaidBlogs=!1),a.displayingAccountBalanceWarning=h.accountBalance<=0&&!h.isRetryingPayment&&h.hasPaidBlogs},i.reload=function(){return f=b.forCurrentUser(),g=c.forCurrentUser(),i.load()},i.load=function(){h.isLoaded=!1;var a;return f.tryGetAccountSettings().then(function(b){return a=b,g.tryGetBlogs()}).then(function(b){return i.updateModel(a,b)})["catch"](function(a){return e.handleError(a,function(a){h.errorMessage=a})})["finally"](function(){h.isLoaded=!0})},this.initialize=function(){return a.$on(d.updatedEvent,i.reload),i.load()}}]),angular.module("webApp").constant("fwUpdatePaymentInformationConstants",{modes:{paymentInformation:"paymentInformation",countryVerification:"countryVerification",transactionVerification:"transactionVerification",countryFailure:"countryFailure",success:"success"}}).directive("fwUpdatePaymentInformation",["fifthweekConstants","fwUpdatePaymentInformationConstants",function(a,b){"use strict";return{restrict:"E",scope:{},require:["fwUpdatePaymentInformation"],templateUrl:"modules/payments/fw-update-payment-information.html",controller:"fwUpdatePaymentInformationCtrl",link:function(c,d,e,f){c.fifthweekConstants=a,c.modes=b.modes;var g=f[0];g.initialize()}}}]),angular.module("webApp").controller("fwUpdatePaymentInformationCtrl",["$scope","$state","$q","accountSettingsRepositoryFactory","stripeService","paymentsStub","fetchAggregateUserState","fwUpdatePaymentInformationConstants","errorFacade","authenticationService","authenticationServiceConstants",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l=d.forCurrentUser(),m={isLoaded:!1,errorMessage:void 0,success:!1,userId:l.getUserId(),mode:h.modes.paymentInformation,input:{creditCardNumber:void 0,expiry:void 0,cvc:void 0},creditRequestSummary:void 0};a.model=m;var n=this.internal={token:void 0,paymentOrigin:void 0};n.resetForm=function(){m.input.creditCardNumber=void 0,m.input.expiry=void 0,m.input.cvc=void 0,m.creditRequestSummary=void 0,n.token=void 0,n.paymentOrigin=void 0,m.mode=h.modes.paymentInformation},n.createFailedToDetermineCountryError=function(){return new FifthweekError("Failed to determine country with three pieces of evidence: "+n.paymentOrigin.countryCode+", "+n.paymentOrigin.creditCardPrefix+", "+n.paymentOrigin.ipAddress+", for user "+m.userId)},n.updatePaymentInformationWithoutCharge=function(){return f.putPaymentOrigin(m.userId,n.paymentOrigin).then(function(){return g.updateFromServer(m.userId)}).then(function(){m.success=!0,n.resetForm()})},n.requiresCharge=function(){return!m.hasPaymentInformation||m.hasPaymentFailed||m.accountBalance<=0},n.getCreditRequestSummary=function(a){return n.paymentOrigin={stripeToken:n.token.id,countryCode:a,creditCardPrefix:m.input.creditCardNumber.substring(0,6),ipAddress:n.token.client_ip},f.getCreditRequestSummary(m.userId,n.paymentOrigin.countryCode,n.paymentOrigin.creditCardPrefix,n.paymentOrigin.ipAddress).then(function(b){var d=b.data;if(d.calculation.countryName){if(!n.requiresCharge())return n.updatePaymentInformationWithoutCharge();m.creditRequestSummary=d,m.mode=h.modes.transactionVerification}else{if(a)return c.reject(n.createFailedToDetermineCountryError());m.creditRequestSummary=d,m.mode=h.modes.countryVerification}return c.when()})},n.handleError=function(a){return n.resetForm(),i.handleError(a,function(a){m.errorMessage=a})},n.stripeResponseHandler=function(a,b){return b.error?(m.errorMessage=b.error.message,c.when()):(n.token=b,n.getCreditRequestSummary(void 0)["catch"](n.handleError))},n.isStandardUser=function(){var a=j.currentUser;return!_.includes(a.roles,k.roles.testUser)},a.confirmCountry=function(a){return n.getCreditRequestSummary(a)["catch"](n.handleError)},a.failConfirmCountry=function(){m.mode=h.modes.countryFailure},a.confirmTransaction=function(){return f.putPaymentOrigin(m.userId,n.paymentOrigin).then(function(){var a={amount:m.creditRequestSummary.calculation.amount,expectedTotalAmount:m.creditRequestSummary.calculation.totalAmount};return f.postCreditRequest(m.userId,a)}).then(function(){return g.updateFromServer(m.userId)}).then(function(){m.success=!0,n.resetForm()})["catch"](n.handleError)},a.cancel=function(){b.reload()},a.submit=function(){m.success=!1;var a=n.isStandardUser(),b=m.input.expiry.split("/");return e.createToken(a,m.input.creditCardNumber,m.input.cvc,b[0],b[1],n.stripeResponseHandler)["catch"](n.handleError)},this.initialize=function(){return l.getAccountSettings().then(function(a){m.hasPaymentInformation=a.hasPaymentInformation,m.hasPaymentFailed="Failed"===a.paymentStatus,m.email=a.email,m.accountBalance=a.accountBalance})["finally"](function(){
m.isLoaded=!0})}}]),angular.module("webApp").controller("updatePaymentInformationCtrl",["$scope","initializer","accountSettingsRepositoryFactory","paymentsStub","errorFacade","fetchAggregateUserState","aggregateUserStateConstants",function(a,b,c,d,e,f,g){"use strict";var h=c.forCurrentUser(),i={errorMessage:void 0,hasPaymentInformation:!0,userId:h.getUserId(),accountBalance:void 0};a.model=i;var j=this.internal={};j.loadForm=function(){return h.getAccountSettings().then(function(a){i.hasPaymentInformation=a.hasPaymentInformation,i.accountBalance=a.accountBalance})["catch"](function(a){return i.hasPaymentInformation=!0,e.handleError(a,function(a){i.errorMessage=a})})},j.initialize=function(){return a.$on(g.updatedEvent,j.loadForm),j.loadForm()},a.deletePaymentInformation=function(){return d.deletePaymentInformation(i.userId).then(function(){return f.updateFromServer(i.userId)})["catch"](function(a){return i.hasPaymentInformation=!0,e.handleError(a,function(a){i.errorMessage=a})})},b.initialize(j.initialize)}]),angular.module("webApp").factory("stripeService",["$q",function(a){"use strict";var b={};return b.createToken=function(b,c,d,e,f,g){var h=a.defer(),i=function(a,b){g(a,b).then(function(){h.resolve()})["catch"](function(a){h.reject(a)})};try{b?Stripe.setPublishableKey(window.liveStripeKey):Stripe.setPublishableKey(window.testStripeKey),a.when(Stripe.card.createToken({number:c,cvc:d,exp_month:e,exp_year:f},i))["catch"](function(a){h.reject(a)})}catch(j){h.reject(j)}return h.promise},b}]),angular.module("webApp").controller("viewSubscribersCtrl",["$scope","initializer","blogRepositoryFactory","accountSettingsRepositoryFactory","blogStub","errorFacade",function(a,b,c,d,e,f){"use strict";var g=c.forCurrentUser(),h=d.forCurrentUser(),i=a.model={isLoading:!1,errorMessage:void 0,userId:g.getUserId(),subscribers:[],unreleasedRevenue:void 0,releasedRevenue:void 0,releasableRevenue:void 0},j=this.internal={};j.blog=void 0,j.accountSettings=void 0,j.processSubscribers=function(){var a=0,b=0,c=0,d=0,e=0;_.forEach(i.subscribers,function(f){f.isBillable=f.hasPaymentInformation&&"failed"!==f.paymentStatus,f.isBillable&&++e,f.shouldDisplay=!1,_.forEach(f.channels,function(e){var g=j.blog.channels[e.channelId];g?(e.name=g.name,e.acceptedPrice>=g.price?(f.isBillable?(a+=g.price*j.accountSettings.creatorPercentage,++c,f.shouldDisplay=!0):++b,e.isPaying=!0):f.freeAccessEmail?(e.isPaying=!1,++c,f.shouldDisplay=!0):(e.isPaying=!1,f.isBillable&&(++d,f.shouldDisplay=!0))):e.name="Unknown Channel"})}),i.estimatedWeeklyRevenue=a,i.estimatedFailedPayments=b,i.totalSubscriptions=c,i.unacceptablePrices=d,i.billableSubscribers=e},j.loadForm=function(){return i.isLoading=!0,h.getAccountSettings().then(function(a){return j.accountSettings=a,g.getBlogMap()}).then(function(a){return j.blog=a,e.getSubscriberInformation(j.blog.blogId)}).then(function(a){i.subscribers=a.data.subscribers,i.unreleasedRevenue=a.data.unreleasedRevenue,i.releasedRevenue=a.data.releasedRevenue,i.releasableRevenue=a.data.releasableRevenue,j.processSubscribers()})["catch"](function(a){return f.handleError(a,function(a){i.errorMessage=a})})["finally"](function(){i.isLoading=!1})},j.initialize=function(){return j.loadForm()},b.initialize(j.initialize)}]),angular.module("webApp").controller("viewSubscriptionsCtrl",["$scope","initializer","aggregateUserStateConstants","subscriptionRepositoryFactory","accountSettingsRepositoryFactory","fetchAggregateUserState","landingPageConstants","fwPostListConstants","errorFacade",function(a,b,c,d,e,f,g,h,i){"use strict";var j=d.forCurrentUser(),k=e.forCurrentUser();a.landingPageConstants=g,a.fwPostListConstants=h;var l=a.model={errorMessage:void 0,userId:k.getUserId(),blogs:[],accountBalance:void 0},m=this.internal={};m.processBlogs=function(){var a=0,b=0;_.forEach(l.blogs,function(c){c.freeAccess||_.forEach(c.channels,function(c){c.acceptedPrice>=c.price?a+=c.price:b+=c.price})}),l.totalAcceptedPrice=a,l.totalChangedPrice=b},m.loadForm=function(){return k.getAccountSettings().then(function(a){return l.accountBalance=a.accountBalance,j.getBlogs()}).then(function(a){l.blogs=a,m.processBlogs()})["catch"](function(a){return i.handleError(a,function(a){l.errorMessage=a})})},m.refreshUserState=function(){return f.updateFromServer(l.userId)["catch"](function(a){return i.handleError(a,function(a){l.errorMessage=a})})},m.initialize=function(){return a.$on(c.updatedEvent,m.loadForm),a.$on(h.reloadEvent,m.refreshUserState),m.loadForm().then(function(){return m.refreshUserState()})},b.initialize(m.initialize)}]),angular.module("webApp").controller("transactionsCtrl",["$scope","initializer","paymentsStub","errorFacade","impersonationService","userStateStub","$interval",function(a,b,c,d,e,f,g){"use strict";a.refundReasons={requestedByCustomer:"requestedByCustomer",duplicate:"duplicate",fraudulent:"fraudulent"};var h=a.model={isLoading:!1,errorMessage:void 0,records:[],record:void 0,selectedRecords:[],filter:{startDate:void 0,endTimestamp:void 0,userId:void 0},input:{comment:void 0,refundAmount:0,refundReason:a.refundReasons.requestedByCustomer},leaseId:void 0,leaseTimeRemaining:0},i=this.internal={};i.stringToColor=function(a){for(var b=0,c=0;b<a.length;c=a.charCodeAt(b++)+((c<<5)-c));for(var d=0,e="#";3>d;e+=("00"+(c>>8*d++&255).toString(16)).slice(-2));return e},i.loadForm=function(){return h.isLoading=!0,h.records=[],h.record=void 0,h.selectedRecords=[],c.getTransactions(h.filter.userId,moment(h.filter.startTimestamp).toISOString(),moment(h.filter.endTimestamp).toISOString()).then(function(a){h.records=a.data.records,_.forEach(h.records,function(a){a.color=i.stringToColor(a.transactionReference)})})["catch"](function(a){return d.handleError(a,function(a){h.errorMessage=a})})["finally"](function(){h.isLoading=!1})},i.initialize=function(){return a.resetFilter(),i.loadForm()},i.refreshKeepingRecord=function(){var b=h.record.transactionReference;return i.loadForm().then(function(){var c=_.find(h.records,{transactionReference:b});return c?a.showDetail(c):void 0})},a.showDetail=function(a){return h.errorMessage=void 0,h.record=a,h.selectedRecords=_.where(h.records,{transactionReference:a.transactionReference}),h.recordJson=JSON.stringify(a,void 0,2),h.accountOwnerData=void 0,f.getUserState(h.record.accountOwnerId,!0).then(function(a){h.accountOwnerData=a.data})["catch"](function(a){return d.handleError(a,function(a){h.errorMessage=a})})},a.impersonate=function(a){return h.errorMessage=void 0,e.impersonate(a)},a.reverseTransaction=function(){return h.errorMessage=void 0,window.confirm("Are you sure you want to reverse the transaction?")?c.postTransactionRefund(h.record.transactionReference,{comment:h.input.comment}).then(function(){return i.refreshKeepingRecord()})["catch"](function(a){return d.handleError(a,function(a){h.errorMessage=a})}):void 0},a.refundCredit=function(){h.errorMessage=void 0;var a=h.input.refundAmount,b=Math.round(100*a);return window.confirm("Are you sure you want to refund $"+a.toFixed(2)+"?")?c.postCreditRefund(h.record.transactionReference,{comment:h.input.comment,refundCreditAmount:b,reason:h.input.refundReason}).then(function(){return i.refreshKeepingRecord()})["catch"](function(a){return d.handleError(a,function(a){h.errorMessage=a})}):void 0},a.filter=function(){return h.errorMessage=void 0,i.loadForm()},a.resetFilter=function(){h.errorMessage=void 0;var a=new Date,b=new Date;a.setMonth(a.getMonth()-1),h.filter.startTimestamp=a,h.filter.endTimestamp=b,h.filter.userId=void 0},i.decrementLeaseTimeRemaining=function(){h.leaseTimeRemaining&&(h.leaseTimeRemaining-=1,h.leaseTimeRemaining<0&&(h.leaseTimeRemaining=0))},i.setLeaseTimeRemaining=function(a){h.leaseTimePromise&&g.cancel(h.leaseTimePromise),h.leaseTimeRemaining=a,h.leaseTimePromise=g(i.decrementLeaseTimeRemaining,1e3,h.leaseTimeRemaining)},a.acquireLease=function(){return h.errorMessage=void 0,c.getPaymentProcessingLease(void 0).then(function(a){if(!a.data)throw new DisplayableError("Lease could not be acquired. Please try again shortly.");return h.leaseId=a.data.leaseId,i.setLeaseTimeRemaining(a.data.leaseLengthSeconds),i.refreshKeepingRecord()})["catch"](function(a){return d.handleError(a,function(a){h.errorMessage=a})})},a.renewLease=function(){return h.leaseId?h.leaseTimeRemaining?(h.errorMessage=void 0,c.getPaymentProcessingLease(h.leaseId).then(function(a){i.setLeaseTimeRemaining(a.data.leaseLengthSeconds)})["catch"](function(a){return d.handleError(a,function(a){h.errorMessage=a})})):void(h.errorMessage="Lease has expired"):void(h.errorMessage="No lease acquired.")},b.initialize(i.initialize)}]),angular.module("webApp").controller("objectLookupCtrl",["$scope","initializer","userStateStub","blogStub","errorFacade","impersonationService","authenticationService",function(a,b,c,d,e,f,g){"use strict";var h=a.model={errorMessage:void 0,lookupResult:void 0,userId:void 0,input:{value:void 0}};a.currentUser=g.currentUser;var i=this.internal={};i.initialize=function(){},i.performLookup=function(a,b){return a().then(function(a){h.lookupResult=JSON.stringify(a,void 0,2),b?h.userId=b(a):h.userId=void 0})["catch"](function(a){return h.lookupResult=JSON.stringify(a,void 0,2),e.handleError(a,function(a){h.errorMessage=a})})},a.lookupUsername=function(){return i.performLookup(function(){return d.getLandingPage(h.input.value)},function(a){return a.data.userId})},a.lookupUserId=function(){return i.performLookup(function(){return c.getUserState(h.input.value,!0)},function(){return h.input.value})},a.stopImpersonating=function(){f.impersonate(void 0)},a.startImpersonating=function(){h.userId&&f.impersonate(h.userId)},b.initialize(i.initialize)}]),angular.module("webApp").factory("impersonationInterceptor",["$injector",function(a){"use strict";var b,c="impersonate-user",d={};return d.request=function(d){return b=b||a.get("authenticationService"),b.currentUser.nonImpersonatedUserId&&(d.headers=d.headers||{},d.headers[c]=b.currentUser.userId),d},d}]),angular.module("webApp").constant("impersonationServiceConstants",{impersonationChangedEvent:"impersonationChanged"}).factory("impersonationService",["$rootScope","impersonationServiceConstants",function(a,b){"use strict";var c={};return c.internal={},c.impersonate=function(c){a.$broadcast(b.impersonationChangedEvent,c)},c}]),angular.module("webApp").directive("fwAssignCssClassIfImpersonating",["$state","authenticationService","authenticationServiceConstants",function(a,b,c){"use strict";return{restrict:"A",link:function(a,d){var e="impersonating-user",f=function(){d.addClass(e)},g=function(){d.removeClass(e)};b.currentUser.nonImpersonatedUserId&&f(),a.$on(c.currentUserChangedEvent,function(a,b){b.nonImpersonatedUserId?f():g()})}}}]),angular.module("webApp").controller("creatorRevenuesCtrl",["$scope","initializer","blogStub","errorFacade",function(a,b,c,d){"use strict";var e="AAAAAAAAAAAAAAAAAAAAAA2",f=a.model={errorMessage:void 0,isLoading:!1,creators:[]},g=this.internal={};g.initialize=function(){return g.refresh()},g.refresh=function(){return f.isLoading=!0,f.errorMessage=void 0,c.getCreatorRevenues().then(function(a){var b=a.data.creators;_.forEach(b,function(a){a.userId===e&&(a.username="Fifthweek",a.emailConfirmed=!0)}),f.creators=b})["catch"](function(a){return f.lookupResult=JSON.stringify(a,void 0,2),d.handleError(a,function(a){f.errorMessage=a})})["finally"](function(){f.isLoading=!1})},b.initialize(g.initialize)}]),angular.module("webApp").controller("SignInCtrl",["$scope","$state","calculatedStates","authenticationService",function(a,b,c,d){"use strict";a.signInData={username:"",password:""},a.signIn=function(){return d.signIn(a.signInData).then(function(){b.go(c.getDefaultState())})}}]),angular.module("webApp").controller("SignInForgotCtrl",["$q","$scope","membershipStub",function(a,b,c){"use strict";b.passwordResetRequestData={username:"",email:""},b.requestPasswordReset=function(){return c.postPasswordResetRequest(b.passwordResetRequestData)}}]),angular.module("webApp").controller("SignInResetCtrl",["$scope","$state","membershipStub","errorFacade",function(a,b,c,d){"use strict";var e=b.params.userId,f=b.params.token;return a.passwordResetConfirmationData={newPassword:"",userId:e,token:f},void 0===e||void 0===f?void(a.tokenInvalid=!0):(a.tokenInvalid=!1,a.confirmPasswordReset=function(){return c.postPasswordResetConfirmation(a.passwordResetConfirmationData)},void c.getPasswordResetTokenValidity(e,f)["catch"](function(b){return b instanceof ApiError&&404===b.response.status?void(a.tokenInvalid=!0):d.handleError(b,function(b){a.form.message=b})}))}]),angular.module("webApp").controller("RegisterCtrl",["$q","$scope","$state","analyticsEventConstants","calculatedStates","authenticationService",function(a,b,c,d,e,f){"use strict";b.registrationSucceeded=!1,b.tracking={eventCategory:d.registration.category,eventTitle:d.registration.title},b.registrationData={email:"",username:"",password:"",registerAsCreator:!1},b.register=function(){return f.registerUser(b.registrationData).then(function(){b.registrationSucceeded=!0,b.form.message="Signing in...";var a={username:b.registrationData.username,password:b.registrationData.password};return f.signIn(a)}).then(function(){c.go(e.getDefaultState())})["catch"](function(c){return b.registrationSucceeded=!1,a.reject(c)})}}]),angular.module("webApp").controller("HeaderCtrl",["$scope","navigationOrchestrator","navigationOrchestratorConstants",function(a,b,c){"use strict";a.$on(c.navigationChangedEvent,function(b,c,d){a.navigation=d}),a.navigation=b.getSecondaryNavigation(),a.titleToId=function(a){return"navigation-"+_.kebabCase(a)}}]),angular.module("webApp").controller("SidebarCtrl",["$scope","$state","navigationOrchestrator","navigationOrchestratorConstants",function(a,b,c,d){"use strict";a.$on(d.navigationChangedEvent,function(b,c){a.navigation=c}),a.navigation=c.getPrimaryNavigation(),a.navigate=function(a,c){return c?c():void b.go(a)}}]),angular.module("webApp").controller("deleteLinkCtrl",["$scope","deleteVerification",function(a,b){"use strict";a.verifyDelete=function(){b.verifyDelete(a["delete"],a.eventTitle,a.eventCategory,a.itemType,a.item)}}]),angular.module("webApp").controller("deleteVerificationCtrl",["$q","$scope","deleteContext",function(a,b,c){"use strict";b.model={confirmationText:"",itemTypeLowered:c.itemType.toLowerCase()},_.merge(b.model,c),b.confirmDelete=function(){return a.when(c.action()).then(function(){b.$close()})}}]),angular.module("webApp").controller("fileUploadCtrl",["$scope","$q","fileUploadStub","azureBlobUpload","utilities","logService",function(a,b,c,d,e,f){"use strict";var g=function(a,c){try{return _.isFunction(a)&&a({data:c}),b.when()}catch(d){return f.error(d),b.when()}},h=function(b){return g(a.onUploadComplete,b)},i=function(b){return g(a.onUploadStarted,b)},j=function(b){a.model.progress=Math.round(b)},k=function(b){a.model.errorMessage=b},l=function(b){a.model.isSubmitting=b},m=function(b){if(a.accept){var c=a.accept.split(/[\s,]+/);return _.includes(c,b.type)}return!0},n=function(c){if(!a.filePurpose)return b.reject(new InputValidationError("No file purpose specified."));if(!c||!c.length)return b.reject(new InputValidationError("No files selected."));var d=c[0];return m(d)?b.when(d):b.reject(new InputValidationError("The selected file type is not supported."))},o=function(b){var e;return i().then(function(){return c.postUploadRequest({filePath:b.name,channelId:a.channelId,purpose:a.filePurpose})}).then(function(a){return e=a.data,d.upload({uri:e.accessInformation.uri,signature:e.accessInformation.signature,file:b,progress:j})}).then(function(){return c.postUploadCompleteNotification({channelId:a.channelId,fileId:e.fileId})}).then(function(){return h({file:b,fileId:e.fileId,uri:e.accessInformation.uri,containerName:e.accessInformation.containerName})})},p=window.File&&window.FileReader&&window.FileList&&window.Blob;a.model={fileApiSupported:p,progress:0},a.upload=function(a){return j(0),k(""),l(!0),n(a).then(function(a){return o(a)})["catch"](function(a){return k(e.getFriendlyErrorMessage(a)),f.error(a),b.when()})["finally"](function(){l(!1)})}}]),angular.module("webApp").controller("formSubsectionCtrl",["$q","$scope",function(a,b){"use strict";b.formSubsection={expanded:!1}}]),angular.module("webApp").controller("SignOutCtrl",["$state","states","authenticationService","fetchAggregateUserState",function(a,b,c,d){"use strict";return d.waitForExistingUpdate().then(function(){return c.signOut()}).then(function(){a.go(b.signIn.signIn.name,{},{location:"replace"})})}]),angular.module("webApp").constant("blobImageCtrlConstants",{initialWaitMilliseconds:3e3,updateEvent:"update"}).controller("blobImageCtrl",["$scope","$q","$timeout","blobImageCtrlConstants","azureUriService","errorFacade",function(a,b,c,d,e,f){"use strict";a.model={imageUri:void 0,renderSize:void 0,errorMessage:void 0,updating:!1};var g,h=function(h,i,j,k,l,m){if(a.model.errorMessage=void 0,a.model.imageUri=void 0,g&&(g.isCancelled=!0,g=void 0),!j)return a.model.updating=!1,b.when();g={},a.model.updating=!0;var n,o=function(){return e.getAvailableImageInformation(i,j,k,g)};n=l?o():c(o,d.initialWaitMilliseconds),n.then(function(b){if(a.model.imageUri=b.uri,a.model.renderSize=void 0,b.width&&b.height&&!a.fixedAspectRatio&&(a.model.renderSize={width:b.width/2+"px",height:b.height/2+"px"}),a.model.updating=!1,m){var c;b.width&&b.height&&(c={width:b.width,height:b.height}),m({renderSize:c})}})["catch"](function(b){return f.handleError(b,function(c){a.model.errorMessage=c,a.model.updating=!1,m&&m({error:b})})})};a.$on(d.updateEvent,h)}]),angular.module("webApp").directive("money",function(){"use strict";function a(a,c,d,e){function f(a){var b=Math.pow(10,k);return Math.round(a*b)/b}function g(a){return parseFloat(a).toFixed(k)}function h(a){return e.$isEmpty(a)?"":""+a}var i,j=parseFloat(d.min||0),k=parseFloat(d.precision||2);e.$parsers.push(function(a){angular.isUndefined(a)&&(a=""),0===a.indexOf(".")&&(a="0"+a),0===a.indexOf("-")&&(j>=0?(a=null,e.$setViewValue(""),e.$render()):"-"===a&&(a=""));var c=e.$isEmpty(a);return c||b.test(a)?i=""===a?null:c?a:parseFloat(a):(e.$setViewValue(h(i)),e.$render()),e.$setValidity("number",!0),i}),e.$formatters.push(h);var l=function(a){return!e.$isEmpty(a)&&j>a?void e.$setValidity("min",!1):(e.$setValidity("min",!0),a)};if(e.$parsers.push(l),e.$formatters.push(l),d.max){var m=parseFloat(d.max),n=function(a){return!e.$isEmpty(a)&&a>m?void e.$setValidity("max",!1):(e.$setValidity("max",!0),a)};e.$parsers.push(n),e.$formatters.push(n)}k>-1&&(e.$parsers.push(function(a){return a?f(a):a}),e.$formatters.push(function(a){return a?g(a):a})),c.bind("blur",function(){var a=e.$modelValue;a&&(e.$viewValue=g(a),e.$render())})}var b=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/;return{restrict:"A",require:"ngModel",link:a}}),angular.module("ng-focus",[]).directive("focus",["$timeout",function(a){"use strict";return function(b,c,d){d.$observe("focus",function(b){b&&a(function(){c[0].focus()},0,!1)})}}]),angular.module("webApp").config(["$provide",function(a){"use strict";a.decorator("ngTranscludeDirective",["$delegate",function(a){return a.shift(),a}])}]).directive("ngTransclude",function(){"use strict";return{restrict:"EAC",link:function(a,b,c,d,e){if(!e)throw new FifthweekError("Illegal use of ngTransclude directive in the template! No parent directive that requires a transclusion found. ");var f=c.ngTransclude||"sibling";switch(f){case"sibling":e(function(a){b.empty(),b.append(a)});break;case"parent":e(a,function(a){b.empty(),b.append(a)});break;case"child":var g=a.$new();e(g,function(a){b.empty(),b.append(a),b.on("$destroy",function(){g.$destroy()})})}}}}),angular.module("webApp").directive("fwRoles",["authorizationService","authorizationServiceConstants",function(a,b){"use strict";return{restrict:"A",link:function(c,d,e){var f=function(){d.removeClass("hidden")},g=function(){d.addClass("hidden")},h=function(c){var d;c&&f(),d=a.authorize(!0,i,e.fwRoleCheckType),d===b.authorizationResult.authorized?f():g()},i=e.fwRoles.split(/[\s,]+/);i.length>0&&h(!0)}}}]),angular.module("webApp").directive("fwBreadcrumb",["navigationOrchestrator",function(a){"use strict";return{restrict:"E",scope:{intermediateStates:"&",current:"@",previous:"@",previousState:"&"},templateUrl:"views/partials/breadcrumb.html",link:{pre:function(b,c,d){var e=_.find(a.getSecondaryNavigation(),{isActive:!0})||_.find(a.getPrimaryNavigation(),{isActive:!0});if(!e)throw new FifthweekError("Could not determine active secondary page for breadcrumb");b.rootName=e.name,b.rootIcon=e.icon,b.rootState=e.state,d.previous&&d.previousState?b.intermediateStates=[{name:b.previous,click:b.previousState}]:b.intermediateStates=b.intermediateStates()}}}}]),angular.module("webApp").directive("fwCol7",function(){"use strict";return{restrict:"E",transclude:!0,template:'<div class="row"><div class="col-ss-offset-1 col-ss-10 col-s-offset-0 col-s-8 col-sm-7"><ng-transclude></ng-transclude></div></div>'}}),angular.module("webApp").directive("fwCheckUsernameAvailability",["$q","membershipStub","logService",function(a,b,c){"use strict";return{require:"ngModel",link:function(d,e,f,g){var h;g.$asyncValidators.username=function(d){if(g.$pristine)return h=d,a.when();if(d===h)return a.when();if(g.$isEmpty(d))return a.when();var e=a.defer();return b.getUsernameAvailability(d).then(function(){e.resolve()})["catch"](function(a){a instanceof ApiError&&404===a.response.status?e.reject():(c.error(a),e.resolve())}),e.promise}}}}]),angular.module("webApp").directive("fwDeleteLink",function(){"use strict";return{restrict:"E",transclude:!0,scope:{"class":"@",linkId:"@",itemType:"@",item:"=",eventTitle:"@",eventCategory:"@","delete":"&"},templateUrl:"views/partials/delete-link.html"}}),angular.module("webApp").directive("fwFormGroup",function(){"use strict";return{restrict:"E",transclude:!0,replace:!0,scope:!0,require:"^form",templateUrl:"views/partials/form-group.html",link:{pre:function(a,b,c,d){var e=c.inputName,f=d.$name;a.form=d,a.getInputName=function(){if(!e){var a=b.find("input");0===a.length&&(a=b.find("textarea")),0===a.length&&(a=b.find("fw-sir-trevor-editor")),e=a.attr("name")}return e},a.getFormName=function(){return f}},post:function(a){var b=a.getFormName(),c=a.getInputName();if(void 0===b)throw new FifthweekError("Outer form must exist with name attribute defined");if(void 0===c)throw new FifthweekError("Inner input must exist with name attribute defined");a.input=a[b][c],a.form=a[b]}}}}),angular.module("webApp").directive("fwFormInputComment",["utilities",function(a){"use strict";return{restrict:"E",scope:!0,templateUrl:"views/partials/form-input-comment.html",link:function(b,c,d){a.forDirective(b,c,d).scaffoldFormInput()}}}]),angular.module("webApp").directive("fwFormInputDelete",function(){"use strict";return{restrict:"E",scope:{linkId:"@",itemType:"@",item:"=",dataEventTitle:"@",dataEventCategory:"@","delete":"&"},templateUrl:"views/partials/form-input-delete.html"}}),angular.module("webApp").directive("fwFormInputGlyphs",["$compile",function(a){"use strict";return{restrict:"A",link:function(b,c){c.addClass("has-feedback");var d='<span fw-form-input-valid class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>',e=angular.element(d);c.append(e),a(e)(b);var f='<span fw-form-input-invalid class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>',g=angular.element(f);c.append(g),a(g)(b)}}}]),angular.module("webApp").directive("fwFormInputInvalid",["$compile",function(a){"use strict";return{restrict:"A",terminal:!0,priority:1e3,link:function(b,c,d){var e=b.getFormName(),f=b.getInputName(),g=d.fwFormInputInvalid;f=e+"."+f;var h;h=g?f+".$error."+g+" && (("+f+".$touched && "+f+".$dirty) || "+e+".$submitted)":f+".$invalid && (("+f+".$touched && "+f+".$dirty) || "+e+".$submitted)",c.removeAttr("fw-form-input-invalid"),c.attr("ng-if",h),a(c)(b)}}}]),angular.module("webApp").directive("fwFormInputInvalidP",["$compile",function(a){"use strict";return{restrict:"A",terminal:!0,priority:1e3,link:function(b,c,d){var e=d.fwFormInputInvalidP;c.removeAttr("fw-form-input-invalid-p"),c.attr("fw-form-input-invalid",e),c.addClass("help-block"),a(c)(b)}}}]),angular.module("webApp").directive("fwFormInputSelect",function(){"use strict";return{restrict:"E",scope:{items:"=",selectedItem:"=",ngDisabled:"@",inputId:"@"},templateUrl:"views/partials/form-input-select.html"}}),angular.module("webApp").directive("fwFormInputValid",["$compile",function(a){"use strict";return{restrict:"A",terminal:!0,priority:1e3,link:function(b,c){var d=b.getFormName(),e=b.getInputName();e=d+"."+e;var f=e+".$valid && (("+e+".$touched && "+e+".$dirty) || "+d+".$submitted)";c.removeAttr("fw-form-input-valid"),c.attr("ng-if",f),a(c)(b)}}}]),angular.module("webApp").directive("fwFormInputPassword",["utilities",function(a){"use strict";return{restrict:"E",scope:!0,templateUrl:"views/partials/form-input-password.html",link:function(b,c,d){a.forDirective(b,c,d).scaffoldFormInput()}}}]),angular.module("webApp").directive("fwFormInputUsername",["utilities",function(a){"use strict";return{restrict:"E",scope:!0,templateUrl:"views/partials/form-input-username.html",link:function(b,c,d){a.forDirective(b,c,d).scaffoldFormInput()}}}]),angular.module("webApp").directive("fwFormModal",function(){"use strict";return{restrict:"E",scope:!0,templateUrl:function(a){return a.data("form-body",a.find("form-body")),a.data("form-buttons",a.find("form-buttons")),"views/partials/form-modal.html"},compile:function(a){return a.find("form-body-placeholder").replaceWith(a.data("form-body").contents()),a.find("form-buttons-placeholder").replaceWith(a.data("form-buttons").contents()),{pre:function(a,b,c){a.name=c.name,a.idPrefix=c.idPrefix||"modal"}}}}}),angular.module("webApp").directive("fwFormModalTitle",function(){"use strict";return{restrict:"E",scope:!0,templateUrl:"views/partials/form-modal-title.html",link:function(a,b,c){a.name=c.name,a.idPrefix=c.idPrefix||"modal"}}}),angular.module("webApp").constant("formConstants",{formSubmittingEvent:"formSubmitting"}).directive("fwFormSubmit",["$q","wrapUserAction","$rootScope","formConstants",function(a,b,c,d){"use strict";return{restrict:"A",require:"^form",scope:{canSubmit:"&",fwFormSubmit:"&",errorMessage:"=?"},link:function(e,f,g,h){var i=g.canSubmit?e.canSubmit:null,j=e.fwFormSubmit;if(void 0===h)throw new FifthweekError("Must be within a form");i||(i=function(){return h.$valid&&h.$dirty}),h.isSubmitting=!1,h.hasAttemptedSubmit=!1,h.hasSubmitted=!1,h.submissionSucceeded=!1,h.message="",f.bind("click",function(){if(h.hasAttemptedSubmit=!0,c.$broadcast(d.formSubmittingEvent),!i())return a.when();h.isSubmitting=!0,h.submissionSucceeded=!1,h.message="",e.errorMessage="",g.hasOwnProperty("ngDisabled")||f.addClass("disabled").attr("disabled","disabled");var k=f.data("loading-text");k&&(f.data("resetText",f.html()),f.html(k));var l={eventTitle:f.data("event-title"),eventCategory:f.data("event-category")};return b(j,l).then(function(a){a?(h.message=a,e.errorMessage=a):h.submissionSucceeded=!0,h.hasSubmitted=!0,h.isSubmitting=!1,g.hasOwnProperty("ngDisabled")||f.removeClass("disabled").removeAttr("disabled");var b=f.data("resetText");b&&f.html(b)})})}}}]),angular.module("webApp").directive("fwFormSubsection",function(){"use strict";return{restrict:"E",scope:!0,replace:!0,templateUrl:function(a){return a.data("summary",a.find("summary")),a.data("summary-expanded",a.find("summary-expanded")),a.data("section",a.find("section")),"views/partials/form-subsection.html"},compile:function(a){a.find("summary-placeholder").replaceWith(a.data("summary").contents()),a.find("section-placeholder").replaceWith(a.data("section").contents());var b=a.data("summary-expanded"),c=1===b.length;return c&&a.find("summary-expanded-placeholder").replaceWith(a.data("summary-expanded").contents()),{pre:function(a,b,d){a.name=d.name,a.hasExpandedSummary=c}}}}}),angular.module("webApp").directive("fwManagedList",function(){"use strict";return{restrict:"E",transclude:!0,scope:{itemName:"@",items:"=",newItemState:"@",manageItemState:"@"},templateUrl:"views/partials/managed-list.html"}}),angular.module("webApp").directive("fwManagedListSm",function(){"use strict";return{restrict:"E",transclude:!0,replace:!0,scope:{itemName:"@",items:"=",newItem:"&",manageItem:"&"},templateUrl:"views/partials/managed-list-sm.html"}}),angular.module("webApp").directive("fwPanel6",function(){"use strict";return{restrict:"E",transclude:!0,template:'<div class="row"><div class="col-ss-offset-1 col-ss-10 col-s-offset-0 col-s-8 col-sm-7"><div class="panel panel-default"><div class="panel-body jumbo-panel"><ng-transclude></ng-transclude></div></div></div></div>'}}),angular.module("webApp").directive("fwPanel12",function(){"use strict";return{restrict:"E",transclude:!0,template:'<div class="row"><div class="col-xs-12"><div class="panel panel-default"><div class="panel-body jumbo-panel"><ng-transclude></ng-transclude></div></div></div></div>'}}),angular.module("webApp").directive("fwSetNavigationVisibilityFromState",["$state","uiRouterConstants",function(a,b){"use strict";return{restrict:"A",link:function(c,d){var e=function(a){a.data&&a.data.navigationHidden?"header"===a.data.navigationHidden?(d.addClass("navigation-header-hidden"),d.removeClass("navigation-hidden")):(d.addClass("navigation-hidden"),d.removeClass("navigation-header-hidden")):(d.removeClass("navigation-hidden"),d.removeClass("navigation-header-hidden"))};e(a.current),c.$on(b.stateChangeSuccessEvent,function(a,b){e(b)})}}}]),angular.module("webApp").directive("fwAssignCssClassFromState",["$state","uiRouterConstants",function(a,b){"use strict";return{restrict:"A",link:function(c,d){var e=function(a){a.data&&a.data.bodyClass&&d.addClass(a.data.bodyClass)},f=function(a){a.data&&a.data.bodyClass&&d.removeClass(a.data.bodyClass)};e(a.current),c.$on(b.stateChangeSuccessEvent,function(a,b,c,d){f(d),e(b)})}}}]),angular.module("webApp").directive("fwFileUpload",function(){"use strict";return{scope:{onUploadStarted:"&?",onUploadComplete:"&",description:"@",idPrefix:"@?",abbreviateProgress:"@",filePurpose:"@",channelId:"@?",accept:"@"},templateUrl:"views/partials/file-upload.html",link:{pre:function(a){a.idPrefix||(a.idPrefix="file")}}}}),angular.module("webApp").directive("fwFileInputOnChange",function(){"use strict";return{restrict:"A",scope:{fwFileInputOnChange:"&"},link:function(a,b){b.on("change",function(c){a.fwFileInputOnChange({files:c.target.files}),b.attr("value","")})}}}),angular.module("webApp").directive("fwBlobImage",["blobImageCtrlConstants",function(a){"use strict";return{scope:{control:"=",thumbnail:"@",fileId:"@",containerName:"@",fixedAspectRatio:"@"},templateUrl:"views/partials/blob-image.html",link:function(b){var c=function(c,d,e,f){return d?void b.$broadcast(a.updateEvent,c,d,b.thumbnail,e,f):void b.$broadcast(a.updateEvent)};b.control&&b.control.initialize(c),b.fileId&&b.containerName&&c(b.containerName,b.fileId,!0)}}}]),angular.module("webApp").directive("fwErrorMessage",function(){"use strict";return{scope:{value:"=","class":"@"},templateUrl:"views/partials/error-message.html"}}),angular.module("webApp").directive("vimeoVideo",["analytics",function(a){"use strict";return{link:function(b,c,d){var e=$f(c[0]);c.load(function(){e.addEvent("ready",function(){e.addEvent("play",function(){a.eventTrack('Played video "'+d.title+'"',"Video")}),e.addEvent("pause",function(){a.eventTrack('Paused video "'+d.title+'"',"Video")}),e.addEvent("finish",function(){a.eventTrack('Finished video "'+d.title+'"',"Video")})})})}}}]),angular.module("snap").directive("fwMenuStatus",["snapRemote",function(a){"use strict";return{restrict:"A",link:function(b,c){var d="fw-menu-open",e="fw-menu-closed";a.getSnapper().then(function(a){"closed"===a.state().state?c.addClass(e):c.addClass(d),a.on("open",function(){c.removeClass(e),c.addClass(d)}),a.on("close",function(){c.removeClass(d),c.addClass(e)})})}}}]),angular.module("webApp").constant("accessSignaturesConstants",{
publicContainerName:"public"}).factory("accessSignatures",["$q","accessSignaturesCache","accessSignaturesConstants",function(a,b,c){"use strict";var d={};return d.getPublicAccessInformation=function(){return b.getSignatures().then(function(b){return a.when(b.publicSignature)})},d.getContainerAccessInformation=function(d){return b.getSignatures().then(function(b){if(d&&d!==c.publicContainerName){var e=b.privateSignatures;if(e)for(var f=0;f<e.length;f++)if(e[f].information.containerName===d)return a.when(e[f].information);return a.reject(new FifthweekError("No shared access signatures found for container: "+d))}return a.when(b.publicSignature)})},d.getContainerAccessMap=function(){return b.getSignatures().then(function(b){var c={};c[b.publicSignature.containerName]=b.publicSignature,c=_.reduce(b.privateSignatures,function(a,b){return a[b.information.containerName]=b.information,a},c);var d=_.reduce(b.privateSignatures,function(a,b){return a[b.channelId]=b.information,a},{});return a.when({containerName:c,channelId:d})})},d}]),angular.module("webApp").constant("accessSignaturesCacheConstants",{refreshMinimumExpiry:6e5,failMinimumExpiry:3e4}).factory("accessSignaturesCache",["accessSignaturesCacheImpl",function(a){"use strict";return a.initialize(),a}]).factory("accessSignaturesCacheImpl",["$rootScope","$q","fetchAggregateUserState","authenticationService","accessSignaturesCacheConstants","fetchAggregateUserStateConstants",function(a,b,c,d,e,f){"use strict";var g={},h={lastResult:void 0},i=function(a,b){var c=new Date,d=c.getTime()+1e3*b.timeToLiveSeconds;h.lastResult={expires:d,userId:a,data:b}},j=function(a){return c.updateFromServer(a).then(function(a){return b.when(a.userState.accessSignatures)})["catch"](function(a){return k(e.failMinimumExpiry)?b.reject(a):b.when(h.lastResult.data)})},k=function(a){if(!h.lastResult)return!0;var b=new Date;return h.lastResult.expires-b.getTime()<a},l=function(a){return k(e.refreshMinimumExpiry)?!0:h.lastResult.userId!==a},m=function(a,b,c){i(b,c.accessSignatures)};return g.getSignatures=function(){var a=d.currentUser.userId;return l(a)?j(a):b.when(h.lastResult.data)},g.initialize=function(){a.$on(f.updateAccessSignaturesEvent,m)},g}]),angular.module("webApp").factory("authenticationInterceptor",["$q","$injector","states","fifthweekConstants",function(a,b,c,d){"use strict";var e,f,g,h={};h.currentTokenRequest=void 0;var i=function(a){return(e=e||b.get("$http"))(a)},j=function(){return h.currentTokenRequest||(h.currentTokenRequest=g.refreshToken(),h.currentTokenRequest["catch"](function(){f=f||b.get("$state"),f.go(c.signIn.signIn.name)})["finally"](function(){h.currentTokenRequest=void 0})),h.currentTokenRequest};return h.request=function(a){return a.headers=a.headers||{},g=g||b.get("authenticationService"),g.currentUser.authenticated&&_.startsWith(a.url,d.apiBaseUri)&&(a.headers.Authorization="Bearer "+g.currentUser.accessToken),a},h.responseError=function(c){return 401!==c.status||c.config.hasRetried?a.reject(c):(c.config.hasRetried=!0,g=g||b.get("authenticationService"),j().then(function(){return i(c.config)},function(){return a.reject(c)}))},h}]),angular.module("webApp").constant("authenticationServiceConstants",{currentUserChangedEvent:"currentUserChanged",roles:{creator:"creator",administrator:"administrator",preRelease:"pre-release",testUser:"test-user"}}).factory("authenticationService",["authenticationServiceImpl",function(a){"use strict";return a.initialize(),a}]).factory("authenticationServiceImpl",["$http","$q","$rootScope","analytics","localStorageService","fetchAggregateUserState","fifthweekConstants","authenticationServiceConstants","utilities","impersonationServiceConstants",function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=g.apiBaseUri,l={},m="currentUser";l.currentUser={},l.internal={};var n=function(){c.$broadcast(h.currentUserChangedEvent,l.currentUser)},o=function(){l.currentUser.authenticated=!1,l.currentUser.accessToken=void 0,l.currentUser.refreshToken=void 0,l.currentUser.userId=void 0,l.currentUser.roles=void 0,l.currentUser.nonImpersonatedUserId=void 0,e.remove(m),n()},p=function(a,b,c,d){l.currentUser.authenticated=!0,l.currentUser.accessToken=a,l.currentUser.refreshToken=b,l.currentUser.userId=c,l.currentUser.roles=d,e.set(m,l.currentUser),n()},q=function(a){return b(function(b,c){var d=[],e=a.data.roles;e&&(d=a.data.roles.split(","));var f=a.data.user_id;if(!f)return c(new FifthweekError("The user ID was not returned"));var g=a.data.access_token;if(!g)return c(new FifthweekError("The access token was not returned"));var h=a.data.refresh_token;return h?(p(g,h,f,d),b()):c(new FifthweekError("The refresh token was not returned"))})};return l.initialize=function(){c.$on(j.impersonationChangedEvent,l.internal.handleImpersonationChanged);var a=e.get(m);a?(l.currentUser=a,n()):o()},l.internal.handleImpersonationChanged=function(a,b){if(b)l.currentUser.nonImpersonatedUserId||(l.currentUser.nonImpersonatedUserId=l.currentUser.userId),p(l.currentUser.accessToken,l.currentUser.refreshToken,b,l.currentUser.roles);else if(l.currentUser.nonImpersonatedUserId){var c=l.currentUser.nonImpersonatedUserId;l.currentUser.nonImpersonatedUserId=void 0,p(l.currentUser.accessToken,l.currentUser.refreshToken,c,l.currentUser.roles)}return f.updateFromServer(l.currentUser.userId)},l.registerUser=function(c){return l.currentUser.authenticated?b.reject(new FifthweekError("You must sign out before registering.")):a.post(k+"membership/registrations",c)["catch"](function(a){return b.reject(i.getHttpError(a))})},l.signIn=function(c){if(l.currentUser.authenticated)return b.reject(new FifthweekError("You must sign out before signing in."));var e="grant_type=password&username="+c.username+"&password="+c.password+"&client_id="+g.clientId,h={headers:{"Content-Type":"application/x-www-form-urlencoded"}};return a.post(k+"token",e,h)["catch"](function(a){return b.reject(i.getHttpError(a))}).then(function(a){return q(a)}).then(function(){d.setUsername(l.currentUser.userId)}).then(function(){return f.updateFromServer(l.currentUser.userId)})["catch"](function(a){return l.signOut(),b.reject(a)})},l.refreshToken=function(){if(!l.currentUser.authenticated)return b.reject(new FifthweekError("Cannot refresh the authentication token because the user is not authenticated."));var c="grant_type=refresh_token&refresh_token="+l.currentUser.refreshToken+"&client_id="+g.clientId;return a.post(k+"token",c,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return q(a)},function(a){return b.reject(i.getHttpError(a))})["catch"](function(a){return l.signOut(),b.reject(a)})},l.signOut=function(){return o(),f.updateFromServer()},l}]),angular.module("webApp").constant("authorizationServiceConstants",{authorizationResult:{authorized:"authorized",loginRequired:"loginRequired",notAuthorized:"notAuthorized"},roleCheckType:{atLeastOne:"atLeastOne",all:"all",none:"none"}}).factory("authorizationService",["authenticationService","authorizationServiceConstants",function(a,b){"use strict";var c={};return c.authorize=function(c,d,e){var f=b.authorizationResult.authorized;if(e=e||b.roleCheckType.atLeastOne,c===!0&&a.currentUser.authenticated===!1)f=b.authorizationResult.loginRequired;else if(c!==!0||a.currentUser.authenticated===!1||void 0!==d&&0!==d.length){if(d){var g=[];angular.forEach(a.currentUser.roles,function(a){g.push(a.toLowerCase())});for(var h=!0,i=0;i<d.length;i+=1){var j=d[i].toLowerCase();if(e===b.roleCheckType.all){if(h=h&&g.indexOf(j)>-1,h===!1)break}else if((e===b.roleCheckType.atLeastOne||e===b.roleCheckType.none)&&(h=g.indexOf(j)>-1))break}f=e===b.roleCheckType.none?h?b.authorizationResult.notAuthorized:b.authorizationResult.authorized:h?b.authorizationResult.authorized:b.authorizationResult.notAuthorized}}else f=b.authorizationResult.authorized;return f},c}]),angular.module("webApp").factory("calculatedStates",["$q","states","blogService","authenticationService","authenticationServiceConstants",function(a,b,c,d,e){"use strict";var f={};return f.getDefaultState=function(){var a=d.currentUser;return a.authenticated===!0?_.includes(a.roles,e.roles.creator)&&c.hasBlog?b.user.name:b.user.name:b.home.name},f}]),angular.module("webApp").factory("domUtilities",function(){"use strict";var a={};return a.ancestor=function(b,c,d){if(isNaN(d))d=10;else if(d--<=0)return null;var e=c.parent();return e.prop("tagName")!==b?a.ancestor(b,e,d):e},a}),angular.module("webApp").factory("deleteVerification",["$modal",function(a){"use strict";var b={};return b.verifyDelete=function(b,c,d,e,f){var g=a.open({controller:"deleteVerificationCtrl",templateUrl:"views/partials/delete-verification.html",size:f?void 0:"sm",resolve:{deleteContext:function(){return{item:f,itemType:e,dataEventTitle:c,dataEventCategory:d,action:b}}}});return g.result},b}]),angular.module("webApp").factory("developerRequestInterceptor",["fifthweekConstants",function(a){"use strict";var b={};return b.request=function(b){return a.developerName&&(b.headers=b.headers||{},b.headers[a.developerNameHeader]=a.developerName),b},b}]),angular.module("webApp").factory("errorFacade",["$q","logService","utilities",function(a,b,c){"use strict";var d={};return d.handleError=function(d,e){return d instanceof CancellationError?a.when():(e(c.getFriendlyErrorMessage(d)),b.error(d))},d.handleErrorInBackground=function(d){return d instanceof CancellationError?a.when():(b.error(d),c.getFriendlyErrorMessage(d))},d}]),angular.module("webApp").factory("logService",["$injector","$log","$window","fifthweekConstants",function(a,b,c,d){"use strict";var e={},f=d.apiBaseUri+d.logPath;e.shouldLog=function(a){return void 0!==a&&(a instanceof Error||!jQuery.isEmptyObject(a))};var g=function(d,g){if(e.shouldLog(g)){var h={level:d,payload:{url:c.location.href,message:g}},i=a.get("$http");return i.post(f,h)["catch"](function(a){b.warn("Server-side logging failed"),b.warn(a)})}};return e.debug=function(a){return b.debug(a),g("debug",a)},e.info=function(a){return b.info(a),g("info",a)},e.warn=function(a){return b.warn(a),g("warn",a)},e.error=function(a){return a instanceof ApiError||a instanceof InputValidationError?void b.info(a.message):(b.error(a),g("error",a))},e.logUnhandledError=function(a,c){if(e.shouldLog(a)||e.shouldLog(c)){if(!(a instanceof ApiError)){var d={cause:c,exception:a};return g("error",d)}b.info(a.message)}},e}]),angular.module("webApp").constant("navigationOrchestratorConstants",{navigationChangedEvent:"navigationChanged"}).factory("navigationOrchestrator",["navigationOrchestratorImpl",function(a){"use strict";return a.initialize(),a}]).factory("navigationOrchestratorImpl",["$rootScope","navigationMap","stateChangeService","authenticationServiceConstants","aggregateUserStateConstants","navigationOrchestratorConstants","uiRouterConstants","$state",function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=[],l=[],m={},n=function(){a.$broadcast(f.navigationChangedEvent,k,l)},o=function(a){return"function"==typeof a?a():a},p=function(a){return void 0!==a.state?c.isPermitted(h.get(a.state)):!0},q=function(a){return a.hidden},r=function(a,b){var c=o(a.name),d="navigation-"+_.kebabCase(a.id||c);return{separator:a.separator,name:c,state:a.state,action:a.action,icon:a.icon,color:a.color,isActive:b,id:d}},s=function(a){if(void 0===a||0===a.length)return j=void 0,m.secondaryNavigation=[],[];for(var b=[],c=0;c<a.length;c++){var d=a[c];if(p(d)){var e=r(d,d===j);b.push(e)}}return b},t=function(){for(var a=[],c=[],d=0;d<b.length;d++){var e=b[d];if(p(e)){var f=r(e,e===i);f.separator?a.length>0&&!_.last(a).separator&&a.push(f):q(e)||a.push(f),f.isActive&&(c=s(e.secondary))}}a.length>0&&_.last(a).separator&&a.pop(),k=a,l=c,n()},u=function(){for(var a=0;a<b.length;a++){var c=b[a],d=c.secondary;if(d)for(var e=0;e<d.length;e++){var f=d[e];if(h.includes(f.state))return i=c,void(j=f)}if(h.includes(c.state))return i=c,void(j=void 0)}i=void 0,j=void 0};return m.initialize=function(){a.$on(g.stateChangeSuccessEvent,function(){u(),t()}),a.$on(d.currentUserChangedEvent,function(){t()}),a.$on(e.updatedEvent,function(){t()}),u(),t()},m.getPrimaryNavigation=function(){return k},m.getSecondaryNavigation=function(){return l},m}]),angular.module("webApp").factory("stateChangeAuthorizationService",["authenticationService","authorizationService","authorizationServiceConstants","$state","states","calculatedStates",function(a,b,c,d,e,f){"use strict";var g,h,i={},j=!1,k=function(a){return b.authorize(a.data.access.requireAuthenticated,a.data.access.roles,a.data.access.roleCheckType)};return i.isPermitted=function(b){return void 0!==b.data&&void 0!==b.data.access?b.data.access.requireUnauthenticated?a.currentUser.authenticated===!1:k(b)===c.authorizationResult.authorized:!0},i.redirectAwayIfRequired=function(b,i,l){if(j&&i.name!==e.signIn.name&&i.name!==e.signIn.signIn.name){if(j=!1,void 0!==i.data&&void 0!==i.data.access&&i.data.access.requireAuthenticated===!0)return b.preventDefault(),d.go(g,h,{location:"replace"}),!0}else if(void 0!==i.data&&void 0!==i.data.access)if(i.data.access.requireUnauthenticated){if(a.currentUser.authenticated===!0)return b.preventDefault(),d.go(f.getDefaultState()),!0}else{var m=k(i);if(m===c.authorizationResult.loginRequired)return j=!0,g=i.name,h=l,b.preventDefault(),d.go(e.signIn.signIn.name),!0;if(m===c.authorizationResult.notAuthorized)return b.preventDefault(),d.go(e.notAuthorized.name),!0}return!1},i}]),angular.module("webApp").factory("stateChangeRedirectionService",["$state",function(a){"use strict";var b={};return b.isPermitted=function(){return!0},b.redirectAwayIfRequired=function(b,c,d){return c.redirectTo?(b.preventDefault(),a.go(c.redirectTo,d),!0):!1},b}]),angular.module("webApp").factory("stateChangeRequireBlogService",["$state","calculatedStates","blogService",function(a,b,c){"use strict";var d={};return d.isPermitted=function(a){return void 0!==a.requireBlog&&a.requireBlog!==c.hasBlog?!1:!0},d.redirectAwayIfRequired=function(c,e,f){return d.isPermitted(e)?!1:(c.preventDefault(),a.go(b.getDefaultState(),f),!0)},d}]),angular.module("webApp").factory("stateChangeService",["stateChangeAuthorizationService","stateChangeRedirectionService","stateChangeRequireBlogService",function(a,b,c){"use strict";var d=[b,a,c],e={};return e.isPermitted=function(a){return _.every(d,function(b){return b.isPermitted(a)})},e.redirectAwayIfRequired=function(a,b,c){_.forEach(d,function(d){return d.redirectAwayIfRequired(a,b,c)?!1:void 0})},e}]),angular.module("webApp").factory("utilities",["fifthweekConstants","$parse",function(a,b){"use strict";var c={};return c.getAccessorPathSegments=function(a){return a=a.replace(/\[(\w+)\]/g,".$1"),a=a.replace(/^\./,""),a.split(".")},c.getValue=function(a,b){for(var d=_.isArray(b)?b:c.getAccessorPathSegments(b),e=0;e<d.length;++e){var f=d[e];if(!(a&&f in a))return;a=a[f]}return a},c.getHttpError=function(b){if(0===b.status)return new ConnectionError(b);if(401===b.status)return new UnauthenticatedError("Not authenticated.");if(403===b.status)return new UnauthorizedError("Not authorized.");if(void 0!==b.data){if(void 0!==b.data.message)return new ApiError(b.data.message,b);if(void 0!==b.data.error_description)return new ApiError(b.data.error_description,b)}return new ApiError(a.unexpectedErrorText,b)},c.fixUri=function(a){return"&"===a.slice(-1)?a.substring(0,a.length-1):a},c.getFriendlyErrorMessage=function(b){return b instanceof DisplayableError?b.message||a.unexpectedErrorText:b instanceof ConnectionError?a.connectionErrorText:a.unexpectedErrorText},c.parseFlag=function(a,b){return a.hasOwnProperty(b)?a[b]!==!1:!1},c.forScope=function(a){var c={};return c.getAccessor=function(c){var d=c.lastIndexOf(".");if(-1===d)throw new FifthweekError("Must not be bound to primitive");var e=b(c.substring(0,d))(a),f=c.substring(d+1);return{root:e,accessor:f}},c},c.forDirective=function(a,d,e){var f={};return f.scaffoldFormInput=function(){a.showHelp=c.parseFlag(e,"showHelp"),a.required=c.parseFlag(e,"required"),a.focus=c.parseFlag(e,"focus")?!0:void 0,a.placeholder=e.placeholder,a.breakpoint=e.breakpoint||"sm",a.inputColumns=e.inputColumns||"6",a.label=e.label;var d=c.forScope(a);if(e.ngModel){a.inputId=e.inputId||e.ngModel.replace(/\./g,"-");var f=d.getAccessor(e.ngModel);a.ngModel=f.root,a.ngModelAccessor=f.accessor}var g=b(e.ngRequired);a.isRequired=function(){return!!(e.ngRequired?g(a):a.required)};var h=b(e.ngDisabled);a.isDisabled=function(){return!!(e.ngDisabled?h(a):!1)}},f},c}]),angular.module("webApp").factory("azureBlobUpload",["$q","logService","azureBlobStub",function(a,b,c){"use strict";var d=262144,e={},f=function(a,b){for(var c=""+a;c.length<b;)c="0"+c;return c},g=function(a,c,d){b.error({message:c,error:a}),d.deferred.reject(a)},h=function(a,c){try{a.progress(c)}catch(d){b.error({message:"Progress callback failed during blob upload.",error:d})}},i=function(b){var c=d;b.blockSize&&(c=b.blockSize);var e=c,f=1,g=b.file,h=g.size;return c>h&&(e=h),f=h%e===0?h/e:parseInt(h/e,10)+1,{maxBlockSize:e,numberOfBlocks:f,totalBytesRemaining:h,currentFilePointer:0,blockIds:[],bytesUploaded:0,submitUri:null,file:g,signature:b.signature,uri:b.uri+b.signature,progress:b.progress||function(){},azureCalled:b.azureCalled||function(){},deferred:a.defer()}},j=function(a,b){if(b.totalBytesRemaining>0){var c=b.file.slice(b.currentFilePointer,b.currentFilePointer+b.maxBlockSize),d=f(b.blockIds.length,8);b.blockIds.push(d),b.currentFilePointer+=b.maxBlockSize,b.totalBytesRemaining-=b.maxBlockSize,b.totalBytesRemaining<b.maxBlockSize&&(b.maxBlockSize=b.totalBytesRemaining),a.readAsArrayBuffer(c)}else k(b)},k=function(a){c.commitBlockList(a.uri,a.blockIds,a.file.type).then(function(){a.deferred.resolve()})["catch"](function(b){g(b,"Failed to commit blob list.",a)}),a.azureCalled()},l=function(a,b,d){try{if(a.target.readyState===FileReader.DONE){var e=new Uint8Array(a.target.result);c.putBlockBlob(b.uri,b.blockIds[b.blockIds.length-1],e).then(function(){b.bytesUploaded+=e.length;var a=(parseFloat(b.bytesUploaded)/parseFloat(b.file.size)*100).toFixed(2);h(b,a),j(d,b)})["catch"](function(a){g(a,"Failed to upload block blob.",b)}),b.azureCalled()}}catch(f){g(f,"Failed to upload block blob.",b)}};return e.upload=function(a){var b=i(a);try{var c=new FileReader;c.onloadend=function(a){return l(a,b,c)},j(c,b)}catch(d){g(d,"Failed to initiate file upload.",b)}return b.deferred.promise},e}]),angular.module("webApp").factory("blobImageControlFactory",["$q",function(a){"use strict";var b={};return b.createControl=function(){var b={deferred:a.defer(),updateHandler:void 0},c={update:function(a,c,d,e){return b.deferred.promise.then(function(){return b.updateHandler(a,c,d,e)})},initialize:function(a){b.updateHandler=a,b.deferred.resolve()}};return c},b}]),angular.module("webApp").factory("wrapUserAction",["$q","errorFacade","analytics",function(a,b,c){"use strict";return function(d,e){var f;try{f=a.when(d())}catch(g){f=a.reject(g)}return f.then(function(){if(e){var a=e.eventTitle,b=e.eventCategory;return a&&b?c.eventTrack(a,b).then(function(){}):void 0}},function(a){return b.handleErrorInBackground(a)})}}]),angular.module("webApp").factory("initializer",function(){"use strict";return{initialize:function(a){a()}}}),angular.module("webApp").constant("identifiedUserNotifierConstants",{eventName:"identifiedUserInformationUpdatedEvent",localStorageKey:"identifiedUserInformation",defaultUserInformation:{email:void 0}}).factory("identifiedUserNotifier",["$rootScope","localStorageService","membershipStub","logService","identifiedUserNotifierConstants","aggregateUserStateConstants",function(a,b,c,d,e,f){"use strict";var g={};return g.internal={hasNotified:!1,userInformation:void 0},g.internal.loadUserInformation=function(){var a=b.get(e.localStorageKey);g.internal.userInformation=a||e.defaultUserInformation},g.internal.notify=function(){if(g.internal.userInformation.email){var a=_.cloneDeep(g.internal.userInformation);a.isUpdate=g.internal.hasNotified,g.internal.hasNotified=!0,c.postIdentifiedUser(a)["catch"](function(a){d.error(a)})}},g.internal.saveUserInformation=function(a,c,d){var f=!1;a===g.internal.userInformation.email?(c&&g.internal.userInformation.name!==c&&(g.internal.userInformation.name=c,f=!0),d&&g.internal.userInformation.username!==d&&(g.internal.userInformation.username=d,f=!0)):(g.internal.userInformation={email:a,name:c,username:d},f=!0),(f||!g.internal.hasNotified)&&(b.set(e.localStorageKey,g.internal.userInformation),g.internal.notify())},g.internal.handleUserInformationUpdatedEvent=function(a,b){g.internal.saveUserInformation(b.email,b.name)},g.internal.handleAggregateUserStateEvent=function(a,b){b&&b.accountSettings?g.internal.saveUserInformation(b.accountSettings.email,b.accountSettings.name,b.accountSettings.username):g.internal.hasNotified||g.internal.notify()},g.initialize=function(){g.internal.loadUserInformation(),a.$on(e.eventName,g.internal.handleUserInformationUpdatedEvent),a.$on(f.updatedEvent,g.internal.handleAggregateUserStateEvent)},g}]),angular.module("webApp").factory("availabilityStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){"use strict";var e=c.apiBaseUri,f={};return f.get=function(){return a.get(d.fixUri(e+"availability"))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.head=function(){return a.get(d.fixUri(e+"availability"))["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("channelStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){"use strict";var e=c.apiBaseUri,f={};return f.postChannel=function(c){return a.post(d.fixUri(e+"channels"),c)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.putChannel=function(c,f){return a.put(d.fixUri(e+"channels/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.deleteChannel=function(c){return a["delete"](d.fixUri(e+"channels/"+encodeURIComponent(c)))["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("queueStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){"use strict";var e=c.apiBaseUri,f={};return f.postQueue=function(c){return a.post(d.fixUri(e+"queues"),c)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.putQueue=function(c,f){return a.put(d.fixUri(e+"queues/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.deleteQueue=function(c){return a["delete"](d.fixUri(e+"queues/"+encodeURIComponent(c)))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getLiveDateOfNewQueuedPost=function(c){return a.get(d.fixUri(e+"queues/"+encodeURIComponent(c)+"/newQueuedPostLiveDate"))["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("endToEndTestInboxStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){"use strict";var e=c.apiBaseUri,f={};return f.getLatestMessageAndClearMailbox=function(c){return a.get(d.fixUri(e+"testMailboxes/"+encodeURIComponent(c)))["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("accountSettingsStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){"use strict";var e=c.apiBaseUri,f={};return f.get=function(c){return a.get(d.fixUri(e+"accountSettings/"+encodeURIComponent(c)))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.put=function(c,f){return a.put(d.fixUri(e+"accountSettings/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.putCreatorInformation=function(c,f){return a.put(d.fixUri(e+"accountSettings/"+encodeURIComponent(c)+"/creatorInformation"),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("membershipStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){"use strict";var e=c.apiBaseUri,f={};return f.postRegistration=function(c){return a.post(d.fixUri(e+"membership/registrations"),c)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getUsernameAvailability=function(c){return a.get(d.fixUri(e+"membership/availableUsernames/"+encodeURIComponent(c)))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postPasswordResetRequest=function(c){return a.post(d.fixUri(e+"membership/passwordResetRequests"),c)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postPasswordResetConfirmation=function(c){return a.post(d.fixUri(e+"membership/passwordResetConfirmations"),c)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getPasswordResetTokenValidity=function(c,f){return a.get(d.fixUri(e+"membership/passwordResetTokens/"+encodeURIComponent(c)+"?"+(void 0===f?"":"token="+encodeURIComponent(f)+"&")))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postFeedback=function(c){return a.post(d.fixUri(e+"membership/feedback"),c)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postIdentifiedUser=function(c){return a.post(d.fixUri(e+"membership/identifiedUsers"),c)["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("logStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){"use strict";var e=c.apiBaseUri,f={};return f.post=function(c){return a.post(d.fixUri(e+"log"),c)["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("postStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){"use strict";var e=c.apiBaseUri,f={};return f.getCreatorBacklog=function(c){return a.get(d.fixUri(e+"posts/creatorBacklog/"+encodeURIComponent(c)))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getNewsfeed=function(c){return a.get(d.fixUri(e+"posts/newsfeed?"+(void 0===c.creatorId?"":"creatorId="+encodeURIComponent(c.creatorId)+"&")+(void 0===c.channelId?"":"channelId="+encodeURIComponent(c.channelId)+"&")+(void 0===c.origin?"":"origin="+encodeURIComponent(c.origin)+"&")+(void 0===c.searchForwards?"":"searchForwards="+encodeURIComponent(c.searchForwards)+"&")+(void 0===c.startIndex?"":"startIndex="+encodeURIComponent(c.startIndex)+"&")+(void 0===c.count?"":"count="+encodeURIComponent(c.count)+"&")))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getPreviewNewsfeed=function(c){return a.get(d.fixUri(e+"posts/previewNewsfeed?"+(void 0===c.creatorId?"":"creatorId="+encodeURIComponent(c.creatorId)+"&")+(void 0===c.channelId?"":"channelId="+encodeURIComponent(c.channelId)+"&")+(void 0===c.origin?"":"origin="+encodeURIComponent(c.origin)+"&")+(void 0===c.searchForwards?"":"searchForwards="+encodeURIComponent(c.searchForwards)+"&")+(void 0===c.startIndex?"":"startIndex="+encodeURIComponent(c.startIndex)+"&")+(void 0===c.count?"":"count="+encodeURIComponent(c.count)+"&")))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postPost=function(c){return a.post(d.fixUri(e+"posts"),c)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.putPost=function(c,f){return a.put(d.fixUri(e+"posts/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getPost=function(c,f){return a.get(d.fixUri(e+"posts/"+encodeURIComponent(c)+"?"+(void 0===f?"":"requestFreePost="+encodeURIComponent(f)+"&")))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.deletePost=function(c){return a["delete"](d.fixUri(e+"posts/"+encodeURIComponent(c)))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postNewQueueOrder=function(c,f){return a.post(d.fixUri(e+"posts/queues/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.putQueue=function(c,f){return a.put(d.fixUri(e+"posts/"+encodeURIComponent(c)+"/queue"),JSON.stringify(f))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postToLive=function(c){return a.post(d.fixUri(e+"posts/live"),JSON.stringify(c))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.putLiveDate=function(c,f){return a.put(d.fixUri(e+"posts/"+encodeURIComponent(c)+"/liveDate"),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postComment=function(c,f){return a.post(d.fixUri(e+"posts/"+encodeURIComponent(c)+"/comments"),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getComments=function(c){return a.get(d.fixUri(e+"posts/"+encodeURIComponent(c)+"/comments"))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postLike=function(c){return a.post(d.fixUri(e+"posts/"+encodeURIComponent(c)+"/likes"))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.deleteLike=function(c){return a["delete"](d.fixUri(e+"posts/"+encodeURIComponent(c)+"/likes"))["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("blogAccessStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){"use strict";var e=c.apiBaseUri,f={};return f.putFreeAccessList=function(c,f){return a.put(d.fixUri(e+"blogAccess/freeAccessList/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getFreeAccessList=function(c){return a.get(d.fixUri(e+"blogAccess/freeAccessList/"+encodeURIComponent(c)))["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("subscriptionStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){"use strict";var e=c.apiBaseUri,f={};return f.putBlogSubscriptions=function(c,f){return a.put(d.fixUri(e+"subscriptions/blogs/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postChannelSubscription=function(c,f){return a.post(d.fixUri(e+"subscriptions/channels/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.deleteChannelSubscription=function(c){return a["delete"](d.fixUri(e+"subscriptions/channels/"+encodeURIComponent(c)))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.putChannelSubscription=function(c,f){return a.put(d.fixUri(e+"subscriptions/channels/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("blogStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){"use strict";var e=c.apiBaseUri,f={};return f.postBlog=function(c){return a.post(d.fixUri(e+"blogs"),c)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.putBlog=function(c,f){return a.put(d.fixUri(e+"blogs/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getLandingPage=function(c){return a.get(d.fixUri(e+"blogs/landingPages/"+encodeURIComponent(c)))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getSubscriberInformation=function(c){return a.get(d.fixUri(e+"blogs/subscribers/"+encodeURIComponent(c)))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getCreatorRevenues=function(){return a.get(d.fixUri(e+"blogs/creatorRevenues"))["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("fileUploadStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){"use strict";var e=c.apiBaseUri,f={};return f.postUploadRequest=function(c){return a.post(d.fixUri(e+"files/uploadRequests"),c)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postUploadCompleteNotification=function(c){return a.post(d.fixUri(e+"files/uploadCompleteNotifications"),c)["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("userStateStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){"use strict";var e=c.apiBaseUri,f={};return f.getUserState=function(c,f){return a.get(d.fixUri(e+"userState/"+encodeURIComponent(c)+"?"+(void 0===f?"":"impersonate="+encodeURIComponent(f)+"&")))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getVisitorState=function(){return a.get(d.fixUri(e+"userState"))["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("paymentsStub",["$http","$q","fifthweekConstants","utilities",function(a,b,c,d){
"use strict";var e=c.apiBaseUri,f={};return f.putPaymentOrigin=function(c,f){return a.put(d.fixUri(e+"payment/origins/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postCreditRequest=function(c,f){return a.post(d.fixUri(e+"payment/creditRequests/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getCreditRequestSummary=function(c,f,g,h){return a.get(d.fixUri(e+"payment/creditRequestSummaries/"+encodeURIComponent(c)+"?"+(void 0===f?"":"countryCode="+encodeURIComponent(f)+"&")+(void 0===g?"":"creditCardPrefix="+encodeURIComponent(g)+"&")+(void 0===h?"":"ipAddress="+encodeURIComponent(h)+"&")))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.deletePaymentInformation=function(c){return a["delete"](d.fixUri(e+"payment/paymentInformation/"+encodeURIComponent(c)))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postTransactionRefund=function(c,f){return a.post(d.fixUri(e+"payment/transactionRefunds/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.postCreditRefund=function(c,f){return a.post(d.fixUri(e+"payment/creditRefunds/"+encodeURIComponent(c)),f)["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getTransactions=function(c,f,g){return a.get(d.fixUri(e+"payment/transactions?"+(void 0===c?"":"userId="+encodeURIComponent(c)+"&")+(void 0===f?"":"startTimeInclusive="+encodeURIComponent(f)+"&")+(void 0===g?"":"endTimeExclusive="+encodeURIComponent(g)+"&")))["catch"](function(a){return b.reject(d.getHttpError(a))})},f.getPaymentProcessingLease=function(c){return a.get(d.fixUri(e+"payment/lease?"+(void 0===c?"":"leaseId="+encodeURIComponent(c)+"&")))["catch"](function(a){return b.reject(d.getHttpError(a))})},f}]),angular.module("webApp").factory("azureBlobStub",["$http","$q",function(a,b){"use strict";var c={};return c.putBlockBlob=function(c,d,e){var f=c+"&comp=block&blockid="+d,g={headers:{"x-ms-blob-type":"BlockBlob"},transformRequest:[]};return a.put(f,e,g)["catch"](function(a){return b.reject(new AzureError("Failed to upload block blob.",a))})},c.commitBlockList=function(c,d,e){for(var f=c+"&comp=blocklist",g='<?xml version="1.0" encoding="utf-8"?><BlockList>',h=0;h<d.length;h++)g+="<Latest>"+d[h]+"</Latest>";g+="</BlockList>";var i={headers:{"x-ms-blob-content-type":e}};return a.put(f,g,i)["catch"](function(a){return b.reject(new AzureError("Failed to commit blob list.",a))})},c.tryGetAvailableBlobInformation=function(c){return a.head(c).then(function(a){var d={uri:c},e=a.headers(),f=e["x-ms-meta-width"],g=e["x-ms-meta-height"];return f&&g&&(d.width=f,d.height=g),b.when(d)})["catch"](function(a){return 404===a.status?b.when(void 0):b.reject(new AzureError("Failed to check blob availability.",a))})},c}]),function(a){"use strict";a.module("angulartics.afterFirstPageTrack",["angulartics"]).factory("initialQueryParams",["$q",function(a){return a.defer()}]).config(["$analyticsProvider",function(b){var c=!0;b.registerPageTrack(function(){if(c){c=!1;var b=a.element(document.body).injector(),d=b.get("$location"),e=b.get("initialQueryParams"),f=_.cloneDeep(d.search()),g=["emailed_to","utm_campaign","utm_source","utm_medium","utm_content"];_.forEach(g,function(a){f[a]&&d.search(a,null)}),e.resolve(f)}})}])}(angular),function(a){"use strict";a.module("angulartics.google.analytics.userid",["angulartics"]).config(["$analyticsProvider",function(a){a.registerSetUsername(function(a){ga("set","&uid",a)})}])}(angular),angular.module("webApp").constant("analyticsEventConstants",{interestRegistration:{category:"Interest Registration",titleAny:"Any",titleFauxRegistered:"Faux Registered",titlePricingRequested:"Pricing Requested"},registration:{category:"Registration",title:"Registered"}}),angular.module("webApp").factory("analytics",["$q","$analytics","logService",function(a,b,c){"use strict";var d={},e=function(b){try{return a.when(b())["catch"](function(a){c.error(a)})}catch(d){return c.error(d),a.when()}},f=function(a){return e(function(){return b.eventTrack(a.eventTitle,{category:a.eventCategory})})};return d.eventTrack=function(b,d){try{return f({eventCategory:d,eventTitle:b})}catch(e){return c.error(e),a.when()}},d.setUsername=function(a){return e(function(){return b.setUsername(a)})},d.setUserProperties=function(a){return e(function(){return b.setUserProperties(a)})},d}]),angular.module("webApp").run(["analytics","$rootScope","initialQueryParams","identifiedUserNotifierConstants",function(a,b,c,d){"use strict";var e=function(){return{category:"Provenance"}};c.promise.then(function(c){var f=c.emailed_to,g=c.utm_campaign,h=c.utm_source,i=c.utm_medium,j=c.utm_content;f&&(a.setUserProperties({"last opened email from":f}),b.$emit(d.eventName,{email:f})),(g||h||i||j)&&a.eventTrack('Arrived from campaign "'+g+"/"+h+"/"+i+"/"+j+'"',e())})}]);